The shuffle process can hang when memory to memory merging is enabled.  As the memory-to-memory merge progresses it closes out the input segments which in turn lowers the commitMemory associated with those segments.  However when the merge completes it fails to increase the commitMemory accordingly for the resulting merged segment.  This effectively "leaks" shuffle memory, and we can end up in a situation where there's insufficient memory to perform any more in-memory shuffles but commitMemory is too low to trigger a merge.  All the fetcher threads eventually end up waiting on the merge that will never occur, and the shuffle hangs.