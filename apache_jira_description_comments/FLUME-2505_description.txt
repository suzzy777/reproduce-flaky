I added a test to Prateek's patch - which is flaky on Jenkins (not locally) - probably due to slower machines. I think we should make the test a bit more tolerant.