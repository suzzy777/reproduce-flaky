[~ashutosh.bapat]
Can you please take a look at it?

The code in getNextNotification() just checks whether the next event has the expected event id. This check may fail when there are multiple events with the same event id or when event ids are missing. When the test fails, it fails because there multiple events with the same event id.

We use derby database as backing db for metastore. Derby doesn't lock the row being selected with FOR UPDATE clause. addNotificationLog() and addNotificationEvent(), both functions, rely on the this behaviour to generate monotonically increasing sequential event ids. Since the row is not locked, we could fetch the same event id multiple times and then increment it to the same value multiple times. That can cause the event ids to progress in unreliable manner. So for Derby we lock the NOTIFICATION_SEQUENCE table instead of using FOR UPDATE.

Note: TxnHandler uses a different behaviour to simulate the effect of FOR UPDATE on Derby; it uses a JVM wide mutex for that. TxnHandler is not available always esp. when there are no ACID tables involved, so we need to move that mutex out of TxnHandler to a place common to DbNotificationListener and TxnHandler e.g. SQLGenerater and also have to take care of mutex's reentrant behaviour. Furthermore such a mutex wouldn't work when there are metastores are running in separate JVMs.

Since the test in Subject is flaky, I have added another test which reliably reproduces this behaviour.

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 57s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m 21s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 30s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 56s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 35s{color} | {color:blue} standalone-metastore/metastore-common in master has 31 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m 10s{color} | {color:blue} standalone-metastore/metastore-server in master has 179 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  4m 10s{color} | {color:blue} ql in master has 2254 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 30s{color} | {color:blue} hcatalog/server-extensions in master has 3 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 42s{color} | {color:blue} itests/hive-unit in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m 10s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 29s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  4m  4s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 35s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  3m 35s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 13s{color} | {color:red} itests/hcatalog-unit: The patch generated 6 new + 0 unchanged - 0 fixed = 6 total (was 0) {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 20s{color} | {color:red} itests/hive-unit: The patch generated 1 new + 32 unchanged - 0 fixed = 33 total (was 32) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  9m 52s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m  7s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 15s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 51m 52s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-17709/dev-support/hive-personality.sh |
| git revision | master / 11f7856 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17709/yetus/diff-checkstyle-itests_hcatalog-unit.txt |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17709/yetus/diff-checkstyle-itests_hive-unit.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server ql hcatalog/server-extensions itests/hcatalog-unit itests/hive-unit U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-17709/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.





Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12972710/HIVE-21880.01.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 155 failed/errored test(s), 16100 tests executed
*Failed tests:*
{noformat}
TestDbNotificationListener - did not produce a TEST-*.xml file (likely timed out) (batchId=281)
TestHCatClient - did not produce a TEST-*.xml file (likely timed out) (batchId=206)
TestReplAcrossInstancesWithJsonMessageFormat - did not produce a TEST-*.xml file (likely timed out) (batchId=255)
TestReplWithJsonMessageFormat - did not produce a TEST-*.xml file (likely timed out) (batchId=249)
TestReplicationScenarios - did not produce a TEST-*.xml file (likely timed out) (batchId=256)
TestReplicationScenariosAcrossInstances - did not produce a TEST-*.xml file (likely timed out) (batchId=257)
TestReplicationScenariosExternalTables - did not produce a TEST-*.xml file (likely timed out) (batchId=255)
TestTableLevelReplicationScenarios - did not produce a TEST-*.xml file (likely timed out) (batchId=255)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[results_cache_invalidation2] (batchId=170)
org.apache.hadoop.hive.metastore.TestObjectStore.testMaxEventResponse (batchId=232)
org.apache.hadoop.hive.metastore.TestObjectStore.testNotificationOps (batchId=232)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testAggrStat (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testAggrStatAbortTxn (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testAggrStatTxnTable (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testDatabaseOpsForUpdateUsingEvents (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testPartitionOpsForUpdateUsingEvents (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableColumnStatistics (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableColumnStatisticsTxnTable (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableColumnStatisticsTxnTableMulti (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableColumnStatisticsTxnTableMultiAbort (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableColumnStatisticsTxnTableOpenTxn (batchId=242)
org.apache.hadoop.hive.metastore.cache.TestCachedStoreUpdateUsingEvents.testTableOpsForUpdateUsingEvents (batchId=242)
org.apache.hadoop.hive.ql.parse.TestCopyUtils.testPrivilegedDistCpWithSameUserAsCurrentDoesNotTryToImpersonate (batchId=265)
org.apache.hadoop.hive.ql.parse.TestExportImport.dataImportAfterMetadataOnlyImport (batchId=255)
org.apache.hadoop.hive.ql.parse.TestExportImport.databaseTheTableIsImportedIntoShouldBeParsedFromCommandLine (batchId=255)
org.apache.hadoop.hive.ql.parse.TestExportImport.shouldExportImportATemporaryTable (batchId=255)
org.apache.hadoop.hive.ql.parse.TestExportImport.testExportExternalTableSetFalse (batchId=255)
org.apache.hadoop.hive.ql.parse.TestExportImport.testExportExternalTableSetTrue (batchId=255)
org.apache.hadoop.hive.ql.parse.TestExportImport.testExportNonNativeTable (batchId=255)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesBootstrapWithJsonMessage.retryIncBootstrapAcidFromDifferentDumpWithoutCleanTablesConfig (batchId=248)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesBootstrapWithJsonMessage.testAcidTablesBootstrapDuringIncremental (batchId=248)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesBootstrapWithJsonMessage.testAcidTablesBootstrapDuringIncrementalWithOpenTxnsTimeout (batchId=248)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesBootstrapWithJsonMessage.testBootstrapAcidTablesDuringIncrementalWithConcurrentWrites (batchId=248)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesBootstrapWithJsonMessage.testRetryAcidTablesBootstrapFromDifferentDump (batchId=248)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAbortTxnEvent (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidBootstrapReplLoadRetryAfterFailure (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesBootstrap (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesBootstrapWithConcurrentDropTable (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesBootstrapWithConcurrentWrites (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesBootstrapWithOpenTxnsTimeout (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesMoveOptimizationBootStrap (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testAcidTablesMoveOptimizationIncremental (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testDumpAcidTableWithPartitionDirMissing (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testDumpAcidTableWithTableDirMissing (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testMultiDBTxn (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testOpenTxnEvent (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplAcidTablesWithJsonMessage.testTxnEventNonAcid (batchId=260)
org.apache.hadoop.hive.ql.parse.TestReplScenariosWithStrictManaged.dynamicallyConvertExternalToManagedTable (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplScenariosWithStrictManaged.dynamicallyConvertManagedToExternalTable (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.dynamicallyConvertExternalToManagedTable (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.dynamicallyConvertManagedToExternalTable (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testBootstrapConvertedExternalTableAutoPurgeDataOnDrop (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testBootstrapLoadMigrationManagedToAcid (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testBootstrapLoadMigrationToAcidWithMoveOptimization (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncConvertedExternalTableAutoDeleteDataDirOnDrop (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncrementalLoadMigrationManagedToAcid (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncrementalLoadMigrationManagedToAcidAllOp (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncrementalLoadMigrationManagedToAcidFailure (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncrementalLoadMigrationManagedToAcidFailurePart (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testIncrementalLoadMigrationToAcidWithMoveOptimization (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplTableMigrationWithJsonFormat.testMigrationWithUpgrade (batchId=258)
org.apache.hadoop.hive.ql.parse.TestReplicationOfHiveStreaming.testHiveStreamingDynamicPartitionWithTxnBatchSizeAsOne (batchId=255)
org.apache.hadoop.hive.ql.parse.TestReplicationOfHiveStreaming.testHiveStreamingStaticPartitionWithTxnBatchSizeAsOne (batchId=255)
org.apache.hadoop.hive.ql.parse.TestReplicationOfHiveStreaming.testHiveStreamingUnpartitionedWithTxnBatchSizeAsOne (batchId=255)
org.apache.hadoop.hive.ql.parse.TestReplicationOnHDFSEncryptedZones.targetAndSourceHaveDifferentEncryptionZoneKeys (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAbortTxnEvent (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidBootstrapReplLoadRetryAfterFailure (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesBootstrap (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesBootstrapWithConcurrentDropTable (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesBootstrapWithConcurrentWrites (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesBootstrapWithOpenTxnsTimeout (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesMoveOptimizationBootStrap (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testAcidTablesMoveOptimizationIncremental (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testDumpAcidTableWithPartitionDirMissing (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testDumpAcidTableWithTableDirMissing (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testMultiDBTxn (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testOpenTxnEvent (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTables.testTxnEventNonAcid (batchId=262)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTablesBootstrap.retryIncBootstrapAcidFromDifferentDumpWithoutCleanTablesConfig (batchId=246)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTablesBootstrap.testAcidTablesBootstrapDuringIncremental (batchId=246)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTablesBootstrap.testAcidTablesBootstrapDuringIncrementalWithOpenTxnsTimeout (batchId=246)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTablesBootstrap.testBootstrapAcidTablesDuringIncrementalWithConcurrentWrites (batchId=246)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosAcidTablesBootstrap.testRetryAcidTablesBootstrapFromDifferentDump (batchId=246)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosIncrementalLoadAcidTables.testAcidTableIncrementalReplication (batchId=263)
org.apache.hadoop.hive.ql.parse.TestReplicationScenariosIncrementalLoadAcidTables.testReplCM (batchId=263)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.dynamicallyConvertExternalToManagedTable (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.dynamicallyConvertManagedToExternalTable (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testBootstrapConvertedExternalTableAutoPurgeDataOnDrop (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testBootstrapLoadMigrationManagedToAcid (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testBootstrapLoadMigrationToAcidWithMoveOptimization (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncConvertedExternalTableAutoDeleteDataDirOnDrop (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncrementalLoadMigrationManagedToAcid (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncrementalLoadMigrationManagedToAcidAllOp (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncrementalLoadMigrationManagedToAcidFailure (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncrementalLoadMigrationManagedToAcidFailurePart (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testIncrementalLoadMigrationToAcidWithMoveOptimization (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigration.testMigrationWithUpgrade (batchId=252)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.dynamicallyConvertNonAcidToAcidTable (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.prohibitManagedTableLocationChangeOnReplSource (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testConcurrentOpDuringBootStrapDumpCreateTableReplay (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testConcurrentOpDuringBootStrapDumpInsertOverwrite (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testConcurrentOpDuringBootStrapDumpInsertReplay (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testIncLoadPenFlagPropAlterDB (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testIncLoadPenFlagWithMoveOptimization (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testOnwerPropagation (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testOnwerPropagationInc (batchId=265)
org.apache.hadoop.hive.ql.parse.TestReplicationWithTableMigrationEx.testTableLevelDumpMigration (batchId=265)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenarios.testForParallelBootstrapLoad (batchId=265)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenarios.testMetadataOnlyDump (batchId=265)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenarios.testNonParallelBootstrapLoad (batchId=265)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenarios.testRetryFailure (batchId=265)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACID.testForParallelBootstrapLoad (batchId=250)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACID.testMetadataOnlyDump (batchId=250)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACID.testNonParallelBootstrapLoad (batchId=250)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACID.testRetryFailure (batchId=250)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACIDNoAutogather.testForParallelBootstrapLoad (batchId=251)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACIDNoAutogather.testMetadataOnlyDump (batchId=251)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACIDNoAutogather.testNonParallelBootstrapLoad (batchId=251)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosACIDNoAutogather.testRetryFailure (batchId=251)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMM.testForParallelBootstrapLoad (batchId=254)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMM.testMetadataOnlyDump (batchId=254)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMM.testNonParallelBootstrapLoad (batchId=254)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMM.testRetryFailure (batchId=254)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMMNoAutogather.testForParallelBootstrapLoad (batchId=247)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMMNoAutogather.testMetadataOnlyDump (batchId=247)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMMNoAutogather.testNonParallelBootstrapLoad (batchId=247)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMMNoAutogather.testRetryFailure (batchId=247)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigration.testForParallelBootstrapLoad (batchId=253)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigration.testMetadataOnlyDump (batchId=253)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigration.testNonParallelBootstrapLoad (batchId=253)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigration.testRetryFailure (batchId=253)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigrationNoAutogather.testForParallelBootstrapLoad (batchId=259)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigrationNoAutogather.testMetadataOnlyDump (batchId=259)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigrationNoAutogather.testNonParallelBootstrapLoad (batchId=259)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosMigrationNoAutogather.testRetryFailure (batchId=259)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosNoAutogather.testForParallelBootstrapLoad (batchId=261)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosNoAutogather.testMetadataOnlyDump (batchId=261)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosNoAutogather.testNonParallelBootstrapLoad (batchId=261)
org.apache.hadoop.hive.ql.parse.TestStatsReplicationScenariosNoAutogather.testRetryFailure (batchId=261)
org.apache.hive.hcatalog.api.TestHCatClientNotification.addPartition (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.createDatabase (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.createTable (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropDatabase (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropPartition (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.dropTable (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.filter (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.filterWithMax (batchId=281)
org.apache.hive.hcatalog.api.TestHCatClientNotification.getOnlyMaxEvents (batchId=281)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testBasicReplEximCommands (batchId=206)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testDropDatabaseCommand (batchId=206)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testDropPartitionCommand (batchId=206)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testDropTableCommand (batchId=206)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testDropTableCommand2 (batchId=206)
org.apache.hive.hcatalog.api.repl.commands.TestCommands.testMetadataReplEximCommands (batchId=206)
org.apache.hive.jdbc.TestJdbcDriver2.testGetQueryLogForReplCommands (batchId=274)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17709/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17709/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17709/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 155 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12972710 - PreCommit-HIVE-Build

The earlier failures indicate that we can not execute LOCK TABLE through JDOQuery.execute() interface. Instead use MetaStoreDirectSql.executeNoResult() whenever possible.

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  2m  5s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  6s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 30s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 57s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 34s{color} | {color:blue} standalone-metastore/metastore-common in master has 31 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m 11s{color} | {color:blue} standalone-metastore/metastore-server in master has 179 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  3m 59s{color} | {color:blue} ql in master has 2253 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 28s{color} | {color:blue} hcatalog/server-extensions in master has 3 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 41s{color} | {color:blue} itests/hive-unit in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m 14s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 27s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  3m 50s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 28s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  3m 28s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 11s{color} | {color:red} itests/hcatalog-unit: The patch generated 81 new + 0 unchanged - 0 fixed = 81 total (was 0) {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 17s{color} | {color:red} itests/hive-unit: The patch generated 1 new + 32 unchanged - 0 fixed = 33 total (was 32) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  9m 26s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m  6s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 14s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 50m 40s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-17779/dev-support/hive-personality.sh |
| git revision | master / 57c4217 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17779/yetus/diff-checkstyle-itests_hcatalog-unit.txt |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17779/yetus/diff-checkstyle-itests_hive-unit.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server ql hcatalog/server-extensions itests/hcatalog-unit itests/hive-unit U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-17779/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.





Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12973104/HIVE-21880.02.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 3 failed/errored test(s), 16328 tests executed
*Failed tests:*
{noformat}
TestDataSourceProviderFactory - did not produce a TEST-*.xml file (likely timed out) (batchId=232)
TestObjectStore - did not produce a TEST-*.xml file (likely timed out) (batchId=232)
org.apache.hadoop.hive.metastore.TestMetastoreHousekeepingLeaderEmptyConfig.testHouseKeepingThreadExistence (batchId=242)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17779/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17779/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17779/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12973104 - PreCommit-HIVE-Build

The failed tests are passing for me locally. Re-submitting .02 patch as .03 to trigger ptests.

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 54s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  6s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 30s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 55s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 35s{color} | {color:blue} standalone-metastore/metastore-common in master has 31 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m 12s{color} | {color:blue} standalone-metastore/metastore-server in master has 179 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  4m  3s{color} | {color:blue} ql in master has 2253 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 27s{color} | {color:blue} hcatalog/server-extensions in master has 3 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 39s{color} | {color:blue} itests/hive-unit in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m  7s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 27s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  3m 52s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 30s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  3m 30s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 12s{color} | {color:red} itests/hcatalog-unit: The patch generated 81 new + 0 unchanged - 0 fixed = 81 total (was 0) {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 17s{color} | {color:red} itests/hive-unit: The patch generated 1 new + 32 unchanged - 0 fixed = 33 total (was 32) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  1s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  9m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  3m  3s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 14s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 50m 31s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-17788/dev-support/hive-personality.sh |
| git revision | master / 57c4217 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17788/yetus/diff-checkstyle-itests_hcatalog-unit.txt |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17788/yetus/diff-checkstyle-itests_hive-unit.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server ql hcatalog/server-extensions itests/hcatalog-unit itests/hive-unit U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-17788/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.





Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12973146/HIVE-21880.03.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:red}ERROR:{color} -1 due to 8 failed/errored test(s), 16360 tests executed
*Failed tests:*
{noformat}
org.apache.hadoop.hive.llap.cache.TestBuddyAllocator.testMTT[2] (batchId=350)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerCustomCreatedDynamicPartitions (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerCustomCreatedDynamicPartitionsUnionAll (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerCustomNonExistent (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerHighBytesRead (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerHighShuffleBytes (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerSlowQueryElapsedTime (batchId=275)
org.apache.hive.jdbc.TestTriggersTezSessionPoolManager.testTriggerSlowQueryExecutionTime (batchId=275)
{noformat}

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17788/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17788/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17788/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 8 tests failed
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12973146 - PreCommit-HIVE-Build

Patch addressing [~maheshk114]'s comments.

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 43s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  6m 53s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 23s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 52s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 29s{color} | {color:blue} standalone-metastore/metastore-common in master has 31 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m 10s{color} | {color:blue} standalone-metastore/metastore-server in master has 179 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  3m 59s{color} | {color:blue} ql in master has 2254 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 28s{color} | {color:blue} hcatalog/server-extensions in master has 3 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 40s{color} | {color:blue} itests/hive-unit in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 59s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 26s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  3m 47s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  3m 22s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  3m 22s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 11s{color} | {color:red} itests/hcatalog-unit: The patch generated 3 new + 0 unchanged - 0 fixed = 3 total (was 0) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  9m 20s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 57s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 13s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 48m 59s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-17820/dev-support/hive-personality.sh |
| git revision | master / 2d9e0e4 |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17820/yetus/diff-checkstyle-itests_hcatalog-unit.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server ql hcatalog/server-extensions itests/hcatalog-unit itests/hive-unit U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-17820/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.





Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12973406/HIVE-21880.04.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:green}SUCCESS:{color} +1 due to 16362 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17820/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17820/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17820/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12973406 - PreCommit-HIVE-Build

Patch removing the new error code as per [~maheshk114]'s suggestion.



Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12973672/HIVE-21880.05.patch

{color:red}ERROR:{color} -1 due to build exiting with an error

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17862/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17862/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17862/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command 'bash /data/hiveptest/working/scratch/source-prep.sh' failed with exit status 1 and output '+ date '+%Y-%m-%d %T.%3N'
2019-07-05 04:22:54.408
+ [[ -n /usr/lib/jvm/java-8-openjdk-amd64 ]]
+ export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
+ export PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ PATH=/usr/lib/jvm/java-8-openjdk-amd64/bin/:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
+ export 'ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m '
+ ANT_OPTS='-Xmx1g -XX:MaxPermSize=256m '
+ export 'MAVEN_OPTS=-Xmx1g '
+ MAVEN_OPTS='-Xmx1g '
+ cd /data/hiveptest/working/
+ tee /data/hiveptest/logs/PreCommit-HIVE-Build-17862/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ date '+%Y-%m-%d %T.%3N'
2019-07-05 04:22:54.411
+ cd apache-github-source-source
+ git fetch origin
+ git reset --hard HEAD
HEAD is now at 3223bda HIVE-21949: Revert HIVE-21232 LLAP: Add a cache-miss friendly split affinity provider (Antal Sinkovits reviewed by Gopal V, Oliver Draese and Peter Vary)
+ git clean -f -d
Removing standalone-metastore/metastore-server/src/gen/
+ git checkout master
Already on 'master'
Your branch is up-to-date with 'origin/master'.
+ git reset --hard origin/master
HEAD is now at 3223bda HIVE-21949: Revert HIVE-21232 LLAP: Add a cache-miss friendly split affinity provider (Antal Sinkovits reviewed by Gopal V, Oliver Draese and Peter Vary)
+ git merge --ff-only origin/master
Already up-to-date.
+ date '+%Y-%m-%d %T.%3N'
2019-07-05 04:22:55.052
+ rm -rf ../yetus_PreCommit-HIVE-Build-17862
+ mkdir ../yetus_PreCommit-HIVE-Build-17862
+ git gc
+ cp -R . ../yetus_PreCommit-HIVE-Build-17862
+ mkdir /data/hiveptest/logs/PreCommit-HIVE-Build-17862/yetus
+ patchCommandPath=/data/hiveptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hiveptest/working/scratch/build.patch
+ [[ -f /data/hiveptest/working/scratch/build.patch ]]
+ chmod +x /data/hiveptest/working/scratch/smart-apply-patch.sh
+ /data/hiveptest/working/scratch/smart-apply-patch.sh /data/hiveptest/working/scratch/build.patch
error: a/hcatalog/server-extensions/src/main/java/org/apache/hive/hcatalog/listener/DbNotificationListener.java: does not exist in index
error: a/itests/hive-unit/src/test/java/org/apache/hadoop/hive/ql/parse/TestReplicationScenariosAcidTablesBootstrap.java: does not exist in index
error: a/standalone-metastore/metastore-common/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClient.java: does not exist in index
error: a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/MetaStoreDirectSql.java: does not exist in index
error: a/standalone-metastore/metastore-server/src/main/java/org/apache/hadoop/hive/metastore/ObjectStore.java: does not exist in index
Going to apply patch with: git apply -p1
+ [[ maven == \m\a\v\e\n ]]
+ rm -rf /data/hiveptest/working/maven/org/apache/hive
+ mvn -B clean install -DskipTests -T 4 -q -Dmaven.repo.local=/data/hiveptest/working/maven
protoc-jar: executing: [/tmp/protoc4480269874805435176.exe, --version]
libprotoc 2.5.0
protoc-jar: executing: [/tmp/protoc4480269874805435176.exe, -I/data/hiveptest/working/apache-github-source-source/standalone-metastore/metastore-common/src/main/protobuf/org/apache/hadoop/hive/metastore, --java_out=/data/hiveptest/working/apache-github-source-source/standalone-metastore/metastore-common/target/generated-sources, /data/hiveptest/working/apache-github-source-source/standalone-metastore/metastore-common/src/main/protobuf/org/apache/hadoop/hive/metastore/metastore.proto]
ANTLR Parser Generator  Version 3.5.2
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-remote-resources-plugin:1.5:process (process-resource-bundles) on project hive-shims-0.23: Execution process-resource-bundles of goal org.apache.maven.plugins:maven-remote-resources-plugin:1.5:process failed. ConcurrentModificationException -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutionException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <goals> -rf :hive-shims-0.23
+ result=1
+ '[' 1 -ne 0 ']'
+ rm -rf yetus_PreCommit-HIVE-Build-17862
+ exit 1
'
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12973672 - PreCommit-HIVE-Build

The build isn't failing locally for me. So, re-attaching 05 renamed as 06.

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
|| || || || {color:brown} Prechecks {color} ||
| {color:green}+1{color} | {color:green} @author {color} | {color:green}  0m  0s{color} | {color:green} The patch does not contain any @author tags. {color} |
|| || || || {color:brown} master Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  1m 47s{color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  7m  7s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  2m 23s{color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green}  1m 17s{color} | {color:green} master passed {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  2m 30s{color} | {color:blue} standalone-metastore/metastore-common in master has 31 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  1m 10s{color} | {color:blue} standalone-metastore/metastore-server in master has 179 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 26s{color} | {color:blue} hcatalog/server-extensions in master has 3 extant Findbugs warnings. {color} |
| {color:blue}0{color} | {color:blue} findbugs {color} | {color:blue}  0m 40s{color} | {color:blue} itests/hive-unit in master has 2 extant Findbugs warnings. {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 19s{color} | {color:green} master passed {color} |
|| || || || {color:brown} Patch Compile Tests {color} ||
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue}  0m 26s{color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green}  2m 32s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green}  2m 23s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green}  2m 23s{color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} checkstyle {color} | {color:red}  0m 11s{color} | {color:red} itests/hcatalog-unit: The patch generated 3 new + 0 unchanged - 0 fixed = 3 total (was 0) {color} |
| {color:green}+1{color} | {color:green} whitespace {color} | {color:green}  0m  0s{color} | {color:green} The patch has no whitespace issues. {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green}  5m 28s{color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green}  2m 24s{color} | {color:green} the patch passed {color} |
|| || || || {color:brown} Other Tests {color} ||
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green}  0m 13s{color} | {color:green} The patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 35m 30s{color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| Optional Tests |  asflicense  javac  javadoc  findbugs  checkstyle  compile  |
| uname | Linux hiveptest-server-upstream 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u5 (2017-09-19) x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /data/hiveptest/working/yetus_PreCommit-HIVE-Build-17872/dev-support/hive-personality.sh |
| git revision | master / 9a9978f |
| Default Java | 1.8.0_111 |
| findbugs | v3.0.0 |
| checkstyle | http://104.198.109.242/logs//PreCommit-HIVE-Build-17872/yetus/diff-checkstyle-itests_hcatalog-unit.txt |
| modules | C: standalone-metastore/metastore-common standalone-metastore/metastore-server hcatalog/server-extensions itests/hcatalog-unit itests/hive-unit U: . |
| Console output | http://104.198.109.242/logs//PreCommit-HIVE-Build-17872/yetus.txt |
| Powered by | Apache Yetus    http://yetus.apache.org |


This message was automatically generated.





Here are the results of testing the latest attachment:
https://issues.apache.org/jira/secure/attachment/12973732/HIVE-21880.06.patch

{color:green}SUCCESS:{color} +1 due to 2 test(s) being added or modified.

{color:green}SUCCESS:{color} +1 due to 16364 tests passed

Test results: https://builds.apache.org/job/PreCommit-HIVE-Build/17872/testReport
Console output: https://builds.apache.org/job/PreCommit-HIVE-Build/17872/console
Test logs: http://104.198.109.242/logs/PreCommit-HIVE-Build-17872/

Messages:
{noformat}
Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.YetusPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
{noformat}

This message is automatically generated.

ATTACHMENT ID: 12973732 - PreCommit-HIVE-Build

HIVE-21880.06.patch committed to master. Thanks [~ashutosh.bapat] for fixing the issue.

