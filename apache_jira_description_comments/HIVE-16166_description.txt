A heap dump obtained from one of our users shows that 15% of memory is wasted on duplicate strings, despite the recent optimizations that I made. The problematic strings just come from different sources this time. See the excerpt from the jxray (www.jxray.com) analysis attached.

Adding String.intern() calls in the appropriate places reduces the overhead of duplicate strings with this workload to ~6%. The remaining duplicates come mostly from JDK internal and MapReduce data structures, and thus are more difficult to fix.