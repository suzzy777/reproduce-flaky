See HIVE-11017 and comments in the class