Test Fail: HttpPartitionTest.test
Fail message:
   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=HttpPartitionTest -Dtests.method=test -Dtests.seed=3C00D32E6729C090 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-OM -Dtests.timezone=Australia/Melbourne -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 42.1s J1 | HttpPartitionTest.test <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: max version bucket seed not updated after recovery!
   [junit4]    >  at __randomizedtesting.SeedInfo.seed([3C00D32E6729C090:B454ECF4C9D5AD68]:0)
   [junit4]    >  at org.apache.solr.cloud.HttpPartitionTest.testRf2(HttpPartitionTest.java:364)
   [junit4]    >  at org.apache.solr.cloud.HttpPartitionTest.test(HttpPartitionTest.java:148)

Test: OverseerTest
Fail message:
Unknown.

Below did not reproduce the the reproduce line. Saved logs off in case more details needed.

Test: TestCollectionsAPIViaSolrCloudCluster#testCollectionCreateSearchDelete
 Fail message:
{noformat}
testCollectionCreateSearchDelete
   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestCollectionsAPIViaSolrCloudCluster -Dtests.method=testCollectionCreateSearchDelete -Dtests.seed=69334EE3FF38A1CC -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=it-IT -Dtests.timezone=Africa/Tunis -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   13.3s J7 | TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete <<<
   [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at http://127.0.0.1:33783/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
   [junit4]    > <head>
   [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
   [junit4]    > </head>
   [junit4]    > <body><h2>HTTP ERROR 404</h2>
   [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
   [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
   [junit4]    > </body>
   [junit4]    > </html>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([69334EE3FF38A1CC:CAC9E04678D04B69]:0)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
   [junit4]    > 	at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
   [junit4]    > 	at org.apache.solr.cloud.api.collections.TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete(TestCollectionsAPIViaSolrCloudCluster.java:181)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:33783/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
   [junit4]    > <head>
   [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
   [junit4]    > </head>
   [junit4]    > <body><h2>HTTP ERROR 404</h2>
   [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
   [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
   [junit4]    > </body>
   [junit4]    > </html>
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
   [junit4]    > 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
   [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    > 	... 1 more{noformat}

Separate test run. Seed does not reproduce.

Test: OverseerTest#testBadQueueItem
Fail message:
{noformat}
23:37:34    [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=OverseerTest -Dtests.method=testBadQueueItem -Dtests.seed=34970C10FE2A115D -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=fr -Dtests.timezone=Canada/Yukon -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
23:37:34    [junit4] FAILURE 0.88s J6 | OverseerTest.testBadQueueItem <<<
23:37:34    [junit4]    > Throwable #1: java.lang.AssertionError: expected:<1> but was:<0>
23:37:34    [junit4]    > at __randomizedtesting.SeedInfo.seed([34970C10FE2A115D:843AC65BA75F47C5]:0)
23:37:34    [junit4]    > at org.apache.solr.cloud.OverseerTest.testBadQueueItem(OverseerTest.java:424)
23:37:34    [junit4]    > at java.lang.Thread.run(Thread.java:748){noformat}

Thanks! No log necessary, really just the test, but also the message lets me know for sure if I got that specific issue.

I've actually seen testCollectionCreateSearchDelete and have been trying to correct it. I'll move to awaits fix and keep working on it.

I've also seen the Overseer test failure. I had beasted that pretty well on a slightly older different checkout, but a lot of changes since then. I'll just try and fix that one directly.



I ran the tests overnight about ever 45min and have some more failures to share. I'll collect the test cases and error messages.

Test: TestExternalValueFeatures
{code:java}
   [junit4]   2> SEVERE: 1 thread leaked from SUITE scope at org.apache.solr.ltr.feature.TestExternalValueFeatures: 
   [junit4]   2>    1) Thread[id=112, name=qtp970227545-112, state=TIMED_WAITING, group=TGRP-TestExternalValueFeatures]
   [junit4]   2>         at sun.misc.Unsafe.park(Native Method)
   [junit4]   2>         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]   2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2163)
   [junit4]   2>         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.reservedWait(ReservedThreadExecutor.java:292)
   [junit4]   2>         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:357)
   [junit4]   2>         at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:762)
   [junit4]   2>         at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:680)
   [junit4]   2>         at java.lang.Thread.run(Thread.java:745)
   [junit4]   2> Oct 31, 2018 7:44:18 AM com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll
   [junit4]   2> INFO: Starting to interrupt leaked threads:
   [junit4]   2>    1) Thread[id=112, name=qtp970227545-112, state=TIMED_WAITING, group=TGRP-TestExternalValueFeatures]
   [junit4]   2> Oct 31, 2018 7:44:21 AM com.carrotsearch.randomizedtesting.ThreadLeakControl tryToInterruptAll
   [junit4]   2> SEVERE: There are still zombie threads that couldn't be terminated:
   [junit4]   2>    1) Thread[id=112, name=qtp970227545-112, state=TIMED_WAITING, group=TGRP-TestExternalValueFeatures]
   [junit4]   2>         at sun.misc.Unsafe.park(Native Method)
   [junit4]   2>         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]   2>         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2163)
   [junit4]   2>         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.reservedWait(ReservedThreadExecutor.java:292)
   [junit4]   2>         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:357)
   [junit4]   2>         at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:762)
   [junit4]   2>         at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:680)
   [junit4]   2>         at java.lang.Thread.run(Thread.java:745)
   [junit4]   2> NOTE: test params are: codec=Asserting(Lucene70): {_version_=FST50, popularity=PostingsFormat(name=Asserting), description=PostingsFormat(name=LuceneVarGapFixedInterval), id=PostingsFormat(name=Asserting), text=PostingsFormat(name=MockRandom), title=PostingsFormat(name=LuceneVarGapFixedInterval)}, docValues:{_version_=DocValuesFormat(name=Direct), popularity=DocValuesFormat(name=Lucene70)}, maxPointsInLeafNode=956, maxMBSortInHeap=7.014047826661978, sim=RandomSimilarity(queryNorm=true): {}, locale=ar-EG, timezone=Africa/El_Aaiun
   [junit4]   2> NOTE: Mac OS X 10.13.6 x86_64/Oracle Corporation 1.8.0_121 (64-bit)/cpus=4,threads=2,free=198059320,total=277872640
   [junit4]   2> NOTE: All tests run in this JVM: [TestValueFeature, TestDefaultWrapperModel, TestExternalValueFeatures]
   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestExternalValueFeatures -Dtests.seed=CA847E592B26E1E8 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-EG -Dtests.timezone=Africa/El_Aaiun -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.00s J0 | TestExternalValueFeatures (suite) <<<
   [junit4]    > Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.ltr.feature.TestExternalValueFeatures: 
   [junit4]    >    1) Thread[id=112, name=qtp970227545-112, state=TIMED_WAITING, group=TGRP-TestExternalValueFeatures]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2163)
   [junit4]    >         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.reservedWait(ReservedThreadExecutor.java:292)
   [junit4]    >         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:357)
   [junit4]    >         at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:762)
   [junit4]    >         at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:680)
   [junit4]    >         at java.lang.Thread.run(Thread.java:745)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([CA847E592B26E1E8]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:
   [junit4]    >    1) Thread[id=112, name=qtp970227545-112, state=TIMED_WAITING, group=TGRP-TestExternalValueFeatures]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2163)
   [junit4]    >         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.reservedWait(ReservedThreadExecutor.java:292)
   [junit4]    >         at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:357)
   [junit4]    >         at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:762)
   [junit4]    >         at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:680)
   [junit4]    >         at java.lang.Thread.run(Thread.java:745)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([CA847E592B26E1E8]:0)
   [junit4] Completed [34/37 (1!)] on J0 in 40.69s, 2 tests, 2 errors <<< FAILURES!
{code}


 Test: DistribCursorPagingTest
{noformat}
reproduce with: ant test  -Dtestcase=DistribCursorPagingTest -Dtests.method=test -Dtests.seed=87B400F0180614A3 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sq-AL -Dtests.timezone=Etc/GMT+9 -Dtests.asserts=true -Dtests.file.encoding=UTF-8
23:47:46    [junit4] FAILURE 19.4s J7 | DistribCursorPagingTest.test <<<
23:47:46    [junit4]    > Throwable #1: junit.framework.AssertionFailedError: .facet_counts.facet_fields.str.x:0!=null
23:47:46    [junit4]    > 	at __randomizedtesting.SeedInfo.seed([87B400F0180614A3:FE03F2AB6FA795B]:0)
23:47:46    [junit4]    > 	at junit.framework.Assert.fail(Assert.java:50)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase.compareSolrResponses(BaseDistributedSearchTestCase.java:985)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase.compareResponses(BaseDistributedSearchTestCase.java:1012)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase.query(BaseDistributedSearchTestCase.java:666)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase.query(BaseDistributedSearchTestCase.java:629)
23:47:46    [junit4]    > 	at org.apache.solr.cloud.DistribCursorPagingTest.doSimpleTest(DistribCursorPagingTest.java:258)
23:47:46    [junit4]    > 	at org.apache.solr.cloud.DistribCursorPagingTest.test(DistribCursorPagingTest.java:90)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1066)
23:47:46    [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:1040)
23:47:46    [junit4]    > 	at java.lang.Thread.run(Thread.java:748){noformat}

Test: TestPKIAuthenticationPlugin#test
{code:java}
reproduce with: ant test -Dtestcase=TestPKIAuthenticationPlugin -Dtests.method=test -Dtests.seed=4FE78DD4E91611D9 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-BH -Dtests.timezone=Asia/Kabul -Dtests.asserts=true -Dtests.file.encoding=UTF-8 [junit4] ERROR 10.7s J0 | TestPKIAuthenticationPlugin.test <<< [junit4] > Throwable #1: java.lang.NullPointerException [junit4] > at __randomizedtesting.SeedInfo.seed([4FE78DD4E91611D9:C7B3B20E47EA7C21]:0) [junit4] > at org.apache.solr.security.TestPKIAuthenticationPlugin.test(TestPKIAuthenticationPlugin.java:105) [junit4] > at java.lang.Thread.run(Thread.java:748){code}

Test: AutoAddReplicasPlanActionTest#testSimple
{code:java}
reproduce with: ant test  -Dtestcase=AutoAddReplicasPlanActionTest -Dtests.method=testSimple -Dtests.seed=76A7FA053BF740C5 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=fr -Dtests.timezone=Asia/Baku -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
00:46:11    [junit4] ERROR   37.4s J5 | AutoAddReplicasPlanActionTest.testSimple <<<
00:46:11    [junit4]    > Throwable #1: java.util.concurrent.TimeoutException
00:46:11    [junit4]    > 	at __randomizedtesting.SeedInfo.seed([76A7FA053BF740C5:4E14DEFB1C049414]:0)
00:46:11    [junit4]    > 	at org.apache.solr.common.cloud.ZkStateReader.waitForState(ZkStateReader.java:1512)
00:46:11    [junit4]    > 	at org.apache.solr.cloud.autoscaling.AutoAddReplicasPlanActionTest.waitForNodeLeave(AutoAddReplicasPlanActionTest.java:188)
00:46:11    [junit4]    > 	at org.apache.solr.cloud.autoscaling.AutoAddReplicasPlanActionTest.testSimple(AutoAddReplicasPlanActionTest.java:114)
00:46:11    [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

Test: TestCollectionsAPIViaSolrCloudCluster#testCollectionCreateSearchDelete
{code:java}
reproduce with: ant test  -Dtestcase=TestCollectionsAPIViaSolrCloudCluster -Dtests.method=testCollectionCreateSearchDelete -Dtests.seed=879612B1BD020602 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=fr-LU -Dtests.timezone=Canada/Yukon -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
01:16:51    [junit4] ERROR   8.48s J7 | TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete <<<
01:16:51    [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at https://127.0.0.1:35461/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
01:16:51    [junit4]    > <head>
01:16:51    [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
01:16:51    [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
01:16:51    [junit4]    > </head>
01:16:51    [junit4]    > <body><h2>HTTP ERROR 404</h2>
01:16:51    [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
01:16:51    [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
01:16:51    [junit4]    > </body>
01:16:51    [junit4]    > </html>
01:16:51    [junit4]    > 	at __randomizedtesting.SeedInfo.seed([879612B1BD020602:246CBC143AEAECA7]:0)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
01:16:51    [junit4]    > 	at org.apache.solr.cloud.api.collections.TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete(TestCollectionsAPIViaSolrCloudCluster.java:181)
01:16:51    [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
01:16:51    [junit4]    > Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:35461/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
01:16:51    [junit4]    > <head>
01:16:51    [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
01:16:51    [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
01:16:51    [junit4]    > </head>
01:16:51    [junit4]    > <body><h2>HTTP ERROR 404</h2>
01:16:51    [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
01:16:51    [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
01:16:51    [junit4]    > </body>
01:16:51    [junit4]    > </html>
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
01:16:51    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
01:16:51    [junit4]    > 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
01:16:51    [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
01:16:51    [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
01:16:51    [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
01:16:51    [junit4]    > 	... 1 more
{code}

Test: ExecutePlanActionTest#testIntegration
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=ExecutePlanActionTest -Dtests.method=testIntegration -Dtests.seed=C96AD1F563B86BE2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-VE -Dtests.timezone=America/Ensenada -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 2.56s J0 | ExecutePlanActionTest.testIntegration <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<2> but was:<1>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([C96AD1F563B86BE2:790BDFD94687CAC7]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.ExecutePlanActionTest.testIntegration(ExecutePlanActionTest.java:224)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

Test: SolrCoreTest#testReloadLeak
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=SolrCoreTest -Dtests.method=testReloadLeak -Dtests.seed=153A4F27CDF7F30F -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=vi-VN -Dtests.timezone=America/Denver -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.81s J3 | SolrCoreTest.testReloadLeak <<<
   [junit4]    > Throwable #1: com.carrotsearch.randomizedtesting.UncaughtExceptionError: Captured an uncaught exception in thread: Thread[id=18166, name=testReloadLeak-7844-thread-1, state=RUNNABLE, group=TGRP-SolrCoreTest]
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([153A4F27CDF7F30F:9792FAE9140ECF29]:0)
   [junit4]    > Caused by: org.apache.solr.update.SolrCoreState$CoreIsClosedException
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([153A4F27CDF7F30F]:0)
   [junit4]    > 	at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:2003)
   [junit4]    > 	at org.apache.solr.core.SolrCoreTest$NewSearcherRunnable.run(SolrCoreTest.java:311)
   [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

All of the ones I posted above are single failures in a test run. Here is a run with 3 failures:

Test: TestCloudSearcherWarming#testRepFactor1LeaderStartup
{code:java}
reproduce with: ant test  -Dtestcase=TestCloudSearcherWarming -Dtests.method=testRepFactor1LeaderStartup -Dtests.seed=E30A144FF13D52E7 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-SA -Dtests.timezone=NZ-CHAT -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   33.4s J0 | TestCloudSearcherWarming.testRepFactor1LeaderStartup <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: jetty count:0
   [junit4]    > null
   [junit4]    > Live Nodes: [127.0.0.1:44315_solr]
   [junit4]    > Last available state: DocCollection(testRepFactor1LeaderStartup//collections/testRepFactor1LeaderStartup/state.json/4)={
   [junit4]    >   "pullReplicas":"0",
   [junit4]    >   "replicationFactor":"1",
   [junit4]    >   "shards":{"shard1":{
   [junit4]    >       "range":"80000000-7fffffff",
   [junit4]    >       "state":"active",
   [junit4]    >       "replicas":{"core_node2":{
   [junit4]    >           "core":"testRepFactor1LeaderStartup_shard1_replica_n1",
   [junit4]    >           "base_url":"http://127.0.0.1:44315/solr",
   [junit4]    >           "node_name":"127.0.0.1:44315_solr",
   [junit4]    >           "state":"active",
   [junit4]    >           "type":"NRT",
   [junit4]    >           "force_set_state":"false",
   [junit4]    >           "leader":"true"}}}},
   [junit4]    >   "router":{"name":"compositeId"},
   [junit4]    >   "maxShardsPerNode":"1",
   [junit4]    >   "autoAddReplicas":"false",
   [junit4]    >   "nrtReplicas":"1",
   [junit4]    >   "tlogReplicas":"0"}
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase.waitForState(SolrCloudTestCase.java:283)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase.waitForState(SolrCloudTestCase.java:261)
   [junit4]    > 	at org.apache.solr.cloud.TestCloudSearcherWarming.testRepFactor1LeaderStartup(TestCloudSearcherWarming.java:117)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)Throwable #2: org.apache.solr.client.solrj.SolrServerException: No live SolrServers available to handle this request
   [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:461)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1107)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
   [junit4]    > 	at org.apache.solr.cloud.MiniSolrCloudCluster.deleteAllCollections(MiniSolrCloudCluster.java:508)
   [junit4]    > 	at org.apache.solr.cloud.TestCloudSearcherWarming.tearDown(TestCloudSearcherWarming.java:78)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}
Test: NodeLostTriggerTest#testListenerAcceptance
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=NodeLostTriggerTest -Dtests.method=testListenerAcceptance -Dtests.seed=E30A144FF13D52E7 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=fr-CH -Dtests.timezone=ART -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 0.20s J0 | NodeLostTriggerTest.testListenerAcceptance <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<1> but was:<0>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([E30A144FF13D52E7:F2BE4EA848B44611]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.NodeLostTriggerTest.testListenerAcceptance(NodeLostTriggerTest.java:265)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}
Test: NodeLostTriggerTest#testTrigger
{code:java}
reproduce with: ant test  -Dtestcase=NodeLostTriggerTest -Dtests.method=testTrigger -Dtests.seed=E30A144FF13D52E7 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=fr-CH -Dtests.timezone=ART -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 2.04s J0 | NodeLostTriggerTest.testTrigger <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: [127.0.0.1:40385_solr] doesn't contain 127.0.0.1:45145_solr
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([E30A144FF13D52E7:80C122CD68F221CA]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.NodeLostTriggerTest.testTrigger(NodeLostTriggerTest.java:117)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

Test:TestAuthenticationFramework#testBasics
{code:java}
reproduce with: ant test  -Dtestcase=TestAuthenticationFramework -Dtests.method=testBasics -Dtests.seed=D3D81D8F48AFF8C -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=de-LU -Dtests.timezone=PRT -Dtests.asserts=true -Dtests.file.encoding=UTF-8
09:52:10    [junit4] ERROR   7.23s J0 | TestAuthenticationFramework.testBasics <<<
09:52:10    [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at https://127.0.0.1:39937/solr/testcollection_shard1_replica_n3: Expected mime type application/octet-stream but got text/html. <html>
09:52:10    [junit4]    > <head>
09:52:10    [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
09:52:10    [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n3/update</title>
09:52:10    [junit4]    > </head>
09:52:10    [junit4]    > <body><h2>HTTP ERROR 404</h2>
09:52:10    [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n3/update. Reason:
09:52:10    [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n3/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
09:52:10    [junit4]    > </body>
09:52:10    [junit4]    > </html>
09:52:10    [junit4]    > 	at __randomizedtesting.SeedInfo.seed([D3D81D8F48AFF8C:30E52FF4CC64A1FC]:0)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
09:52:10    [junit4]    > 	at org.apache.solr.cloud.TestAuthenticationFramework.collectionCreateSearchDeleteTwice(TestAuthenticationFramework.java:128)
09:52:10    [junit4]    > 	at org.apache.solr.cloud.TestAuthenticationFramework.testBasics(TestAuthenticationFramework.java:75)
09:52:10    [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
09:52:10    [junit4]    > Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:39937/solr/testcollection_shard1_replica_n3: Expected mime type application/octet-stream but got text/html. <html>
09:52:10    [junit4]    > <head>
09:52:10    [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
09:52:10    [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n3/update</title>
09:52:10    [junit4]    > </head>
09:52:10    [junit4]    > <body><h2>HTTP ERROR 404</h2>
09:52:10    [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n3/update. Reason:
09:52:10    [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n3/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
09:52:10    [junit4]    > </body>
09:52:10    [junit4]    > </html>
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
09:52:10    [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
09:52:10    [junit4]    > 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
09:52:10    [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
09:52:10    [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
09:52:10    [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
09:52:10    [junit4]    > 	... 1 more{code}

I checked all the reproduce with lines and was not able to reproduce the failures for the failures I posted. For the record I've run 20 runs and 5 have succeeded. I didn't post all the failures since many were the same. I'll keep running the tests to see if anything else falls out.

I had two clean runs, starting again with ten.

Tests are taking about 60m each, with almost every other run succeeding.

Failure: testSqlStream
{code:java}
junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=StreamExpressionTest -Dtests.method=testSqlStream -Dtests.seed=88A53CC5725063FF -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=de-LU -Dtests.timezone=Atlantic/South_Georgia -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   30.1s J2 | StreamExpressionTest.testSqlStream <<<
   [junit4]    > Throwable #1: java.io.IOException: params qt=/stream&expr=sql(collection1,+stmt%3D"select+id+from+collection1+order+by+a_i+asc")
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([88A53CC5725063FF:87631551033B6329]:0)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.SolrStream.open(SolrStream.java:111)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.StreamExpressionTest.getTuples(StreamExpressionTest.java:2475)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.StreamExpressionTest.testSqlStream(StreamExpressionTest.java:254)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    > Caused by: org.apache.solr.client.solrj.SolrServerException: Timeout occured while waiting response from server at: http://127.0.0.1:55522/solr/collection1_collection_shard2_replica_n2
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:654)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrClient.request(SolrClient.java:1260)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.SolrStream.constructParser(SolrStream.java:263)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.SolrStream.open(SolrStream.java:109)
   [junit4]    > 	... 41 more
   [junit4]    > Caused by: java.net.SocketTimeoutException: Read timed out
   [junit4]    > 	at java.net.SocketInputStream.socketRead0(Native Method)
   [junit4]    > 	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
   [junit4]    > 	at java.net.SocketInputStream.read(SocketInputStream.java:171)
   [junit4]    > 	at java.net.SocketInputStream.read(SocketInputStream.java:141)
   [junit4]    > 	at org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137)
   [junit4]    > 	at org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153)
   [junit4]    > 	at org.apache.http.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:282)
   [junit4]    > 	at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:138)
   [junit4]    > 	at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:56)
   [junit4]    > 	at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:259)
   [junit4]    > 	at org.apache.http.impl.DefaultBHttpClientConnection.receiveResponseHeader(DefaultBHttpClientConnection.java:163)
   [junit4]    > 	at org.apache.http.impl.conn.CPoolProxy.receiveResponseHeader(CPoolProxy.java:165)
   [junit4]    > 	at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:273)
   [junit4]    > 	at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:125)
   [junit4]    > 	at org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)
   [junit4]    > 	at org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:185)
   [junit4]    > 	at org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)
   [junit4]    > 	at org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:111)
   [junit4]    > 	at org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)
   [junit4]    > 	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:83)
   [junit4]    > 	at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:56)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:542)
   [junit4]    > 	... 46 more
   [junit4]   1> 09:38:15.960 [qtp1722635893-3497] ERROR org.apache.solr.client.solrj.io.stream.ExceptionStream - java.io.IOException: org.apache.solr.common.SolrException: Collection not found: myCollection
   [junit4]   1> 	at org.apache.solr.client.solrj.io.stream.StatsStream.open(StatsStream.java:217)
   [junit4]   1> 	at org.apache.solr.client.solrj.io.stream.ExceptionStream.open(ExceptionStream.java:54)
   [junit4]   1> 	at org.apache.solr.handler.StreamHandler$TimerStream.open(StreamHandler.java:394)
   [junit4]   1> 	at org.apache.solr.client.solrj.io.stream.TupleStream.writeMap(TupleStream.java:78)
   [junit4]   1> 	at org.apache.solr.common.util.JsonTextWriter.writeMap(JsonTextWriter.java:164)
   [junit4]   1> 	at org.apache.solr.common.util.TextWriter.writeVal(TextWriter.java:69)
   [junit4]   1> 	at org.apache.solr.response.TextResponseWriter.writeVal(TextResponseWriter.java:152)
   [junit4]   1> 	at org.apache.solr.common.util.JsonTextWriter.writeNamedListAsMapWithDups(JsonTextWriter.java:386)
   [junit4]   1> 	at org.apache.solr.common.util.JsonTextWriter.writeNamedList(JsonTextWriter.java:292)
   [junit4]   1> 	at org.apache.solr.response.JSONWriter.writeResponse(JSONWriter.java:73)
   [junit4]   1> 	at org.apache.solr.response.JSONResponseWriter.write(JSONResponseWriter.java:66)
   [junit4]   1> 	at org.apache.solr.response.QueryResponseWriterUtil.writeQueryResponse(QueryResponseWriterUtil.java:65)
   [junit4]   1> 	at org.apache.solr.servlet.HttpSolrCall.writeResponse(HttpSolrCall.java:787)
   [junit4]   1> 	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:524)
   [junit4]   1> 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:395)
   [junit4]   1> 	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:341)
   [junit4]   1> 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642)
   [junit4]   1> 	at org.apache.solr.client.solrj.embedded.JettySolrRunner$DebugFilter.doFilter(JettySolrRunner.java:143)
   [junit4]   1> 	at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642)
   [junit4]   1> 	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255)
   [junit4]   1> 	at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1317)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203)
   [junit4]   1> 	at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473)
   [junit4]   1> 	at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1219)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:674)
   [junit4]   1> 	at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)
   [junit4]   1> 	at org.eclipse.jetty.server.Server.handle(Server.java:531)
   [junit4]   1> 	at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:352)
   [junit4]   1> 	at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260)
   [junit4]   1> 	at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:281)
   [junit4]   1> 	at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102)
   [junit4]   1> 	at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:762)
   [junit4]   1> 	at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:680)
   [junit4]   1> 	at java.lang.Thread.run(Thread.java:745)
   [junit4]   1> Caused by: org.apache.solr.common.SolrException: Collection not found: myCollection
   [junit4]   1> 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:851)
   [junit4]   1> 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]   1> 	at org.apache.solr.client.solrj.io.stream.StatsStream.open(StatsStream.java:214)
   [junit4]   1> 	... 45 more
   [junit4]   1> 
   [junit4]   1> 09:38:16.357 [SUITE-StreamExpressionTest-seed#[88A53CC5725063FF]-worker] ERROR org.apache.zookeeper.server.ZooKeeperServer - ZKShutdownHandler is not registered, so ZooKeeper server won't take any action on ERROR or SHUTDOWN server state changes
   [junit4]   2> NOTE: leaving temporary files on disk at: /Users/elizabethhaubert/Solr/badapples-fix/lucene-solr/solr/build/solr-solrj/test/J2/temp/solr.client.solrj.io.stream.StreamExpressionTest_88A53CC5725063FF-001
   [junit4]   2> Oct 31, 2018 9:38:16 AM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks
   [junit4]   2> WARNING: Will linger awaiting termination of 1 leaked thread(s).
   [junit4]   2> NOTE: test params are: codec=Lucene70, sim=RandomSimilarity(queryNorm=true): {}, locale=de-LU, timezone=Atlantic/South_Georgia
   [junit4]   2> NOTE: Mac OS X 10.13.6 x86_64/Oracle Corporation 1.8.0_121 (64-bit)/cpus=4,threads=1,free=126676528,total=410517504
   [junit4]   2> NOTE: All tests run in this JVM: [UniformDistributionEvaluatorTest, TestBatchUpdate, ArcSineEvaluatorTest, TestRetryUtil, SolrExampleStreamingTest, TestHash, MathExpressionTest, TestCollectionStateWatchers, LengthEvaluatorTest, TestLBHttpSolrClient, TermsResponseTest, PowerEvaluatorTest, GreaterThanEqualToEvaluatorTest, StreamingTest, ConcurrentUpdateSolrClientTest, LargeVolumeBinaryJettyTest, CommonAdminParamsTest, JdbcDriverTest, TestToleratedUpdateError, TestValidatingJsonMap, HttpSolrClientBadInputTest, GetByIdTest, NotEvaluatorTest, ConcurrentUpdateSolrClientBadInputTest, CloudSolrClientBuilderTest, TestSolrJsonWriter, StreamExpressionTest]
{code}

[~hossman], I've seen the DistribCursorPagingTest failure above too FYI.  Correct me if I'm wrong, but I remember you as the authority on that feature.

bq. Test: DistribCursorPagingTest

...i can't reproduce and there is no obvious indicationg that it is a problem with the cursor or the test (it's failing when comparing he distributed facet counts with the single node facet counts) i've spun off into SOLR-12946 .. logs there would be helpful.

Adding the commit hash since I know you are updating the PR. First failure out of 3 builds on the new commit so far :)

Commit: 88c37601f01c6fe5e508073f57dd2508ebed9a4b
Test: AutoAddReplicasPlanActionTest#testSimple
{code:java}
reproduce with: ant test  -Dtestcase=AutoAddReplicasPlanActionTest -Dtests.method=testSimple -Dtests.seed=ED45ACA1F83399DB -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ga -Dtests.timezone=Canada/Pacific -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   57.2s J5 | AutoAddReplicasPlanActionTest.testSimple <<<
   [junit4]    > Throwable #1: java.util.concurrent.TimeoutException
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([ED45ACA1F83399DB:D5F6885FDFC04D0A]:0)
   [junit4]    > 	at org.apache.solr.common.cloud.ZkStateReader.waitForState(ZkStateReader.java:1512)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.AutoAddReplicasPlanActionTest.waitForNodeLeave(AutoAddReplicasPlanActionTest.java:188)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.AutoAddReplicasPlanActionTest.testSimple(AutoAddReplicasPlanActionTest.java:181)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

Commit: 88c37601f01c6fe5e508073f57dd2508ebed9a4b
Test: OverseerTest#testDoubleAssignment
{code:java}
reproduce with: ant test  -Dtestcase=OverseerTest -Dtests.method=testDoubleAssignment -Dtests.seed=9E1068EDAF5AF7A5 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-PA -Dtests.timezone=Pacific/Ponape -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   17.7s J3 | OverseerTest.testDoubleAssignment <<<
   [junit4]    > Throwable #1: java.util.concurrent.TimeoutException
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([9E1068EDAF5AF7A5:DE553B06E407E2F3]:0)
   [junit4]    > 	at org.apache.solr.common.cloud.ZkStateReader.waitForState(ZkStateReader.java:1512)
   [junit4]    > 	at org.apache.solr.cloud.OverseerTest.testDoubleAssignment(OverseerTest.java:987)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

Commit: 88c37601f01c6fe5e508073f57dd2508ebed9a4b
Test:TestCollectionsAPIViaSolrCloudCluster#testCollectionCreateSearchDelete
{code:java}
reproduce with: ant test  -Dtestcase=TestCollectionsAPIViaSolrCloudCluster -Dtests.method=testCollectionCreateSearchDelete -Dtests.seed=91B211642503876A -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ga -Dtests.timezone=Africa/Kinshasa -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   9.16s J3 | TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete <<<
   [junit4]    > Throwable #1: org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at http://127.0.0.1:42289/solr/testcollection_shard1_replica_n3: Expected mime type application/octet-stream but got text/html. <html>
   [junit4]    > <head>
   [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n3/update</title>
   [junit4]    > </head>
   [junit4]    > <body><h2>HTTP ERROR 404</h2>
   [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n3/update. Reason:
   [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n3/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
   [junit4]    > </body>
   [junit4]    > </html>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([91B211642503876A:3248BFC1A2EB6DCF]:0)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
   [junit4]    > 	at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
   [junit4]    > 	at org.apache.solr.cloud.api.collections.TestCollectionsAPIViaSolrCloudCluster.testCollectionCreateSearchDelete(TestCollectionsAPIViaSolrCloudCluster.java:181)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:42289/solr/testcollection_shard1_replica_n3: Expected mime type application/octet-stream but got text/html. <html>
   [junit4]    > <head>
   [junit4]    > <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
   [junit4]    > <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n3/update</title>
   [junit4]    > </head>
   [junit4]    > <body><h2>HTTP ERROR 404</h2>
   [junit4]    > <p>Problem accessing /solr/testcollection_shard1_replica_n3/update. Reason:
   [junit4]    > <pre>    Can not find: /solr/testcollection_shard1_replica_n3/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>
   [junit4]    > </body>
   [junit4]    > </html>
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
   [junit4]    > 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
   [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    > 	... 1 more{code}

Different kind of failure since there was a stall.

Commit: 88c37601f01c6fe5e508073f57dd2508ebed9a4b

Test: TestSimTriggerIntegration#testListeners
{code:java}
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:38:04, stalled for 1327s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:39:04, stalled for 1387s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:40:04, stalled for 1447s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:41:04, stalled for 1507s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:42:04, stalled for 1567s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:43:04, stalled for 1627s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:44:04, stalled for 1687s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:45:04, stalled for 1747s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:46:04, stalled for 1807s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:47:04, stalled for 1867s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:48:04, stalled for 1927s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:49:04, stalled for 1987s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:50:04, stalled for 2047s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:51:04, stalled for 2107s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:52:04, stalled for 2167s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:53:04, stalled for 2227s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:54:04, stalled for 2287s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:55:04, stalled for 2347s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:56:04, stalled for 2407s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:57:04, stalled for 2467s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:58:04, stalled for 2527s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T22:59:04, stalled for 2587s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:00:04, stalled for 2647s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:01:04, stalled for 2707s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:02:04, stalled for 2767s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:03:04, stalled for 2827s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:04:04, stalled for 2887s at: TestSimTriggerIntegration.testListeners
   [junit4] HEARTBEAT J2 PID(480@f7bc5a140d51): 2018-10-31T23:05:04, stalled for 2947s at: TestSimTriggerIntegration.testListeners
Build timed out (after 55 minutes). Marking the build as failed.
{code}

New commit hash failure but looks like there is already a commit to handle this that wasn't in this run. New commit should get picked up in next test run.

Commit: 7fcd15843fed53ba7ce7ba8c2f1bf0d030d272f8

Test: NodeMarkersRegistrationTest#testNodeMarkersRegistration
{code:java}
reproduce with: ant test  -Dtestcase=NodeMarkersRegistrationTest -Dtests.method=testNodeMarkersRegistration -Dtests.seed=E9977750024DB50B -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-MX -Dtests.timezone=Pacific/Ponape -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 0.25s J2 | NodeMarkersRegistrationTest.testNodeMarkersRegistration <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<1> but was:<0>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([E9977750024DB50B:F12DFF5C0C7878E4]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.NodeMarkersRegistrationTest.testNodeMarkersRegistration(NodeMarkersRegistrationTest.java:113)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}

I saw a stall a week or so ago running locally. Don't recall if it was the same test however.

ant -Dtests.jvms=28 clean test on

e8503da7c43b8ff3eb968c631ca2ac718a2c736b (branch_7x) with [https://github.com/apache/lucene-solr/pull/486]

[junit4] Tests with failures [seed: 6E4D8DC6298FB62F]:
 [junit4] - org.apache.solr.cloud.TestAuthenticationFramework.testBasics
 [junit4] - org.apache.solr.cloud.api.collections.CollectionsAPIDistributedZkTest.testCollectionsAPI

 

testBasics (similar to [~risdenk]'s above):
{code:none}
Error from server at http://127.0.0.1:35483/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html> <head> <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/> <title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title> </head> <body><h2>HTTP ERROR 404</h2> <p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason: <pre> Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/> </body> </html>

org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at http://127.0.0.1:35483/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
</head>
<body><h2>HTTP ERROR 404</h2>
<p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
<pre> Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>

</body>
</html>

at __randomizedtesting.SeedInfo.seed([6E4D8DC6298FB62F:539523EA1161E85F]:0)
at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
at org.apache.solr.cloud.TestAuthenticationFramework.collectionCreateSearchDeleteTwice(TestAuthenticationFramework.java:128)
at org.apache.solr.cloud.TestAuthenticationFramework.testBasics(TestAuthenticationFramework.java:75)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1742)
at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:935)
at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:971)
at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:985)
at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)
at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:944)
at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:830)
at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:880)
at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:891)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:35483/solr/testcollection_shard1_replica_n2: Expected mime type application/octet-stream but got text/html. <html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<title>Error 404 Can not find: /solr/testcollection_shard1_replica_n2/update</title>
</head>
<body><h2>HTTP ERROR 404</h2>
<p>Problem accessing /solr/testcollection_shard1_replica_n2/update. Reason:
<pre> Can not find: /solr/testcollection_shard1_replica_n2/update</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.11.v20180605</a><hr/>

</body>
</html>

at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
at java.util.concurrent.FutureTask.run(FutureTask.java:266)
at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
... 1 more
{code}
testCollectionsApi:
{code:none}
Error from server at http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1: ClusterState says we are the leader (http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1), but locally we don't think so. Request came from null

org.apache.solr.client.solrj.impl.CloudSolrClient$RouteException: Error from server at http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1: ClusterState says we are the leader (http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1), but locally we don't think so. Request came from null
at __randomizedtesting.SeedInfo.seed([6E4D8DC6298FB62F:2638F9722FBC99BA]:0)
at org.apache.solr.client.solrj.impl.CloudSolrClient.directUpdate(CloudSolrClient.java:551)
at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1016)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:949)
at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
at org.apache.solr.client.solrj.request.UpdateRequest.commit(UpdateRequest.java:237)
at org.apache.solr.cloud.api.collections.CollectionsAPIDistributedZkTest.testCollectionsAPI(CollectionsAPIDistributedZkTest.java:469)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1742)
at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:935)
at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:971)
at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:985)
at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
at com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:817)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:468)
at com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:944)
at com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:830)
at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:880)
at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:891)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
at java.lang.Thread.run(Thread.java:748)
Caused by: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1: ClusterState says we are the leader (http://127.0.0.1:36137/solr/awhollynewcollection_0_shard1_replica_n1), but locally we don't think so. Request came from null
at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:643)
at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:484)
at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:414)
at org.apache.solr.client.solrj.impl.CloudSolrClient.lambda$directUpdate$0(CloudSolrClient.java:528)
at java.util.concurrent.FutureTask.run(FutureTask.java:266)
at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
... 1 more
	3.718
{code}

Only 3 failures in the last 10 runs on commit 8e0733bc99544da01e9e115c1b28a2a7b9c380d4. Two failures are the same type.

Two related failures on this run

Commit: 8e0733bc99544da01e9e115c1b28a2a7b9c380d4

Test: ChaosMonkeyNothingIsSafeTest#test
{code:java}
reproduce with: ant test -Dtestcase=ChaosMonkeyNothingIsSafeTest -Dtests.method=test -Dtests.seed=8A09DAB62DBF4345 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-MX -Dtests.timezone=Europe/London -Dtests.asserts=true -Dtests.file.encoding=UTF-8 [junit4] FAILURE 34.7s J0 | ChaosMonkeyNothingIsSafeTest.test <<< [junit4] > Throwable #1: java.lang.AssertionError: document count mismatch. control=1560 sum(shards)=750 cloudClient=750 [junit4] > at __randomizedtesting.SeedInfo.seed([8A09DAB62DBF4345:25DE56C83432EBD]:0) [junit4] > at org.apache.solr.cloud.AbstractFullDistribZkTestBase.checkShardConsistency(AbstractFullDistribZkTestBase.java:1396) [junit4] > at org.apache.solr.cloud.ChaosMonkeyNothingIsSafeTest.test(ChaosMonkeyNothingIsSafeTest.java:240) [junit4] > at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1065) [junit4] > at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:1039) [junit4] > at java.lang.Thread.run(Thread.java:748)
{code}
{code:java}
 reproduce with: ant test  -Dtestcase=ChaosMonkeyNothingIsSafeTest -Dtests.seed=8A09DAB62DBF4345 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-MX -Dtests.timezone=Europe/London -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.00s J0 | ChaosMonkeyNothingIsSafeTest (suite) <<<
   [junit4]    > Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 8 threads leaked from SUITE scope at org.apache.solr.cloud.ChaosMonkeyNothingIsSafeTest: 
   [junit4]    >    1) Thread[id=6981, name=zkCallback-1984-thread-4, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=6885, name=zkCallback-1984-thread-2, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    3) Thread[id=6792, name=zkConnectionManagerCallback-1985-thread-1, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    4) Thread[id=6878, name=watches-1982-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    5) Thread[id=6817, name=zkCallback-1984-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    6) Thread[id=6960, name=zkCallback-1984-thread-3, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    7) Thread[id=6790, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[8A09DAB62DBF4345]-SendThread(127.0.0.1:34569), state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1054)
   [junit4]    >    8) Thread[id=6791, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[8A09DAB62DBF4345]-EventThread, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:502)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([8A09DAB62DBF4345]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:
   [junit4]    >    1) Thread[id=6981, name=zkCallback-1984-thread-4, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=6885, name=zkCallback-1984-thread-2, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    3) Thread[id=6792, name=zkConnectionManagerCallback-1985-thread-1, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    4) Thread[id=6878, name=watches-1982-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    5) Thread[id=6817, name=zkCallback-1984-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    6) Thread[id=6960, name=zkCallback-1984-thread-3, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    7) Thread[id=6790, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[8A09DAB62DBF4345]-SendThread(127.0.0.1:34569), state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:105)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1000)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1063)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([8A09DAB62DBF4345]:0){code}
Reference: risdenk/nuc#56

Commit: 8e0733bc99544da01e9e115c1b28a2a7b9c380d4

Test: AutoAddReplicasIntegrationTest#testSimple
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=AutoAddReplicasIntegrationTest -Dtests.method=testSimple -Dtests.seed=E73476C72BD62F1 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=zh-HK -Dtests.timezone=Australia/Hobart -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 68.1s J3 | AutoAddReplicasIntegrationTest.testSimple <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: Waiting for collection testSimple2
   [junit4]    > null
   [junit4]    > Live Nodes: [127.0.0.1:35447_solr, 127.0.0.1:43523_solr]
   [junit4]    > Last available state: DocCollection(testSimple2//collections/testSimple2/state.json/29)={
   [junit4]    >   "pullReplicas":"0",
   [junit4]    >   "replicationFactor":"2",
   [junit4]    >   "shards":{
   [junit4]    >     "shard1":{
   [junit4]    >       "range":"80000000-ffffffff",
   [junit4]    >       "state":"active",
   [junit4]    >       "replicas":{
   [junit4]    >         "core_node3":{
   [junit4]    >           "core":"testSimple2_shard1_replica_n1",
   [junit4]    >           "base_url":"http://127.0.0.1:43235/solr",
   [junit4]    >           "node_name":"127.0.0.1:43235_solr",
   [junit4]    >           "state":"down",
   [junit4]    >           "type":"NRT",
   [junit4]    >           "force_set_state":"false"},
   [junit4]    >         "core_node5":{
   [junit4]    >           "core":"testSimple2_shard1_replica_n2",
   [junit4]    >           "base_url":"http://127.0.0.1:35447/solr",
   [junit4]    >           "node_name":"127.0.0.1:35447_solr",
   [junit4]    >           "state":"active",
   [junit4]    >           "type":"NRT",
   [junit4]    >           "force_set_state":"false",
   [junit4]    >           "leader":"true"},
   [junit4]    >         "core_node12":{
   [junit4]    >           "core":"testSimple2_shard1_replica_n11",
   [junit4]    >           "base_url":"http://127.0.0.1:35447/solr",
   [junit4]    >           "state":"down",
   [junit4]    >           "node_name":"127.0.0.1:35447_solr",
   [junit4]    >           "type":"NRT"}}},
   [junit4]    >     "shard2":{
   [junit4]    >       "range":"0-7fffffff",
   [junit4]    >       "state":"active",
   [junit4]    >       "replicas":{
   [junit4]    >         "core_node8":{
   [junit4]    >           "core":"testSimple2_shard2_replica_n6",
   [junit4]    >           "base_url":"http://127.0.0.1:35447/solr",
   [junit4]    >           "node_name":"127.0.0.1:35447_solr",
   [junit4]    >           "state":"active",
   [junit4]    >           "type":"NRT",
   [junit4]    >           "force_set_state":"false",
   [junit4]    >           "leader":"true"},
   [junit4]    >         "core_node10":{
   [junit4]    >           "core":"testSimple2_shard2_replica_n9",
   [junit4]    >           "base_url":"http://127.0.0.1:35447/solr",
   [junit4]    >           "node_name":"127.0.0.1:35447_solr",
   [junit4]    >           "state":"active",
   [junit4]    >           "type":"NRT",
   [junit4]    >           "force_set_state":"false"}}}},
   [junit4]    >   "router":{"name":"compositeId"},
   [junit4]    >   "maxShardsPerNode":"2",
   [junit4]    >   "autoAddReplicas":"true",
   [junit4]    >   "nrtReplicas":"2",
   [junit4]    >   "tlogReplicas":"0"}
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([E73476C72BD62F1:36C06392554EB620]:0)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase.waitForState(SolrCloudTestCase.java:283)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.AutoAddReplicasIntegrationTest.testSimple(AutoAddReplicasIntegrationTest.java:136)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
{code}
Reference: risdenk/nuc#57

Two failures related again.

Commit: 8e0733bc99544da01e9e115c1b28a2a7b9c380d4

Test: ChaosMonkeyNothingIsSafeTest#test
{code:java}
reproduce with: ant test  -Dtestcase=ChaosMonkeyNothingIsSafeTest -Dtests.method=test -Dtests.seed=CD85E598152C3D2F -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-BH -Dtests.timezone=US/Aleutian -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 26.9s J0 | ChaosMonkeyNothingIsSafeTest.test <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: document count mismatch.  control=1886 sum(shards)=943 cloudClient=943
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([CD85E598152C3D2F:45D1DA42BBD050D7]:0)
   [junit4]    > 	at org.apache.solr.cloud.AbstractFullDistribZkTestBase.checkShardConsistency(AbstractFullDistribZkTestBase.java:1396)
   [junit4]    > 	at org.apache.solr.cloud.ChaosMonkeyNothingIsSafeTest.test(ChaosMonkeyNothingIsSafeTest.java:240)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1065)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:1039)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
{code}
{code:java}
reproduce with: ant test  -Dtestcase=ChaosMonkeyNothingIsSafeTest -Dtests.seed=CD85E598152C3D2F -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ar-BH -Dtests.timezone=US/Aleutian -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.00s J0 | ChaosMonkeyNothingIsSafeTest (suite) <<<
   [junit4]    > Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 9 threads leaked from SUITE scope at org.apache.solr.cloud.ChaosMonkeyNothingIsSafeTest: 
   [junit4]    >    1) Thread[id=10235, name=zkCallback-2682-thread-4, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=10230, name=zkCallback-2682-thread-3, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    3) Thread[id=10066, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[CD85E598152C3D2F]-EventThread, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:502)
   [junit4]    >    4) Thread[id=10065, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[CD85E598152C3D2F]-SendThread(127.0.0.1:45103), state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:105)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1000)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1063)
   [junit4]    >    5) Thread[id=10192, name=watches-2680-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    6) Thread[id=10287, name=zkCallback-2682-thread-5, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    7) Thread[id=10069, name=zkCallback-2682-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    8) Thread[id=10067, name=zkConnectionManagerCallback-2683-thread-1, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    9) Thread[id=10222, name=zkCallback-2682-thread-2, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([CD85E598152C3D2F]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:
   [junit4]    >    1) Thread[id=10235, name=zkCallback-2682-thread-4, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=10230, name=zkCallback-2682-thread-3, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    3) Thread[id=10065, name=TEST-ChaosMonkeyNothingIsSafeTest.test-seed#[CD85E598152C3D2F]-SendThread(127.0.0.1:45103), state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1054)
   [junit4]    >    4) Thread[id=10192, name=watches-2680-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    5) Thread[id=10287, name=zkCallback-2682-thread-5, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    6) Thread[id=10069, name=zkCallback-2682-thread-1, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    7) Thread[id=10067, name=zkConnectionManagerCallback-2683-thread-1, state=WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    8) Thread[id=10222, name=zkCallback-2682-thread-2, state=TIMED_WAITING, group=TGRP-ChaosMonkeyNothingIsSafeTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([CD85E598152C3D2F]:0){code}
Reference: risdenk/nuc#59

Am I running it right? I'm surprised that we aren't seeing some of the recurring errors, e.g. IndexSizeTriggerTest, but here are three from my runs anyway:
{code:java}
 [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestSimLargeCluster -Dtests.method=testBasic -Dtests.seed=D06F4E22358339D2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sl-SI -Dtests.timezone=Pacific/Tongatapu -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 7.43s J3 | TestSimLargeCluster.testBasic <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: there should be less than flakyReplicas=10 MOVEREPLICA ops
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([D06F4E22358339D2:7B955337EA5FBFFC]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.sim.TestSimLargeCluster.testBasic(TestSimLargeCluster.java:280)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   2> 1261841 INFO  (TEST-TestSimLargeCluster.testNodeLost-seed#[D06F4E22358339D2]) [    ] o.a.s.SolrTestCaseJ4 ###Starting testNodeLost
   [junit4
{code}
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=IndexSizeTriggerTest -Dtests.method=testMixedBounds -Dtests.seed=D06F4E22358339D2 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sr-BA -Dtests.timezone=America/Indiana/Winamac -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 54.1s J2 | IndexSizeTriggerTest.testMixedBounds <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<MERGESHARDS> but was:<SPLITSHARD>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([D06F4E22358339D2:DAECF18F78383288]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.IndexSizeTriggerTest.testMixedBounds(IndexSizeTriggerTest.java:673)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
{code}
{code:java}
 2> NOTE: reproduce with: ant test  -Dtestcase=HttpPartitionTest -Dtests.method=test -Dtests.seed=719484666306ADC1 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ga-IE -Dtests.timezone=Asia/Dili -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 55.0s J1 | HttpPartitionTest.test <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: Doc with id=2 not found in http://127.0.0.1:60505/c8n_1x2_leader_session_loss due to: Path not found: /id; rsp={doc=null}
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([719484666306ADC1:F9C0BBBCCDFAC039]:0)
   [junit4]    > 	at org.apache.solr.cloud.HttpPartitionTest.assertDocExists(HttpPartitionTest.java:622)
   [junit4]    > 	at org.apache.solr.cloud.HttpPartitionTest.assertDocsExistInAllReplicas(HttpPartitionTest.java:567)
   [junit4]    > 	at org.apache.solr.cloud.HttpPartitionTest.testLeaderZkSessionLoss(HttpPartitionTest.java:522)
   [junit4]    > 	at org.apache.solr.cloud.HttpPartitionTest.test(HttpPartitionTest.java:159)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1066)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:1040)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
{code}

[~erickerickson] this is how I setup my local jenkins to run it. Workspace is cleared since this is executed on transient docker containers. ivysettings.xml is just to use my local maven cache.
{code:java}
git init /home/jenkins/agent/workspace/apache-solr-markmiller-test
git config remote.origin.url https://github.com/apache/lucene-solr
git fetch --no-tags origin pull/486/head:pr-486
git checkout pr-486
git rev-parse HEAD
ant ivy-bootstrap -Divysettings.xml=/home/jenkins/.ivy2/ivysettings.xml
cd solr
ant test -Divysettings.xml=/home/jenkins/.ivy2/ivysettings.xml
{code}
This sets up git in a folder, fetches the pr branch, checks it out, prints the hash (so I can see which commit it was against later), run ivy-bootstrap, cd solr, and run ant test.

[~erickerickson], make sure you update to the latest as well - I'm pushing to that pull request.

bq. ChaosMonkeyNothingIsSafeTest

I've seen that too - not very common, but look like possible data loss bug, so I have not disabled it and probably won't.

[~risdenk] My question is more whether we should just be running plain "ant test". I'd expect to see things like the IndexSizeTriggerTest fail for others. I know that test, for instance, is getting active attention. It seems to be a bear to figure out how to fix though. Don't want to flood Mark with extraneous junk.

Thanks for the steps though, I was a little nervous about the fact that I had a compilation error when I applied the patch, so I'll give your process a shot. So far the compile step didn't fail.

 

[~markrmiller@gmail.com] This brings the problems I reported this morning into question, probably should ignore them and/or delete the comment,

 

So there have been two failures in the last 15 runs. I know there have been commits to the PR so posting the two failures with commits that they were run against.

Two failures associated with this run.

Commit: a092f1a79edbf0092f96155414215b443363c2fb

Test: ExecutePlanActionTest#testIntegration
{code:java}
NOTE: reproduce with: ant test  -Dtestcase=ExecutePlanActionTest -Dtests.method=testIntegration -Dtests.seed=DBF7318E39CB980F -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=he-IL -Dtests.timezone=Africa/Juba -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 2.92s J3 | ExecutePlanActionTest.testIntegration <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<2> but was:<1>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([DBF7318E39CB980F:6B963FA21CF4392A]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.ExecutePlanActionTest.testIntegration(ExecutePlanActionTest.java:224)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748) {code}
{code:java}
reproduce with: ant test  -Dtestcase=NodeLostTriggerTest -Dtests.method=testListenerAcceptance -Dtests.seed=DBF7318E39CB980F -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sr-Latn-ME -Dtests.timezone=America/Iqaluit -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 0.31s J1 | NodeLostTriggerTest.testListenerAcceptance <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: expected:<1> but was:<0>
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([DBF7318E39CB980F:CA436B6980428CF9]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.NodeLostTriggerTest.testListenerAcceptance(NodeLostTriggerTest.java:265)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}
Reference: risdenk/nuc#65

Commit: af0d46ac4c7f2c3975a539b69de011c02538f361

Test: TestSystemCollAutoCreate#testAutoCreate
{code:java}
reproduce with: ant test  -Dtestcase=TestSystemCollAutoCreate -Dtests.method=testAutoCreate -Dtests.seed=FEB73B4EC4B46883 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sl-SI -Dtests.timezone=America/Tortola -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 32.7s J1 | TestSystemCollAutoCreate.testAutoCreate <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: Could not successfully add blob after 150 attempts. Expecting 2 items. time elapsed 15,499  output  for url is {
   [junit4]    >   "responseHeader":{
   [junit4]    >     "zkConnected":true,
   [junit4]    >     "status":0,
   [junit4]    >     "QTime":0},
   [junit4]    >   "response":{
   [junit4]    >     "numFound":1,
   [junit4]    >     "start":0,
   [junit4]    >     "docs":[{
   [junit4]    >         "id":"test/1",
   [junit4]    >         "md5":"710177b50a8305661e0d0918ebf14e0a",
   [junit4]    >         "blobName":"test",
   [junit4]    >         "version":1,
   [junit4]    >         "timestamp":"2018-11-01T21:07:34.341Z",
   [junit4]    >         "size":2048}]}}
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([FEB73B4EC4B46883:C1EC8F9F72CAA1EE]:0)
   [junit4]    > 	at org.apache.solr.handler.TestBlobHandler.postAndCheck(TestBlobHandler.java:140)
   [junit4]    > 	at org.apache.solr.handler.TestBlobHandler.checkBlobPost(TestBlobHandler.java:102)
   [junit4]    > 	at org.apache.solr.handler.TestSystemCollAutoCreate.testAutoCreate(TestSystemCollAutoCreate.java:26)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsFixedStatement.callStatement(BaseDistributedSearchTestCase.java:1065)
   [junit4]    > 	at org.apache.solr.BaseDistributedSearchTestCase$ShardsRepeatRule$ShardsStatement.evaluate(BaseDistributedSearchTestCase.java:1039)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
{code}
Reference: risdenk/nuc#72

bq. Tests are taking about 60m each,

Keep in mind that speed will vary greatly depending on how many cores you have and what number of jmvs you execute the tests with. By default, the built system makes a conservative guess based on number of cores detected.

For example though, on my 2018 Macbook Pro with 4 cores and 4 test jvms, the tests take 32 minutes. On my 2012 6 core Linux machine, they take 22 minutes with 8 jvms. On my 2018 16 core Linux machine, they take 11 minutes with 16 jvms.

If you can only run 1 or 2 jvms at a time, tests will be very long because of the number of tests we have that take around a minute or more.

Also, tests run fastest when you can use more jvm's (each needs 512 MB heap) and have run the tests a few times so that test timings are cached and the longest tests can be launched first.

Running with a fresh pull rather than applying a patch I get this one failure in 10 runs:

{code}
[junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestCollectionStateWatchers -Dtests.method=testSimpleCollectionWatch -Dtests.seed=F61CC9E5F0069834 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=ms -Dtests.timezone=SystemV/HST10 -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   45.3s J2 | TestCollectionStateWatchers.testSimpleCollectionWatch <<<
   [junit4]    > Throwable #1: java.lang.RuntimeException: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:60124 within 30000 ms
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([F61CC9E5F0069834:AB270695B70B070A]:0)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:588)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:514)
   [junit4]    > 	at org.apache.solr.cloud.MiniSolrCloudCluster.<init>(MiniSolrCloudCluster.java:245)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase$Builder.build(SolrCloudTestCase.java:200)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase$Builder.configure(SolrCloudTestCase.java:192)
   [junit4]    > 	at org.apache.solr.common.cloud.TestCollectionStateWatchers.prepareCluster(TestCollectionStateWatchers.java:66)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > Caused by: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:60124 within 30000 ms
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:201)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:126)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:121)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:108)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.init(ZkTestServer.java:439)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:585)
   [junit4]    > 	... 43 more
   [junit4]    > Caused by: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:60124 within 30000 ms
   [junit4]    > 	at org.apache.solr.common.cloud.ConnectionManager.waitForConnected(ConnectionManager.java:250)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:193)
   [junit4]    > 	... 48 more
   [junit4]   1> 14:12:06.626 [ZkTestServer Run Thread] ERROR org.apache.zookeeper.server.ZooKeeperServer - ZKShutdownHandler is not registered, so ZooKeeper server won't take any action on ERROR or SHUTDOWN server state changes
   [junit4]   1
{code}

Last few builds have been clean. This most recent one had a new failure.

Commit: 91b202bad89a94d40021251e026c582f695aad69

Test: MathExpressionTest#testDistributions
{code:java}
reproduce with: ant test  -Dtestcase=MathExpressionTest -Dtests.method=testDistributions -Dtests.seed=F7286DC596D3A9BA -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-VE -Dtests.timezone=Pacific/Pago_Pago -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 0.09s J1 | MathExpressionTest.testDistributions <<<
   [junit4]    > Throwable #1: java.lang.AssertionError
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([F7286DC596D3A9BA:48D72C6F48294926]:0)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.MathExpressionTest.testDistributions(MathExpressionTest.java:1704)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748){code}
 Reference: risdenk/nuc#108

Three more failures last night:

{code}
NOTE: reproduce with: ant test  -Dtestcase=TestPolicyCloud -Dtests.seed=750391CDBFDBBA5B -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=id -Dtests.timezone=US/Arizona -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.00s J2 | TestPolicyCloud (suite) <<<
   [junit4]    > Throwable #1: java.lang.RuntimeException: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:59936 within 30000 ms
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([750391CDBFDBBA5B]:0)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:588)
   [junit4]    > 	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:514)
   [junit4]    > 	at org.apache.solr.cloud.MiniSolrCloudCluster.<init>(MiniSolrCloudCluster.java:245)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase$Builder.build(SolrCloudTestCase.java:200)
   [junit4]    > 	at org.apache.solr.cloud.SolrCloudTestCase$Builder.configure(SolrCloudTestCase.java:192)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.TestPolicyCloud.setupCluster(TestPolicyCloud.java:82)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > Caused by: org.apache.solr.common.SolrException: java.util.concurrent.TimeoutException: Could not connect to ZooKeeper 127.0.0.1:59936 within 30000 ms
{code}

{code}
   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=TestSimLargeCluster -Dtests.method=testBasic -Dtests.seed=AEE99A00F166E955 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=es-HN -Dtests.timezone=America/Cancun -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 7.44s J5 | TestSimLargeCluster.testBasic <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: there should be less than flakyReplicas=9 MOVEREPLICA ops
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([AEE99A00F166E955:51387152EBA6F7B]:0)
   [junit4]    > 	at org.apache.solr.cloud.autoscaling.sim.TestSimLargeCluster.testBasic(TestSimLargeCluster.java:280)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   2> 851915 INFO  (TEST-TestSimLargeCluster.testSearchRate-seed#[AEE99A00F166E955]) [    ] o.a.s.SolrTestCaseJ4 ###Starting testSearchRate
   [junit4]   2> 851915 DEBUG (TEST-TestSimLargeCluster.testSearchRate-seed#[AEE99A00F166E955]) [    ] o.a.s.c.a.OverseerTriggerThread Refreshing /autoscaling.json with znode version 1
   [junit4]   2> 851915 DEBUG (Simulated OverseerAutoScalingTriggerThread) [    ] o.a.s.c.a.OverseerTriggerThread Processed trigger updates upto znodeVersion 1
   [junit4]   2> 851916 DEBUG (Simulated OverseerAutoScalingTriggerThread) [    ] o.a.s.c.a.OverseerTriggerThread -- clean old nodeLost markers
   [junit4]   2> 851916 INFO  (TEST-TestSimLargeCluster.testSearchRate-seed#[AEE99A00F166E955]) [    ] o.a.s.c.a.s.SimCloudManager === Restarting OverseerTriggerThread and clearing object cache...
   [junit4]   2> 851916 DEBUG (Simulated OverseerAutoScalingTriggerThread) [    ] o.a.s.c.a.OverseerTriggerThread -- clean old nodeAdded markers
   
{code}

{code}
   [junit4]   2> NOTE: reproduce with: ant test  -Dtestcase=MathExpressionTest -Dtests.method=testGammaDistribution -Dtests.seed=6EF35F29F8FCC0A1 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=mk-MK -Dtests.timezone=Africa/Porto-Novo -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 0.76s J5 | MathExpressionTest.testGammaDistribution <<<
   [junit4]    > Throwable #1: java.lang.AssertionError
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([6EF35F29F8FCC0A1:53897487DB846AB6]:0)
   [junit4]    > 	at org.apache.solr.client.solrj.io.stream.MathExpressionTest.testGammaDistribution(MathExpressionTest.java:4287)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]   1> 02:37:47.293 [SUITE-MathExpressionTest-seed#[6EF35F29F8FCC0A1]-worker] ERROR org.apache.zookeeper.server.ZooKeeperServer - ZKShutdownHandler is not registered, so ZooKeeper server won't take any action on ERROR or SHUTDOWN server state changes
   [junit4]   2> NOTE: leaving temporary files on disk at: /Users/Erick/apache/solrJiras/markmiller-test/solr/build/solr-solrj/test/J5/temp/solr.client.solrj.io.stream.MathExpressionTest_6EF35F29F8FCC0A1-001
   [junit4]   2> Nov 02, 2018 2:37:47 AM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks

{code}



{{ZookeeperStatusHandlerTest}} hang for me. I have a full thread dump, but this is the only interesting thread:
{code:java}
"SUITE-ZookeeperStatusHandlerTest-seed#[DC3BEA1CE6C3BFE0]-worker" #874 prio=5 os_prio=31 tid=0x00007f8d2ba09800 nid=0x19217 runnable [0x000070000c894000]
   java.lang.Thread.State: RUNNABLE
	at java.net.SocketInputStream.socketRead0(Native Method)
	at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
	at java.net.SocketInputStream.read(SocketInputStream.java:170)
	at java.net.SocketInputStream.read(SocketInputStream.java:141)
	at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
	at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
	at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
	- locked <0x00000007a3c76a08> (a java.io.InputStreamReader)
	at java.io.InputStreamReader.read(InputStreamReader.java:184)
	at java.io.BufferedReader.fill(BufferedReader.java:161)
	at java.io.BufferedReader.readLine(BufferedReader.java:324)
	- locked <0x00000007a3c76a08> (a java.io.InputStreamReader)
	at java.io.BufferedReader.readLine(BufferedReader.java:389)
	at org.apache.solr.cloud.ZkTestServer.send4LetterWord(ZkTestServer.java:703)
	at org.apache.solr.cloud.ZkTestServer.waitForServerUp(ZkTestServer.java:650)
	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:584)
	at org.apache.solr.cloud.ZkTestServer.run(ZkTestServer.java:514)
	at org.apache.solr.cloud.MiniSolrCloudCluster.<init>(MiniSolrCloudCluster.java:245)
	at org.apache.solr.cloud.SolrCloudTestCase$Builder.build(SolrCloudTestCase.java:201)
	at org.apache.solr.cloud.SolrCloudTestCase$Builder.configure(SolrCloudTestCase.java:193)
	at org.apache.solr.handler.admin.ZookeeperStatusHandlerTest.setupCluster(ZookeeperStatusHandlerTest.java:46)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1742)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:875)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:891)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
	at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
	at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
	at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
	at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
	at java.lang.Thread.run(Thread.java:745)
{code}

[~markrmiller@gmail.com] running with the Nov. 5 patch (34500a1262f2a7a6602e43904facc7da958e0cd1),  getting more clean runs but still getting errors from the autoscaling tests.   Is it helpful to post those failures to  [12923|https://issues.apache.org/jira/browse/SOLR-12923]? 

I had stopped the runs for the weekend but this morning 5/5 failed with the same test failure.

Commit:34500a1262f2a7a6602e43904facc7da958e0cd1

Test:AutoscalingHistoryHandlerTest
{code:java}
reproduce with: ant test  -Dtestcase=AutoscalingHistoryHandlerTest -Dtests.seed=8F97179111B556A4 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=sr-BA -Dtests.timezone=Cuba -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.00s J1 | AutoscalingHistoryHandlerTest (suite) <<<
   [junit4]    > Throwable #1: java.lang.AssertionError: ObjectTracker found 2 object(s) that were not released!!! [ZkStateReader, SolrZkClient]
   [junit4]    > org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException: org.apache.solr.common.cloud.ZkStateReader
   [junit4]    > 	at org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)
   [junit4]    > 	at org.apache.solr.common.cloud.ZkStateReader.<init>(ZkStateReader.java:328)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.ZkClientClusterStateProvider.connect(ZkClientClusterStateProvider.java:160)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.connect(CloudSolrClient.java:399)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:827)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrClient.deleteByQuery(SolrClient.java:936)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrClient.deleteByQuery(SolrClient.java:899)
   [junit4]    > 	at org.apache.solr.metrics.rrd.SolrRrdBackendFactory.remove(SolrRrdBackendFactory.java:320)
   [junit4]    > 	at org.apache.solr.handler.admin.MetricsHistoryHandler.removeHistory(MetricsHistoryHandler.java:302)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$1(CoreAdminOperation.java:121)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:360)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:395)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminHandler.lambda$handleRequestBody$0(CoreAdminHandler.java:188)
   [junit4]    > 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)
   [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > org.apache.solr.common.util.ObjectReleaseTracker$ObjectTrackerException: org.apache.solr.common.cloud.SolrZkClient
   [junit4]    > 	at org.apache.solr.common.util.ObjectReleaseTracker.track(ObjectReleaseTracker.java:42)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:203)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:126)
   [junit4]    > 	at org.apache.solr.common.cloud.SolrZkClient.<init>(SolrZkClient.java:116)
   [junit4]    > 	at org.apache.solr.common.cloud.ZkStateReader.<init>(ZkStateReader.java:306)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.ZkClientClusterStateProvider.connect(ZkClientClusterStateProvider.java:160)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.connect(CloudSolrClient.java:399)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:827)
   [junit4]    > 	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrClient.deleteByQuery(SolrClient.java:936)
   [junit4]    > 	at org.apache.solr.client.solrj.SolrClient.deleteByQuery(SolrClient.java:899)
   [junit4]    > 	at org.apache.solr.metrics.rrd.SolrRrdBackendFactory.remove(SolrRrdBackendFactory.java:320)
   [junit4]    > 	at org.apache.solr.handler.admin.MetricsHistoryHandler.removeHistory(MetricsHistoryHandler.java:302)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminOperation.lambda$static$1(CoreAdminOperation.java:121)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:360)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:395)
   [junit4]    > 	at org.apache.solr.handler.admin.CoreAdminHandler.lambda$handleRequestBody$0(CoreAdminHandler.java:188)
   [junit4]    > 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)
   [junit4]    > 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:209)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
   [junit4]    > 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([8F97179111B556A4]:0)
   [junit4]    > 	at org.apache.solr.SolrTestCaseJ4.teardownTestCases(SolrTestCaseJ4.java:317)
   [junit4]    > 	at java.lang.Thread.run(Thread.java:748)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: 6 threads leaked from SUITE scope at org.apache.solr.handler.admin.AutoscalingHistoryHandlerTest: 
   [junit4]    >    1) Thread[id=23113, name=zkCallback-5763-thread-1, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=23071, name=parallelCoreAdminExecutor-6574-thread-1-processing-n:127.0.0.1:46027_solr x:AutoscalingHistoryHandlerTest_collection_shard1_replica_n1 AutoscalingHistoryHandlerTest_node_added_trigger//354f56a1a5c62T97h2je8841fj16tp15d7ws8zi//0937839259663825 UNLOAD-EventThread, state=WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:502)
   [junit4]    >    3) Thread[id=23070, name=parallelCoreAdminExecutor-6574-thread-1-processing-n:127.0.0.1:46027_solr x:AutoscalingHistoryHandlerTest_collection_shard1_replica_n1 AutoscalingHistoryHandlerTest_node_added_trigger//354f56a1a5c62T97h2je8841fj16tp15d7ws8zi//0937839259663825 UNLOAD-SendThread(127.0.0.1:40291), state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:105)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1000)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1063)
   [junit4]    >    4) Thread[id=23174, name=zkCallback-5763-thread-2, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    5) Thread[id=23175, name=zkCallback-5763-thread-3, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    6) Thread[id=23072, name=zkConnectionManagerCallback-5764-thread-1, state=WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([8F97179111B556A4]:0)Throwable #3: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn't be terminated:
   [junit4]    >    1) Thread[id=23113, name=zkCallback-5763-thread-1, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    2) Thread[id=23070, name=parallelCoreAdminExecutor-6574-thread-1-processing-n:127.0.0.1:46027_solr x:AutoscalingHistoryHandlerTest_collection_shard1_replica_n1 AutoscalingHistoryHandlerTest_node_added_trigger//354f56a1a5c62T97h2je8841fj16tp15d7ws8zi//0937839259663825 UNLOAD-SendThread(127.0.0.1:40291), state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at java.lang.Thread.sleep(Native Method)
   [junit4]    >         at org.apache.zookeeper.client.StaticHostProvider.next(StaticHostProvider.java:105)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.startConnect(ClientCnxn.java:1000)
   [junit4]    >         at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1063)
   [junit4]    >    3) Thread[id=23174, name=zkCallback-5763-thread-2, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    4) Thread[id=23175, name=zkCallback-5763-thread-3, state=TIMED_WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
   [junit4]    >         at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
   [junit4]    >         at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    >    5) Thread[id=23072, name=zkConnectionManagerCallback-5764-thread-1, state=WAITING, group=TGRP-AutoscalingHistoryHandlerTest]
   [junit4]    >         at sun.misc.Unsafe.park(Native Method)
   [junit4]    >         at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
   [junit4]    >         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
   [junit4]    >         at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
   [junit4]    >         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
   [junit4]    >         at java.lang.Thread.run(Thread.java:748)
   [junit4]    > 	at __randomizedtesting.SeedInfo.seed([8F97179111B556A4]:0)
{code}
Reference: risdenk/nuc#182-186

Looks like there have been new commits and that last 5 tests have passed successfully.

Commit 75b183196798232aa6f2dcaaaab117f309119053 in lucene-solr's branch refs/heads/master from markrmiller
[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=75b1831 ]

SOLR-12801: Make massive improvements to the tests.

SOLR-12804: Remove static modifier from Overseer queue access.

SOLR-12896: Introduce more checks for shutdown and closed to improve clean close and shutdown. (Partial)

SOLR-12897: Introduce AlreadyClosedException to clean up silly close / shutdown logging. (Partial)

SOLR-12898: Replace cluster state polling with ZkStateReader#waitFor. (Partial)

SOLR-12923: The new AutoScaling tests are way too flaky and need special attention. (Partial)

SOLR-12932: ant test (without badapples=false) should pass easily for developers. (Partial)

SOLR-12933: Fix SolrCloud distributed commit.


Commit eb652b84edf441d8369f5188cdd5e3ae2b151434 in lucene-solr's branch refs/heads/branch_7x from markrmiller
[ https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=eb652b8 ]

SOLR-12801: Make massive improvements to the tests.

SOLR-12804: Remove static modifier from Overseer queue access.

SOLR-12896: Introduce more checks for shutdown and closed to improve clean close and shutdown. (Partial)

SOLR-12897: Introduce AlreadyClosedException to clean up silly close / shutdown logging. (Partial)

SOLR-12898: Replace cluster state polling with ZkStateReader#waitFor. (Partial)

SOLR-12923: The new AutoScaling tests are way too flaky and need special attention. (Partial)

SOLR-12932: ant test (without badapples=false) should pass easily for developers. (Partial)

SOLR-12933: Fix SolrCloud distributed commit.


Although it doesn't seem like there has been an apache jenkins build of master since mark's commit 75b1831967982, there have been 3 jenkins.thetaphi.de builds of master, and 1 jenkins.sarowe.net build of master...
 * jenkins.sarowe.net
 ** prior to mark's commit, the most recent master build had 2 test failures
 *** [http://fucit.org/solr-jenkins-reports/job-data/sarowe/Lucene-Solr-tests-master/19410/]
 ** The single build since mark's commit had no failures...
 *** [http://fucit.org/solr-jenkins-reports/job-data/sarowe/Lucene-Solr-tests-master/19411/]
 * jenkins.thetaphi.de
 ** prior to mark's commit, the most recent master build coincidently succeeded w/o any test failures.
 *** [http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/23276/]
 ** All 3 builds of master since that commit, have had 100+ suite level failures – although it should be noted they all used diff JVMs
 *** [http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/23277/]
 *** [http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/23278/]
 *** [http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/23279/]

----
Skimming the logs from jenkins.thetaphi.de #23277, the suite failures mostly seem to fall into 2 types...
 # Thread Leaks
 ** 
 *** SolrRrdBackendFactory-* and MetricsHistoryHandler-* threads seem to frequently leak in "pairs" – ie: it's very common to see 2 threads leaked w/one of each – but also 4 threads leaked 2 of each, etc...
 *** there were other thread's leaked in some tests to various degrees, not enough for a pattern to be obvious
 # Object Leaks
 ** 
 *** Notably instances of [ZkStateReader, SolrZkClient] – also typically in pairs (if 2 objects leaked, one of each; if 24 objects leaked, 12 of each)
 *** there were a handful of object leak failures that sometimes included other objects: in particular some large lists w/multiple SolrCore objects being leaked and ohter objects you'd expect to see hanging off of a SolrCore

Hypothosis: I know mark has mentioned cleaning up a lot of "sleep" and "wait" type logic in tests, I'm guessing that in doing this it's exposed some "shutdown" logic bugs that that in the past weren't as obvious because "slow" jenkins machines were waiting longer for other things due to hardcoded "waits" and were getting lucky that the the threads/objects were being cleaned up in a timely manor.

Yeah, I've seen the leak emails - most likely related to reducing leak timeouts drastically - these must be some slow envs because I never saw this locally across 3 machines under a variety of loads, but I'll look at these leaks soon.

Or maybe it is JVM version related - I'll look at that angle as well.

bq. Thread Leaks ...

I'm pretty sure there is a bug in the lifecycle of MetricsHistoryHandler ... created SOLR-13030

bq. Skimming the logs from jenkins.thetaphi.de #23277, the suite failures mostly seem to fall into 2 types...

I completley overlooked this initially (because i was focused on the "fails") but in that jenkins.thetaphi.de #23277 build (which used java10) it seems that every test that didn't have a suite level failure was just skipping all of the test methods.

From the #23277 logs...

{noformat}
...
   [junit4] Completed [2/837 (1!)] on J2 in 16.95s, 9 tests, 2 errors <<< FAILURES!
   [junit4] 
   [junit4] Suite: org.apache.solr.DistributedIntervalFacetingTest
   [junit4] Completed [3/837 (1!)] on J2 in 0.00s, 1 test, 1 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.rest.schema.TestDynamicFieldCollectionResource
   [junit4] Completed [4/837 (1!)] on J2 in 0.00s, 5 tests, 5 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.index.UninvertDocValuesMergePolicyTest
   [junit4] Completed [5/837 (1!)] on J2 in 0.00s, 2 tests, 2 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.core.TestCodecSupport
   [junit4] Completed [6/837 (1!)] on J2 in 0.00s, 8 tests, 8 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.update.PeerSyncWithLeaderAndIndexFingerprintCachingTest
   [junit4] Completed [7/837 (1!)] on J2 in 0.00s, 1 test, 1 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.request.RegexBytesRefFilterTest
   [junit4] Completed [8/837 (1!)] on J2 in 0.00s, 1 test, 1 skipped
   [junit4] 
   [junit4] Suite: org.apache.solr.legacy.TestNumericRangeQuery32
   [junit4] Completed [9/837 (1!)] on J2 in 0.00s, 18 tests, 18 skipped
...
{noformat}

...that last {{TestNumericRangeQuery32}} subclasses LuceneTestCase directly, and doesn't use any solr code or test-framework code ... so it shouldn't really be possible it's inheriting any assumption/annotation that would cause it to be skipped ... so WTF????

----

i see similar behavior myself when i run with java11 locally (fewer suite level failures, but what doesn't fail says it's being skipped) but can't wrap my head around what might be causing this...

{noformat}
hossman@tray:~/lucene/dev/solr/core [master] $ ant test -Dtests.seed=A28FAA62F9DF8AD7
...
BUILD FAILED
/home/hossman/lucene/dev/solr/common-build.xml:558: The following error occurred while executing this line:
/home/hossman/lucene/dev/lucene/common-build.xml:1567: The following error occurred while executing this line:
/home/hossman/lucene/dev/lucene/common-build.xml:1092: There were test failures: 837 suites (7 ignored), 4121 tests, 7 suite-level errors, 3954 ignored (128 assumptions) [seed: A28FAA62F9DF8AD7]

Total time: 1 minute 36 seconds
{noformat}

... i can't reproduce this "java11 skips almost every test" wonkiness if i rollback to 81c092d8262a68dfda3994e790f2e1f3fdf275e2 (last master commit before 75b1831967982)


I was feeling good since I ran the full set of tests 3 times and got no errors, so I fired up a beast run and it blew out on the first round :(.

 
{code:java}
ant beast -Dbeast.iters 20 -Dtests.jvms=30{code}
 

in {color:#14892c}solr/core/{color} Got the following non-reproducing result (full log can be attached if desired):

 
{code:java}
 [beaster] 2> 5 /solr/collections
 [beaster] 2> 
 [beaster] 2> NOTE: leaving temporary files on disk at: /home/gus/clients/ds/tp/code/lucene-solr/solr/build/solr-core/test/J20/temp/solr.update.processor.TimeRoutedAliasUpdateProcessorTest_703C314355FFA220-001
 [beaster] 2> Dec 01, 2018 5:34:02 PM com.carrotsearch.randomizedtesting.ThreadLeakControl checkThreadLeaks
 [beaster] 2> WARNING: Will linger awaiting termination of 1 leaked thread(s).
 [beaster] 2> NOTE: test params are: codec=Asserting(Lucene70): {}, docValues:{}, maxPointsInLeafNode=521, maxMBSortInHeap=7.426758507726064, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@55893cd5), locale=en-PH, timezone=America/Godthab
 [beaster] 2> NOTE: Linux 4.15.0-38-generic amd64/Oracle Corporation 1.8.0_144 (64-bit)/cpus=32,threads=1,free=97735136,total=520093696
 [beaster] 2> NOTE: All tests run in this JVM: [TestJsonFacetRefinement, SpellCheckComponentTest, TestUtils, CreateRoutedAliasTest, TestLegacyFieldReuse, ExecutePlanActionTest, TestRemoteStreaming, EchoParamsTest, BlobRepositoryCloudTest, CleanupOldIndexTest, TestPolicyCloud, ParsingFieldUpdateProcessorsTest, TlogReplayBufferedWhileIndexingTest, SimpleMLTQParserTest, AutoAddReplicasIntegrationTest, CustomCollectionTest, TimeRoutedAliasUpdateProcessorTest]
 [beaster] 
 [beaster] Tests with failures [seed: 703C314355FFA220]:
 [beaster] - org.apache.solr.update.processor.TimeRoutedAliasUpdateProcessorTest.testParse
 [beaster] 
 [beaster]
BUILD FAILED
/home/gus/clients/ds/tp/code/lucene-solr/lucene/common-build.xml:1522: The following error occurred while executing this line:
/home/gus/clients/ds/tp/code/lucene-solr/lucene/common-build.xml:1512: The following error occurred while executing this line:
/home/gus/clients/ds/tp/code/lucene-solr/lucene/common-build.xml:1038: There were test failures: 769 suites (5 ignored), 3645 tests, 1 error, 152 ignored (135 assumptions) [seed: 703C314355FFA220]
Total time: 6 minutes 20 seconds
{code}
The relevant part of the logs seems to regard the timing of alias removal vs collection deletion, Other stack traces are possibly attributable to negative testing, but this one clearly shouldn't be there (and doesn't appear if the test is run singly)
{code:java}
[beaster] > Throwable #1: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:33061/solr: Collection : myalias_20
17-10-24 is part of alias myalias remove or modify the alias before removing this collection.
 [beaster] > at __randomizedtesting.SeedInfo.seed([703C314355FFA220:1FB97A1BE98991CF]:0)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:643)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
 [beaster] > at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:483)
 [beaster] > at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:413)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1104)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
 [beaster] > at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
 [beaster] > at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
 [beaster] > at org.apache.solr.update.processor.TimeRoutedAliasUpdateProcessorTest.doBefore(TimeRoutedAliasUpdateProcessorTest.java:84)
 [beaster] > at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 [beaster] > at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 [beaster] > at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 [beaster] > at java.lang.reflect.Method.invoke(Method.java:498)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1737)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:968)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:984)
 [beaster] > at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
 [beaster] > at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
 [beaster] > at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
 [beaster] > at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
 [beaster] > at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
 [beaster]{code}
 

 

This is really quite interesting: to quote a different part of the log, it's clear that the failure is being attributed to the *wrong* test... The test in question doesn't invoke the request proccessro at all (it probably should be in a separate class TimeRoutedAliasTest)... it also looks like a bug in the code, but it certainly shouldn't be reporting against this test unless I'me under-appreciating the test setup/teardown somewhere.
{code:java}
[beaster] [17:34:01.913] ERROR 0.11s J20 | TimeRoutedAliasUpdateProcessorTest.testParse <<<
 [beaster] > Throwable #1: org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https://127.0.0.1:33061/solr: Collection : myalias_2017-10-24 is part of alias myalias remove or modify the alias before removing this collection.
 [beaster] > at __randomizedtesting.SeedInfo.seed([703C314355FFA220:1FB97A1BE98991CF]:0)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:643)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
 [beaster] > at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
 [beaster] > at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:483)
 [beaster] > at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:413)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1104)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:884)
 [beaster] > at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:817)
 [beaster] > at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
 [beaster] > at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
 [beaster] > at org.apache.solr.update.processor.TimeRoutedAliasUpdateProcessorTest.doBefore(TimeRoutedAliasUpdateProcessorTest.java:84)
 [beaster] > at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 [beaster] > at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 [beaster] > at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 [beaster] > at java.lang.reflect.Method.invoke(Method.java:498)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1737)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:968)
 [beaster] > at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:984)
 [beaster] > at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
 [beaster] > at org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:49)
 [beaster] > at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
 [beaster] > at org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:48)
 [beaster] > at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
 [beaster] > at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
 [{code}

Beasting is a separate effort that I will work on by package (sub issues to the parent issue of this jira). This is just so you have the hope of 3 ant tests passing in a row. It's not really meant for clearing scripting runs or beasting tests.

Ok, I was under the impression that beasting with just beast.iters set wasn't significantly different from regular runs with fast fingers on the uparrow/return keys and a counter.

Ok, sorry for the noise, the above strangeness is a non-issue. Terminal window was in an old checkout (but IDE was in a fully up to date location, hence the mismatch) from a time when the error was possible for that method.

