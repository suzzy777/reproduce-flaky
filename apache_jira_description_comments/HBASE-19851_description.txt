Refer to HBASE-19839 and detailed description there. Bug showed up as a flaky test TestMergeTableRegionsProcedure.testRollbackAndDoubleExecution(). In short, when rollback() is called after step 5 (MERGE_TABLE_REGIONS_CLOSE_REGIONS), rollback of the procedure tries to reassign two regions that are to be merged. It spawns 2 AssignProcedures and don't wait on them to finish. Rollback should have ability to have sub-procedures and separate proc stack.