See the PR description for details