At some point in the past NIO tests were excluded from the main build but these should be enabled for CI to run them to catch transport errors. As part of this there are a few tests that are broken that I am fixing due to not being run in a while.