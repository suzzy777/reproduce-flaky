Pushed to all branch-2.x & master & branch-1.3/branch-1.4/branch-1. Thanks [~Apache9] & [~zghaobac] for reviewing.

SUCCESS: Integrated in Jenkins build HBase-1.3-IT #618 (See [https://builds.apache.org/job/HBase-1.3-IT/618/])
HBASE-22810 Initialize an separate ThreadPoolExecutor for (openinx: rev b97621b30216dc39ad605e06738a070a69a47da3)
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/executor/ExecutorType.java
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/executor/EventType.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/executor/TestExecutorService.java
* (edit) hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java
* (edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java


Results for branch branch-1
	[build #1009 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1009/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(x) {color:red}-1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1009//General_Nightly_Build_Report/]


(x) {color:red}-1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1009//JDK7_Nightly_Build_Report/]


(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1009//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch master
	[build #1335 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/master/1335/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/master/1335//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/master/1335//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/master/1335//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch branch-2.1
	[build #1486 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1486/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1486//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1486//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1486//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch branch-2.0
	[build #1867 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.0/1867/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.0/1867//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.0/1867//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.0/1867//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-1.4
	[build #959 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/959/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(x) {color:red}-1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/959//General_Nightly_Build_Report/]


(x) {color:red}-1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/959//JDK7_Nightly_Build_Report/]


(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/959//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-1.3
	[build #920 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/920/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/920//General_Nightly_Build_Report/]


(x) {color:red}-1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/920//JDK7_Nightly_Build_Report/]


(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/920//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-2
	[build #2169 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2169/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2169//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2169//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2169//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch branch-2.2
	[build #517 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/517/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/517//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/517//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/517//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(x) {color:red}-1 client integration test{color}
--Failed when running client tests on top of Hadoop 2. [see log for details|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/517//artifact/output-integration/hadoop-2.log]. (note that this means we didn't run on Hadoop 3)


Bisect fingers this as breaking TestFlushSnapshotFromClient on branch-1

{noformat}
eb6b617d92998b887c8d811769c6a9d80b653432 is the first bad commit
commit eb6b617d92998b887c8d811769c6a9d80b653432
Author: openinx <openinx@gmail.com>
Date:   Thu Aug 15 10:57:42 2019 +0800

    HBASE-22810 Initialize an separate ThreadPoolExecutor for taking/restoring snapshot (#486)

 .../apache/hadoop/hbase/executor/EventType.java    |  4 +--
 .../apache/hadoop/hbase/executor/ExecutorType.java |  1 +
 .../java/org/apache/hadoop/hbase/HConstants.java   | 27 ++++++++++++++++
 .../org/apache/hadoop/hbase/master/HMaster.java    | 29 +++++++++--------
 .../hadoop/hbase/executor/TestExecutorService.java | 36 ++++++++++++++++++++++
 5 files changed, 83 insertions(+), 14 deletions(-)
{noformat}

Perhaps we need an addendum? 

OK, Thanks [~apurtell], Let me take a look, will provide the addendum soon if necessary.

It also breaks the test on master.

OK, seems it also breaks the tests on branch-2.1...

https://builds.apache.org/job/HBASE-Find-Flaky-Tests/job/branch-2.1/lastSuccessfulBuild/artifact/dashboard.html

Could you please quickly identify whether this is a test issue or not? If not, we need to sink all the pending RCs and prepare new ones.

Thanks. [~openinx]

Fine.  Sorry , I think I forgot this issue before, Let me dig this .

The TestMobFlushSnapshotFromClient class extend the TestFlushSnapshotFromClient , so only need to fix the TestFlushSnapshotFromClient . 

TestFlushSnapshotFromClient#testConcurrentSnapshottingAttempts is the root cause, let me read the UT.

Ok. This did not make it into 2.0.6RC1 which just became 2.0.6. I moved fix version to 2.0.7 though there will be no more releases on branch-2.0.

I just saw this issue and how it breaks TestFlushSnapshotFromClient. I looked at the TestFlushSnapshotFromClient failures independently and to me the test looked flakey anyways and was seemingly written flakey in the first place so just removed it with the below commit. Did not go back to branch-1. After seeing this issue, I was a mite reactionary.

{code}
commit 05b88af057d35e247bf37b725f2735292f944387 (HEAD -> 2.0, origin/branch-2.0)
Author: stack <stack@apache.org>
Date:   Mon Aug 19 14:25:21 2019 -0700

     HBASE-22882 TestFlushSnapshotFromClient#testConcurrentSnapshottingAttempts is flakey (was written flakey)
     Addendum; just remove the test altogether
{code}

[~openinx], It seems SnapshotManager configures pools separately which allow only 1 thread and that's why TestFlushSnapshotFromClient#testConcurrentSnapshottingAttempts is failing, so you may also need to update the below code with your new config to keep the threads consistent.

SnapshotManager#initialize
{code}
int opThreads = conf.getInt(SNAPSHOT_POOL_THREADS_KEY, SNAPSHOT_POOL_THREADS_DEFAULT);
{code}

to 

{code}
int opThreads = conf.getInt(MASTER_SNAPSHOT_OPERATIONS_THREADS, MASTER_SNAPSHOT_OPERATIONS_THREADS_DEFAULT);
{code}

And update to maintain backward compatibility
{code}MASTER_SNAPSHOT_OPERATIONS_THREADS="hbase.snapshot.master.threads"{code}

And, committing improvements which change the defaults value in patch releases(2.[0-2].x), doesn't it affect our operational compatibility?


Thanks [~stack] for the fix.  Read the UT code,  it's indeed  a test which easy to be flaky.  For example, all snapshot request are submitted but the snapshot is a bit slow,  none are completed  when the assert begin: 
{code}
+    assertTrue("We expect at least 1 request to be rejected because of we concurrently" +
+        " issued many requests", takenSize < ssNum && takenSize > 0);
{code}
Then, the assert will be failure.  so +1 for me to remove it (I guess after increasing the 'hbase.master.executor.snapshot.threads',   it's easy to happen now).

[~ankit@apache.org], Thanks for the reminding .  It's true, there are two different config keys for the snapshot threads size,  but I think they have different meanings:
1.  hbase.master.executor.snapshot.threads :   means how many snapshot requests from client we can handle at master side the same time; 
2. hbase.snapshot.master.threads:   how many snapshot procedure we can coordinator with region server. 
The config key#1 limit the all the snapshot request, while the key#2 only limit the snapshot procedure with RS ( it's a part of the snapshot request).    Maybe we can uniform the two config keys into one ?  although we will initialize two different thread pools with the same thread size for different purpose.



Created a PR to address the above uniform & add a UT.
https://github.com/apache/hbase/pull/517

Committed the addendum to all branches, Thanks all.

SUCCESS: Integrated in Jenkins build HBase-1.3-IT #623 (See [https://builds.apache.org/job/HBase-1.3-IT/623/])
HBASE-22810 Initialize an separate ThreadPoolExecutor for (openinx: rev 40cf771a825cf657f5f7cb0f7ef8c986e5b1fe4c)
* (add) hbase-server/src/test/java/org/apache/hadoop/hbase/snapshot/TestConcurrentFlushSnapshotFromClient.java
* (edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
* (edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/snapshot/EnabledTableSnapshotHandler.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/snapshot/TestFlushSnapshotFromClient.java
* (edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/snapshot/SnapshotManager.java
* (edit) hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java


Results for branch branch-1.3
	[build #931 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/931/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/931//General_Nightly_Build_Report/]


(/) {color:green}+1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/931//JDK7_Nightly_Build_Report/]


(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.3/931//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-1.4
	[build #971 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/971/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(x) {color:red}-1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/971//General_Nightly_Build_Report/]


(x) {color:red}-1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/971//JDK7_Nightly_Build_Report/]


(/) {color:green}+1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1.4/971//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-1
	[build #1021 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1021/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(x) {color:red}-1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1021//General_Nightly_Build_Report/]


(x) {color:red}-1 jdk7 checks{color}
-- For more information [see jdk7 report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1021//JDK7_Nightly_Build_Report/]


(/) {color:green}+1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-1/1021//JDK8_Nightly_Build_Report_(Hadoop2)/]




(/) {color:green}+1 source release artifact{color}
-- See build output for details.


Results for branch branch-2.2
	[build #533 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/533/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/533//General_Nightly_Build_Report/]




(/) {color:green}+1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/533//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.2/533//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch branch-2.1
	[build #1509 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1509/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1509//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1509//JDK8_Nightly_Build_Report_(Hadoop2)/]


(/) {color:green}+1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2.1/1509//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch master
	[build #1352 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/master/1352/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/master/1352//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/master/1352//JDK8_Nightly_Build_Report_(Hadoop2)/]


(x) {color:red}-1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/master/1352//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(/) {color:green}+1 client integration test{color}


Results for branch branch-2
	[build #2184 on builds.a.o|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2184/]: (x) *{color:red}-1 overall{color}*
----
details (if available):

(/) {color:green}+1 general checks{color}
-- For more information [see general report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2184//General_Nightly_Build_Report/]




(x) {color:red}-1 jdk8 hadoop2 checks{color}
-- For more information [see jdk8 (hadoop2) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2184//JDK8_Nightly_Build_Report_(Hadoop2)/]


(/) {color:green}+1 jdk8 hadoop3 checks{color}
-- For more information [see jdk8 (hadoop3) report|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2184//JDK8_Nightly_Build_Report_(Hadoop3)/]


(/) {color:green}+1 source release artifact{color}
-- See build output for details.


(x) {color:red}-1 client integration test{color}
--Failed when running client tests on top of Hadoop 3. [see log for details|https://builds.apache.org/job/HBase%20Nightly/job/branch-2/2184//artifact/output-integration/hadoop-3.log]. (note that this means we didn't check the Hadoop 3 shaded client)


