{{testStartStopDatanodeStateMachine}} is flaky, causing [occasional pre-commit build failures|https://builds.apache.org/job/hadoop-multibranch/job/PR-691/1/artifact/out/patch-unit-hadoop-hdds_container-service.txt].  HDDS-1332 added some logging to find out more about the cause.

I think the problem is not test-specific, and is caused by the following: {{SCMConnectionManager#scmMachines}} is a plain {{HashMap}}, guarded by a {{ReadWriteLock}} in most places where it's used, except {{getValues()}}.  The method also returns the values collection without any write protection (though currently none of the callers modify it).