There are a LOT of places where we split (or use indexOf to split) IP:Port or Host:port pairs, which should use a smarter method like the Guava HostAndPort.

Not yet ready for review, but want to see if the current version of the changelist passes tests.

This requires HDFS-8078 to usefully test this on IPv6, although the two are nominally independent.

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  25m 30s | Pre-patch trunk has 3 extant Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 12 new or modified test files. |
| {color:green}+1{color} | javac |   7m 35s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |   9m 38s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 23s | The applied patch does not increase the total number of release audit warnings. |
| {color:red}-1{color} | checkstyle |   4m  0s | The applied patch generated  12 new checkstyle issues (total was 315, now 325). |
| {color:red}-1{color} | checkstyle |   5m 51s | The applied patch generated  1 new checkstyle issues (total was 53, now 54). |
| {color:red}-1{color} | checkstyle |   6m  2s | The applied patch generated  1 new checkstyle issues (total was 7, now 7). |
| {color:red}-1{color} | whitespace |   0m  7s | The patch has 2  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 40s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 35s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |  11m 48s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |  22m  5s | Tests passed in hadoop-common. |
| {color:green}+1{color} | yarn tests |   1m 58s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 24s | Tests passed in hadoop-yarn-server-common. |
| {color:green}+1{color} | yarn tests |   6m 15s | Tests passed in hadoop-yarn-server-nodemanager. |
| {color:green}+1{color} | yarn tests |  50m 57s | Tests passed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 21s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:green}+1{color} | hdfs tests | 162m 27s | Tests passed in hadoop-hdfs. |
| {color:green}+1{color} | hdfs tests |   0m 16s | Tests passed in hadoop-hdfs-client. |
| | | 308m  6s | |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12742018/lets_blow_up_a_lot_of_tests.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 1403b84 |
| Pre-patch Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/trunkFindbugsWarningshadoop-yarn-server-common.html |
| checkstyle |  https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/diffcheckstylehadoop-common.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/diffcheckstylehadoop-yarn-server-resourcemanager.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/diffcheckstylehadoop-yarn-server-web-proxy.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/whitespace.txt |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7045/console |


This message was automatically generated.

Rebased to HADOOP-11890 feature branch.

Hey [~nkedel] Elliott caught small style thing as part of testing HADOOP-12432 on trunk with QAbot - there is "import java.net.*;" and "import java.util.*" in NetUtils.java and * imports is something to avoid.
As you said as part of this patch you will fixup line length are you willing to fix this as well so I don't have to pull in this file to my patch?

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  20m 20s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 11 new or modified test files. |
| {color:green}+1{color} | javac |   7m 44s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 23s | There were no new javadoc warning messages. |
| {color:green}+1{color} | release audit |   0m 26s | The applied patch does not increase the total number of release audit warnings. |
| {color:green}+1{color} | checkstyle |   4m 10s | There were no new checkstyle issues. |
| {color:red}-1{color} | whitespace |   0m  9s | The patch has 2  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 48s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:green}+1{color} | findbugs |  13m 54s | The patch does not introduce any new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |  19m 57s | Tests failed in hadoop-common. |
| {color:green}+1{color} | yarn tests |   2m 47s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 41s | Tests passed in hadoop-yarn-server-common. |
| {color:red}-1{color} | yarn tests |  10m 56s | Tests failed in hadoop-yarn-server-nodemanager. |
| {color:green}+1{color} | yarn tests |  60m 32s | Tests passed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 32s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests | 104m 14s | Tests failed in hadoop-hdfs. |
| {color:green}+1{color} | hdfs tests |   0m 32s | Tests passed in hadoop-hdfs-client. |
| | | 259m 45s | |
\\
\\
|| Reason || Tests ||
| Failed unit tests | hadoop.fs.contract.rawlocal.TestRawlocalContractDelete |
|   | hadoop.fs.contract.localfs.TestLocalFSContractOpen |
|   | hadoop.fs.contract.localfs.TestLocalFSContractRename |
|   | hadoop.fs.contract.localfs.TestLocalFSContractDelete |
|   | hadoop.security.ssl.TestSSLFactory |
|   | hadoop.fs.contract.localfs.TestLocalFSContractCreate |
|   | hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainerMetrics |
|   | hadoop.hdfs.server.blockmanagement.TestBlockManager |
|   | hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistLockedMemory |
|   | hadoop.hdfs.server.datanode.fsdataset.impl.TestLazyPersistReplicaPlacement |
| Timed out tests | org.apache.hadoop.conf.TestConfiguration |
|   | org.apache.hadoop.hdfs.server.datanode.TestDataNodeMultipleRegistrations |
|   | org.apache.hadoop.hdfs.server.mover.TestStorageMover |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764724/HADOOP-12122-HADOOP-11890.0.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / 6f61143 |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/whitespace.txt |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7754/console |


This message was automatically generated.

Rebased patch as the patch no longer applied to trunk

Nate's out of the office for a little bit, I'll grab this and try and clean up his work

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764792/HADOOP-12122-HADOOP-12122.2.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 439f43a |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7757/console |


This message was automatically generated.

With cleaned up whitespace.

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | patch |   0m  0s | The patch command could not apply the patch during dryrun. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764793/HADOOP-12122-HADOOP-12122.3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | trunk / 439f43a |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7758/console |


This message was automatically generated.

Correct patch naming

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  22m 54s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 11 new or modified test files. |
| {color:red}-1{color} | javac |   1m  1s | The patch appears to cause the build to fail. |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12764799/HADOOP-12122-HADOOP-11890.3.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7759/console |


This message was automatically generated.

Build break fix to get more QA bot results, also running locally test-patch.sh in parallel.

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  21m  9s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 11 new or modified test files. |
| {color:green}+1{color} | javac |   8m  2s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 27s | There were no new javadoc warning messages. |
| {color:red}-1{color} | release audit |   0m 16s | The applied patch generated 1 release audit warnings. |
| {color:green}+1{color} | checkstyle |   4m 45s | There were no new checkstyle issues. |
| {color:red}-1{color} | whitespace |   0m  5s | The patch has 2  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 39s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:red}-1{color} | findbugs |  12m 32s | The patch appears to introduce 7 new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |   8m 23s | Tests passed in hadoop-common. |
| {color:green}+1{color} | yarn tests |   2m  2s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 23s | Tests passed in hadoop-yarn-server-common. |
| {color:green}+1{color} | yarn tests |   8m 40s | Tests passed in hadoop-yarn-server-nodemanager. |
| {color:green}+1{color} | yarn tests |  56m 45s | Tests passed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 24s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests |   0m 24s | Tests failed in hadoop-hdfs. |
| {color:red}-1{color} | hdfs tests |   0m 21s | Tests failed in hadoop-hdfs-client. |
| | | 136m 55s | |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hadoop-hdfs-client |
| Failed build | hadoop-hdfs |
|   | hadoop-hdfs-client |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12765327/HADOOP-12122-HADOOP-11890.4.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/patchReleaseAuditProblems.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/whitespace.txt |
| Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs-client.html |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7775/console |


This message was automatically generated.

Also while looking at these string splits, we should look at indexOf(":") from a quick glance there are more places where similar unsafe splits are happening.

Fixed whitespace only, "test failures" are actually build breaks that are completely impossible, as same patch built in same QA bot run, so I assume something strange in test infra.

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  21m  6s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 11 new or modified test files. |
| {color:green}+1{color} | javac |   8m  9s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 45s | There were no new javadoc warning messages. |
| {color:red}-1{color} | release audit |   0m 15s | The applied patch generated 1 release audit warnings. |
| {color:green}+1{color} | checkstyle |   4m 42s | There were no new checkstyle issues. |
| {color:red}-1{color} | whitespace |   0m  6s | The patch has 2  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 39s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 32s | The patch built with eclipse:eclipse. |
| {color:red}-1{color} | findbugs |  12m 41s | The patch appears to introduce 7 new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |   7m 43s | Tests failed in hadoop-common. |
| {color:green}+1{color} | yarn tests |   1m 59s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 24s | Tests passed in hadoop-yarn-server-common. |
| {color:green}+1{color} | yarn tests |   8m 33s | Tests passed in hadoop-yarn-server-nodemanager. |
| {color:green}+1{color} | yarn tests |  56m  6s | Tests passed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 22s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests | 196m  5s | Tests failed in hadoop-hdfs. |
| {color:red}-1{color} | hdfs tests |   0m 22s | Tests failed in hadoop-hdfs-client. |
| | | 331m 34s | |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hadoop-hdfs-client |
| Failed unit tests | hadoop.metrics2.impl.TestGangliaMetrics |
|   | hadoop.hdfs.util.TestIPv6FormatCompatibility |
|   | hadoop.hdfs.TestRecoverStripedFile |
|   | hadoop.hdfs.TestLeaseRecovery2 |
|   | hadoop.hdfs.TestRemoteBlockReader |
|   | hadoop.hdfs.TestDFSStripedOutputStreamWithFailure010 |
|   | hadoop.hdfs.util.TestByteArrayManager |
| Failed build | hadoop-hdfs-client |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12765473/HADOOP-12122-HADOOP-11890.5.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/patchReleaseAuditProblems.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/whitespace.txt |
| Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs-client.html |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf903.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7779/console |


This message was automatically generated.

[~eclark] - These failures look to be due to somewhat bonkers state of test infrastructure. Have you ever seen these kinds of issues in Jenkins/QAbot?

For start difference between patch HADOOP-12122-HADOOP-11890.4.patch and patch HADOOP-12122-HADOOP-11890.5.patch is whitespace only, but test runs show for 4.patch build break and for 5.patch no build break in hadoop-hdfs.
Both of these patches are compiling cleanly on my box (I went as far as to clean up maven repo and sync new client to make sure)

Whats more looking at test failures for hadoop-hdfs in 5.patch run build is corrupted as one of the failures should have been caught by compiler:
java.lang.NoSuchMethodError: org.apache.hadoop.net.NetUtils.getSocketAddressString(Ljava/net/InetSocketAddress;)Ljava/lang/String;
This is exactly the signature of method added with base patch (not even current patch)!

I looked at other failures as well and all point to ridiculous/impossible issues, so I ran all tests locally using test-patch.sh both testing this patch and on base build (before any of IPv6 patches were applied) and things are exactly the same.

Give this and the fact that original patch posted by [~nkedel] passed all tests in trunk I think we can proceed with committing this patch to HADOOP-11890 branch now.
What is your take on it?

I will start looking into indexOf and split calls in the meantime as separate patch (if there is any work needed will create task then to track it).

NoSuchMethodError and ClassNotFound happened sometimes in our jenkins because of a race condition when multiple maven instances modified the .m2 directory and stomped on each other. See http://mail-archives.apache.org/mod_mbox/hadoop-common-dev/201509.mbox/%3CCAGB5D2YfADn0umyLNrYpO-t4_c88Y4r8QdFRem7pgjTe8SSJog@mail.gmail.com%3E for a discussion.  This is supposed to be fixed by the Dockerization stuff in Yetus, so hopefully it won't re-occur.

Thanks [~cmccabe]!
Just finished extensive local testing, will upload a patch and hopefully it will work well now.

Few more places that had assumptions about IPv4 format handled, ran locally all tests using ./dev-support/test-patch.sh --run-tests let's see if QAbot is in better mood.


\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  22m 37s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 16 new or modified test files. |
| {color:green}+1{color} | javac |   7m 50s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 10s | There were no new javadoc warning messages. |
| {color:red}-1{color} | release audit |   0m 15s | The applied patch generated 1 release audit warnings. |
| {color:red}-1{color} | checkstyle |   3m 33s | The applied patch generated  6 new checkstyle issues (total was 339, now 345). |
| {color:red}-1{color} | checkstyle |   4m 34s | The applied patch generated  2 new checkstyle issues (total was 51, now 52). |
| {color:red}-1{color} | whitespace |   0m 27s | The patch has 4  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 41s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 33s | The patch built with eclipse:eclipse. |
| {color:red}-1{color} | findbugs |  15m 35s | The patch appears to introduce 7 new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |   7m 37s | Tests failed in hadoop-common. |
| {color:green}+1{color} | mapreduce tests |   1m 46s | Tests passed in hadoop-mapreduce-client-core. |
| {color:green}+1{color} | mapreduce tests |   5m 52s | Tests passed in hadoop-mapreduce-client-hs. |
| {color:red}-1{color} | mapreduce tests | 100m 42s | Tests failed in hadoop-mapreduce-client-jobclient. |
| {color:green}+1{color} | yarn tests |   2m  5s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 30s | Tests passed in hadoop-yarn-server-common. |
| {color:red}-1{color} | yarn tests |   8m 31s | Tests failed in hadoop-yarn-server-nodemanager. |
| {color:red}-1{color} | yarn tests |  55m 37s | Tests failed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 29s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests |   0m 30s | Tests failed in hadoop-hdfs. |
| {color:red}-1{color} | hdfs tests |   0m 26s | Tests failed in hadoop-hdfs-client. |
| | | 249m 10s | |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hadoop-hdfs-client |
| Failed unit tests | hadoop.crypto.key.TestValueQueue |
|   | hadoop.mapred.TestNetworkedJob |
|   | hadoop.yarn.server.nodemanager.TestNodeStatusUpdaterForLabels |
|   | hadoop.yarn.server.resourcemanager.applicationsmanager.TestAMRestart |
| Timed out tests | org.apache.hadoop.yarn.server.resourcemanager.recovery.TestFSRMStateStore |
| Failed build | hadoop-hdfs |
|   | hadoop-hdfs-client |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12766458/HADOOP-12122-HADOOP-11890.6.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/patchReleaseAuditProblems.txt |
| checkstyle |  https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/diffcheckstylehadoop-common.txt https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/diffcheckstylehadoop-mapreduce-client-hs.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/whitespace.txt |
| Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs-client.html |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-mapreduce-client-core test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-mapreduce-client-core.txt |
| hadoop-mapreduce-client-hs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-mapreduce-client-hs.txt |
| hadoop-mapreduce-client-jobclient test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-mapreduce-client-jobclient.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7809/console |


This message was automatically generated.

Fixed whitespace, ran all QA bot failed tests locally on HADOOP-11890 branch both before any changes came in (head 439f43ad3defbac907eda2d139a793f153544430) and after all patches, this is what I see:
  1. TestNetworkedJob --> Failed with same error in both heads
  2. TestNodestatusUpdaterForLabels --> Passes locally in both setups, probably flaky test?
  3. TestAMRestart class of tests --> In QABot all failed with NoClassDefFound, locally all are passing in both heads.
   4. Fake build breaks are still here.

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  22m 45s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 16 new or modified test files. |
| {color:green}+1{color} | javac |   7m 54s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  10m 25s | There were no new javadoc warning messages. |
| {color:red}-1{color} | release audit |   0m 16s | The applied patch generated 1 release audit warnings. |
| {color:red}-1{color} | checkstyle |   3m 32s | The applied patch generated  4 new checkstyle issues (total was 338, now 342). |
| {color:red}-1{color} | whitespace |   0m 19s | The patch has 1  line(s) that end in whitespace. Use git apply --whitespace=fix. |
| {color:green}+1{color} | install |   1m 29s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 34s | The patch built with eclipse:eclipse. |
| {color:red}-1{color} | findbugs |  15m 43s | The patch appears to introduce 7 new Findbugs (version 3.0.0) warnings. |
| {color:green}+1{color} | common tests |   7m  6s | Tests passed in hadoop-common. |
| {color:red}-1{color} | mapreduce tests |   1m 42s | Tests failed in hadoop-mapreduce-client-core. |
| {color:red}-1{color} | mapreduce tests |   5m 42s | Tests failed in hadoop-mapreduce-client-hs. |
| {color:red}-1{color} | mapreduce tests |   0m 13s | Tests failed in hadoop-mapreduce-client-jobclient. |
| {color:red}-1{color} | yarn tests |   0m 20s | Tests failed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 24s | Tests passed in hadoop-yarn-server-common. |
| {color:red}-1{color} | yarn tests |   0m 22s | Tests failed in hadoop-yarn-server-nodemanager. |
| {color:red}-1{color} | yarn tests |   0m 23s | Tests failed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 22s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests |   0m 23s | Tests failed in hadoop-hdfs. |
| {color:red}-1{color} | hdfs tests |   0m 19s | Tests failed in hadoop-hdfs-client. |
| | |  81m  1s | |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hadoop-hdfs-client |
| Failed unit tests | hadoop.mapred.TestJobEndNotifier |
|   | hadoop.mapreduce.v2.hs.webapp.TestHsWebServices |
|   | hadoop.mapreduce.v2.hs.webapp.TestHsWebServicesJobConf |
| Failed build | hadoop-mapreduce-client-jobclient |
|   | hadoop-yarn-common |
|   | hadoop-yarn-server-nodemanager |
|   | hadoop-yarn-server-resourcemanager |
|   | hadoop-hdfs |
|   | hadoop-hdfs-client |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12766589/HADOOP-12122-HADOOP-11890.7.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/patchReleaseAuditProblems.txt |
| checkstyle |  https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/diffcheckstylehadoop-common.txt |
| whitespace | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/whitespace.txt |
| Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs-client.html |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-mapreduce-client-core test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-mapreduce-client-core.txt |
| hadoop-mapreduce-client-hs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-mapreduce-client-hs.txt |
| hadoop-mapreduce-client-jobclient test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-mapreduce-client-jobclient.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf902.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7812/console |


This message was automatically generated.

Getting sloppy with unused imports on patch 7, removed them here

\\
\\
| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | pre-patch |  25m 19s | Findbugs (version 3.0.0) appears to be broken on HADOOP-11890. |
| {color:green}+1{color} | @author |   0m  0s | The patch does not contain any @author tags. |
| {color:green}+1{color} | tests included |   0m  0s | The patch appears to include 16 new or modified test files. |
| {color:green}+1{color} | javac |   8m 47s | There were no new javac warning messages. |
| {color:green}+1{color} | javadoc |  11m 20s | There were no new javadoc warning messages. |
| {color:red}-1{color} | release audit |   0m 17s | The applied patch generated 1 release audit warnings. |
| {color:green}+1{color} | checkstyle |   4m 51s | There were no new checkstyle issues. |
| {color:green}+1{color} | whitespace |   0m 20s | The patch has no lines that end in whitespace. |
| {color:green}+1{color} | install |   1m 42s | mvn install still works. |
| {color:green}+1{color} | eclipse:eclipse |   0m 38s | The patch built with eclipse:eclipse. |
| {color:red}-1{color} | findbugs |  17m 48s | The patch appears to introduce 7 new Findbugs (version 3.0.0) warnings. |
| {color:red}-1{color} | common tests |   8m  2s | Tests failed in hadoop-common. |
| {color:green}+1{color} | mapreduce tests |   1m 59s | Tests passed in hadoop-mapreduce-client-core. |
| {color:green}+1{color} | mapreduce tests |   6m  6s | Tests passed in hadoop-mapreduce-client-hs. |
| {color:red}-1{color} | mapreduce tests | 108m 27s | Tests failed in hadoop-mapreduce-client-jobclient. |
| {color:green}+1{color} | yarn tests |   2m 42s | Tests passed in hadoop-yarn-common. |
| {color:green}+1{color} | yarn tests |   0m 40s | Tests passed in hadoop-yarn-server-common. |
| {color:red}-1{color} | yarn tests |   9m 34s | Tests failed in hadoop-yarn-server-nodemanager. |
| {color:green}+1{color} | yarn tests |  58m 42s | Tests passed in hadoop-yarn-server-resourcemanager. |
| {color:green}+1{color} | yarn tests |   0m 33s | Tests passed in hadoop-yarn-server-web-proxy. |
| {color:red}-1{color} | hdfs tests |  55m 54s | Tests failed in hadoop-hdfs. |
| {color:green}+1{color} | hdfs tests |   0m 39s | Tests passed in hadoop-hdfs-client. |
| | | 324m 32s | |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hadoop-hdfs-client |
| Failed unit tests | hadoop.ha.TestZKFailoverController |
|   | hadoop.fs.TestLocalFsFCStatistics |
|   | hadoop.mapred.TestNetworkedJob |
|   | hadoop.yarn.server.nodemanager.TestNodeStatusUpdaterForLabels |
|   | hadoop.hdfs.web.TestWebHdfsTokens |
|   | hadoop.hdfs.TestRecoverStripedFile |
|   | hadoop.hdfs.TestWriteReadStripedFile |
| Timed out tests | org.apache.hadoop.hdfs.server.datanode.TestDataNodeRollingUpgrade |
|   | org.apache.hadoop.hdfs.server.datanode.TestIncrementalBrVariations |
|   | org.apache.hadoop.hdfs.server.datanode.TestDirectoryScanner |
\\
\\
|| Subsystem || Report/Notes ||
| Patch URL | http://issues.apache.org/jira/secure/attachment/12766631/HADOOP-12122-HADOOP-11890.8.patch |
| Optional Tests | javadoc javac unit findbugs checkstyle |
| git revision | HADOOP-11890 / f33be9a |
| Release Audit | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/patchReleaseAuditProblems.txt |
| Findbugs warnings | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs-client.html |
| hadoop-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-common.txt |
| hadoop-mapreduce-client-core test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-mapreduce-client-core.txt |
| hadoop-mapreduce-client-hs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-mapreduce-client-hs.txt |
| hadoop-mapreduce-client-jobclient test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-mapreduce-client-jobclient.txt |
| hadoop-yarn-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-yarn-common.txt |
| hadoop-yarn-server-common test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-yarn-server-common.txt |
| hadoop-yarn-server-nodemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-yarn-server-nodemanager.txt |
| hadoop-yarn-server-resourcemanager test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-yarn-server-resourcemanager.txt |
| hadoop-yarn-server-web-proxy test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-yarn-server-web-proxy.txt |
| hadoop-hdfs test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-hdfs.txt |
| hadoop-hdfs-client test log | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/artifact/patchprocess/testrun_hadoop-hdfs-client.txt |
| Test Results | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/testReport/ |
| Java | 1.7.0_55 |
| uname | Linux asf901.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Console output | https://builds.apache.org/job/PreCommit-HADOOP-Build/7814/console |


This message was automatically generated.

There's a ton of star imports.
Can we get some ipv6 ip's in the tests that you had to change?

Comments on TestNetUtils are just wrong.
pom.xml still turns off ipv6 wouldn't allowing ipv6 stack make the tests more representative? It should fully work now correct?
Comment IPCLoggerChannel why is it doing the dance of ip instanceof Inet6Address?
DatanodeManager talks about BasicInetPeer why not just change that?
Checkpointer seems like that's still not very elegant code. Is there something better ?
HostUtil creates a logger and never uses it. Remove it if it's not going to be needed.
ConverterUtils' logger looks really weird.
NetUtils' javadoc seems weird. Why add an extra line that says basically the same thing to a single method?

Important changes:
1. Found one more place in code that uses IPv4 --> BlockPoolSliceStorage.java and causes TestRollingUpgrade test case to fail.This one slipped my testing before as this test case fails sometimes on "base" build as well :(
Problem with just using IPv6 address is that HDFS doesn't consider ":" in path to be valid (see HADOOP-3257)
I don't have good context here on what intention of original naming scheme was, there is only one place where this is used so I assume only intention was to be able to match path easily.

2. Removed all "preferIPv4" occurrences. On my test servers (both IPv6-only one and dual stack one) I only see test case failures identical to failures in base build (build off of HADOOP-11890 without any of IPv6 patches). There is one test case (TestUmbilicalProtocolWithJobToken) that claims it depends on preferIPv4 being set, however on my box it isn't passing in base build either.

Comments not addressed:
DatanodeManager --> Basically comment there was too long and detailed, but code is going the right thing so just shortened comment.
Checkpointer --> I think this was intention of previous code, just split on last ":" and take whatever is before and after as "host" and "port", hence keeping that semantics true even if someone passed in IPv6 (bracketed or not).

Not so important changes:
- Added some more IPv6 specific tests
- Fixed star imports
- Fixed bunch of small things (comments, whitespace, style)
IPCLoggerChannel is not doing stupid stuff anymore

Testing:
Ran all tests locally again on dual stack and IPv6 servers again, ran in IPv6 cluster teragen/terasort/teravalidate and in IPv6 HBase cluster IntegrationTestBigLinkedList, checked locality is working in this test case, checked includes/excludes is working well.

FYI:

This patch was already very large (module-count-wise) that it barely fit in the 500m limit on the old test-patch code/setup.  Now that both JDK 1.7 and JDK 1.8 are being testing, it goes over the limit and Jenkins kills it before completion.  So this patch absolutely must get broken into multiple parts....


OK, it looks like I missed the patch where parallel builds were fully enabled in Hadoop.  I've updated the Yetus personality for Hadoop and re-kicked this patch off.  Cross your fingers. :)

[~aw] - I guess I have to split this patch into multiple smaller patches as there are no QABot results coming in?

Yeah, it just got killed off a bit ago.  To put this in perspective, you're triggering all of the long unit tests:

hadoop-yarn-server-resourcemanager - 56 minutes
hadoop-hdfs - 54 minutes
hadoop-mapreduce-client-jobclient - 102 minutes

(and that's *with* parallel tests turned on!)

The precommit job needs to finish in less than 500 minutes or Jenkins will shoot it.  You're at 300 minutes just in unit tests and that's only for one JDK.  I'd recommend splitting this up into four, one for each of the major hadoop projects.  Patch+commit order should be common, hdfs, yarn, then mapreduce.

[~busbey], [~aw]: How about giving people the ability to skip the jdk8 test run if their patch has a certain path name, like {{mypatch.nojdk8.patch}}?  Multi-module patches have been the norm in Hadoop for a while, it seems like a regression if we are losing that ability (even if only partially)

Multi-module patches that touch 2 of those listed above have had a significantly higher chance for spurious failures even on the old test-patch code base for the past year.  There have been many many many times we've told contributors to break a patch up.  While the new test-patch code base fixes a ton of those spurious errors by using separate maven repos and running them within a container, it can't fix the time limit that Jenkins places. So a more realistic approach to fixing this (rather than making Yetus pick up some significant technical debt) is to start a conversation with INFRA to allow Hadoop to increase their timeout... never mind making the tests run shorter.  (I think it's only 3-4 tests that take up 25% of the RM unit test time...)

bq. How about giving people the ability to skip the jdk8 test run if their patch has a certain path name, like mypatch.nojdk8.patch?

I would not want plugins to take arguments from patch names, since that quickly leads us down an unsustainable path.

How about a version of YETUS-105 that instead of rejecting a patch degrades options like multi-jdk (while giving an appropriate negative vote)? I'd still be concerned that this could lead to a project getting inconsistent results (such as javadoc errors that only cause a failure under jdk8), but since it'd be opt-in we could suitably warn in docs.

bq. Multi-module patches have been the norm in Hadoop for a while, it seems like a regression if we are losing that ability (even if only partially)

If the Hadoop project wants to consider that a regression, then I'd say the Hadoop project would have to weigh the benefits of testing multiple jdks against the cost of having to break up patches.

Resolving in favor of the per module issues.

