Pushed to master. Thanks [~szita] and [~pvary] for the reviews.

