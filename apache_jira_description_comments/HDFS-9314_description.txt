The test case used in HDFS-9313 identified NullPointerException as well as the limitation of excess replica picking. If the current replicas are on {SSD(rack r1), DISK(rack 2), DISK(rack 3), DISK(rack 3)} and the storage policy changes to HOT_STORAGE_POLICY_ID, BlockPlacementPolicyDefault's won't be able to delete SSD replica.