{panel:title=--&gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2822868&amp;buildTypeId=IgniteTests24Java8_RunAll]

{panel:title=-&gt; Run :: MVCC Cache: Possible Blockers|borderStyle=dashed|borderColor=#ccc|titleBGColor=#F7D6C1}
{color:#d04437}MVCC PDS 1{color} [[tests 32|https://ci.ignite.apache.org/viewLog.html?buildId=2822879]]
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateSimple_5_Servers_5_Clients_FromClient - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testClientReconnectClusterActivateInProgress - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateSimple_5_Servers_5_Clients - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateSimple_5_Servers - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateFailover1 - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateFailover2 - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testClientReconnectClusterActive - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateSimple_5_Servers2 - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateFailover1 - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateSimple_5_Servers_5_Clients - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testJoinWhileDeactivate1_Server - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testJoinWhileActivate1_Client - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testJoinWhileDeactivate1_Client - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testInactiveTopologyChanges - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateSimple_SingleNode - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testConcurrentJoinAndActivate - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateSimple_5_Servers_5_Clients_FromClient - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateSimple_5_Servers - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateSimple_5_Servers2 - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testClientReconnectClusterDeactivateInProgress - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testDeactivateSimple_SingleNode - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testClientReconnectClusterDeactivated - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testClientReconnectClusterActivated - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateCachesRestore_SingleNode - 2,3% fails in last 608 master runs.
* IgnitePdsMvccTestSuite: IgniteClusterActivateDeactivateTestWithPersistence.testActivateCachesRestore_5_Servers - 2,3% fails in last 608 master runs.

{color:#d04437}MVCC PDS 4{color} [[tests 30|https://ci.ignite.apache.org/viewLog.html?buildId=2822882]]
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testInactiveTopologyChanges - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testJoinWhileDeactivate1_Client - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateFailover2 - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testDeactivateFailover2 - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testDeactivateFailover1 - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testJoinWhileDeactivate1_Server - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateSimple_5_Servers2 - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateSimple_5_Servers_5_Clients - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateSimple_SingleNode - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testJoinWhileActivate1_Client - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testDeactivateSimple_SingleNode - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testConcurrentJoinAndActivate - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testClientReconnectClusterActivated - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testClientReconnectClusterDeactivateInProgress - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateSimple_5_Servers - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateSimple_5_Servers_5_Clients_FromClient - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testClientReconnectClusterDeactivated - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateCachesRestore_SingleNode - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateCachesRestore_5_Servers - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testActivateFailover1 - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testClientReconnectClusterActive - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testDeactivateSimple_5_Servers_5_Clients_FromClient - 2,3% fails in last 607 master runs.
* IgnitePdsMvccTestSuite4: IgniteClusterActivateDeactivateTestWithPersistenceAndMemoryReuse.testDeactivateSimple_5_Servers - 2,3% fails in last 607 master runs.

{panel}
[TeamCity *-&gt; Run :: MVCC Cache* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2822883&amp;buildTypeId=IgniteTests24Java8_RunMvccCache]

[~gvvinblade], patch is ready for review. Tests look good. Multiple fails in MVCC Cache suite are caused by some problems in the master branch.

[~rkondakov], please merge last master and rerun tests.

{panel:title=-&gt; Run :: MVCC Cache: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *-&gt; Run :: MVCC Cache* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2861319&amp;buildTypeId=IgniteTests24Java8_RunMvccCache]

{panel:title=--&gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2861304&amp;buildTypeId=IgniteTests24Java8_RunAll]

{panel:title=--&gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2929946&amp;buildTypeId=IgniteTests24Java8_RunAll]

[~gvvinblade], I made fixes proposed by yours. Patch is ready for review. Tests look good. 

[~rkondakov] The thing I not sure about is the CQ handler. Is it really necessary to keep pending events during the handler registration? I think it can be easily omitted by increasing registration write lock scope.

[~gvvinblade],
 # Listeners initialization (obtaining the current update counters map) was moved under the listeners write lock. This allows to avoid collecting pending events in the dedicated map.
 # Listener registration lock has been moved from the cache context to the group context to avoid races between adding cache to the {{CacheGroupContext#contQryCaches}} and listeners registration. When each cache has it's own listener lock, adding and notifying listeners are not synchronized between different caches within same group. And there were possible situations when uninitialized listener was supplied with a skip update event fired in the neighbor cache.

{panel:title=--&gt; Run :: All: No blockers found!|borderStyle=dashed|borderColor=#ccc|titleBGColor=#D6F7C1}{panel}
[TeamCity *--&gt; Run :: All* Results|https://ci.ignite.apache.org/viewLog.html?buildId=2998320&amp;buildTypeId=IgniteTests24Java8_RunAll]

[~gvvinblade], tests look goo. Patch is ready for review.

[~rkondakov], now it's way better, merged to master.

