Backport changes of flaky test fix to branch-3.4 :

https://issues.apache.org/jira/browse/ZOOKEEPER-2484
 