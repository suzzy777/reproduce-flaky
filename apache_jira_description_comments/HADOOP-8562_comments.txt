Attaching a merge patch for all the changes that need to be merged from branch-trunk-win to trunk.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12560729/branch-trunk-win.patch
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1861//console

This message is automatically generated.

Looks like this patch has unrelated changes in it as well?

I see, let me check.

I diffed against a wrong branch (branch-1-win) instead of trunk. Here is the correct patch.

The patch still undoes a bunch of changes that have gone into trunk recently (look at the CHANGES.txt removals in the diff for example). I think you need to merge trunk into the windows branch before doing this diff.

Todd, I just wanted to post a patch to get Jenkins results and to give an idea how a merge patch looks. This patch is not intended to be committed. There is still some work left in passing 100% unit tests on windows etc.

Updated patch.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12560915/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 61 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:red}-1 findbugs{color}.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:

                  org.apache.hadoop.mapreduce.v2.app.job.impl.TestMapReduceChildJVM
                  org.apache.hadoop.streaming.TestStreamingBadRecords
                  org.apache.hadoop.streaming.TestMultipleCachefiles
                  org.apache.hadoop.streaming.TestMultipleArchiveFiles
                  org.apache.hadoop.streaming.TestStreamingTaskLog
                  org.apache.hadoop.streaming.TestFileArgs
                  org.apache.hadoop.streaming.TestSymLink
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/1871//testReport/
Findbugs warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/1871//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-common.html
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1871//console

This message is automatically generated.

The FindBugs warnings look legitimate, so we'll need to fix those.

{{TestMapReduceChildJVM}} will be fixed by committing the patch attached to MAPREDUCE-4869.

All of the test failures in streaming are caused by "Queue configuration missing child queue names for root".  I can repro this even on the trunk codebase, so it appears to be unrelated to the branch-trunk-win merge.

{{TestNodeManagerShutdown}} has the same failure for me even on trunk, so it appears to be unrelated to the branch-trunk-win merge.

For all other YARN test failures, I can't repro.  I tried trunk, branch-trunk-win, and trunk + this merge patch.  For all of these, I saw no failures in {{TestContainerManager}}, {{TestContainersMonitor}}, or {{TestContainerLaunch}}.


Updated patch.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12561134/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 60 new or modified test files.

      {color:red}-1 javac{color}.  The applied patch generated 2016 javac compiler warnings (more than the trunk's current 2013 warnings).

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:

                  org.apache.hadoop.fs.TestFileUtil
                  org.apache.hadoop.mapreduce.v2.app.job.impl.TestMapReduceChildJVM
                  org.apache.hadoop.streaming.TestStreamingBadRecords
                  org.apache.hadoop.streaming.TestMultipleCachefiles
                  org.apache.hadoop.streaming.TestMultipleArchiveFiles
                  org.apache.hadoop.streaming.TestStreamingTaskLog
                  org.apache.hadoop.streaming.TestFileArgs
                  org.apache.hadoop.streaming.TestSymLink
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/1883//testReport/
Javac warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/1883//artifact/trunk/patchprocess/diffJavacWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1883//console

This message is automatically generated.

Updated patch.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12561221/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 26 new or modified test files.

      {color:red}-1 javac{color}.  The applied patch generated 2016 javac compiler warnings (more than the trunk's current 2013 warnings).

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:

                  org.apache.hadoop.fs.TestFileUtil
                  org.apache.hadoop.mapreduce.v2.app.job.impl.TestMapReduceChildJVM
                  org.apache.hadoop.streaming.TestSymLink
                  org.apache.hadoop.streaming.TestMultipleCachefiles
                  org.apache.hadoop.streaming.TestStreamingBadRecords
                  org.apache.hadoop.streaming.TestFileArgs
                  org.apache.hadoop.streaming.TestMultipleArchiveFiles
                  org.apache.hadoop.streaming.TestStreamingTaskLog
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/1894//testReport/
Javac warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/1894//artifact/trunk/patchprocess/diffJavacWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1894//console

This message is automatically generated.

The failure in {{TestFileUtil}} is caused by 2 missing tar files required for testing untar functionality.  Patch files don't seem to have a good way to carry over binary files, so we'll need to add them manually with the merge.  I have attached test-untar.tar and test-untar.tgz.  These must be committed to hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs when it's time.

All of the streaming failures are unrelated to the merge.  The current trunk code has the same problem.  I submitted a patch on MAPREDUCE-4884 to fix it.

For the failures in {{TestContainerManager}}, {{TestContainerLaunch}}, and {{TestContainersMonitor}}, I still don't have a repro or an explanation.  It seems to be only happening on Jenkins.  These need further investigation.


{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12561257/test-untar.tgz
  against trunk revision .

    {color:red}-1 patch{color}.  The patch command could not apply the patch.

Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1897//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12561323/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 26 new or modified test files.

      {color:red}-1 javac{color}.  The applied patch generated 2016 javac compiler warnings (more than the trunk's current 2013 warnings).

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:

                  org.apache.hadoop.fs.TestFileUtil
                  org.apache.hadoop.mapreduce.v2.app.job.impl.TestMapReduceChildJVM
                  org.apache.hadoop.streaming.TestSymLink
                  org.apache.hadoop.streaming.TestMultipleCachefiles
                  org.apache.hadoop.streaming.TestStreamingBadRecords
                  org.apache.hadoop.streaming.TestFileArgs
                  org.apache.hadoop.streaming.TestMultipleArchiveFiles
                  org.apache.hadoop.streaming.TestStreamingTaskLog
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/1900//testReport/
Javac warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/1900//artifact/trunk/patchprocess/diffJavacWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/1900//console

This message is automatically generated.

Updated merge patch

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12566396/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 29 new or modified test files.

      {color:red}-1 javac{color}.  The applied patch generated 2017 javac compiler warnings (more than the trunk's current 2014 warnings).

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

        {color:red}-1 release audit{color}.  The applied patch generated 4 release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:

                  org.apache.hadoop.fs.TestFileUtil
                  org.apache.hadoop.yarn.server.nodemanager.webapp.TestNMWebServices
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2088//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2088//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Javac warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2088//artifact/trunk/patchprocess/diffJavacWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2088//console

This message is automatically generated.

A few notes on the test failures:

TestFileUtil - This has the same root cause mentioned earlier: the test depends on a tar file to be checked in as test input, and the diffs are not carrying over binary files.

TestNMWebServices - This is a trunk bug, which will be fixed by the patch that [~kkambatl] and I wrote for HADOOP-9246.

TestContainerManager, TestNodeManagerShutdown, TestContainerLaunch, TestContainersMonitor - These need further investigation.  I cannot repro the test failures on Mac, but I can repro them on Ubuntu.  Only branch-trunk-win has the failures, not trunk.  Perhaps some of the branch-trunk-win changes in container launching caused a regression.  I filed YARN-359.


Latest merge patch.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12567057/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 32 new or modified test files.

      {color:red}-1 javac{color}.  The applied patch generated 2017 javac compiler warnings (more than the trunk's current 2014 warnings).

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:red}-1 findbugs{color}.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.

        {color:red}-1 release audit{color}.  The applied patch generated 4 release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.fs.TestFileUtil
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.TestContainerManager
                  org.apache.hadoop.yarn.server.nodemanager.TestNodeManagerShutdown
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.launcher.TestContainerLaunch
                  org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.TestContainersMonitor

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2117//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2117//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Findbugs warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2117//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-common.html
Javac warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2117//artifact/trunk/patchprocess/diffJavacWarnings.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2117//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12568491/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 34 new or modified test files.

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

        {color:red}-1 release audit{color}.  The applied patch generated 1 release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.fs.http.client.TestHttpFSFWithWebhdfsFileSystem

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2174//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2174//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2174//console

This message is automatically generated.

The test failure in {{TestHttpFSFWithWebhdfsFileSystem}} appears to be unrelated to branch-trunk-win changes, as other builds have been failing intermittently for the same reason.  For example, see https://builds.apache.org/job/Hadoop-Hdfs-trunk/1312/ .

The release audit warning is on /home/jenkins/jenkins-slave/workspace/PreCommit-HADOOP-Build/trunk/hadoop-common-project/hadoop-common/CHANGES.txt.orig.  That file is not in the latest patch, so I'm not sure where it came from.


bq. CHANGES.txt.orig
This must be from my dev area (due to merge issues). Next merge patch should not have this.

Given some of the discussion on recent merge thread, I am asking for any reviewers interested in reviewing this patch to start reviewing this patch. I plan to call for merge vote in a week or so. 

My +1 for the consolidated patch.

+1 non-binding

This code has been tested successfully on Linux and Windows for the past several months.


+1 non-binding

We have extensively tested this on both Linux and Windows.

+1 non-binding

Tested it thoroughly

+1 non-binding

Here is a patch I am attaching that excludes cmd changes, winutils changes and pom changes to give an idea how much change is in core hadoop.

The number of lines goes to 1537 lines from the original file size of 15958 lines.

Canceling the patch for now.

Suresh, your branch-trunk-win-min.patch includes only Yarn changes. Changes for common and hdfs are not there. I guess it will be more than 1537 lines then?

bq. Suresh, your branch-trunk-win-min.patch includes only Yarn changes. Changes for common and hdfs are not there. I guess it will be more than 1537 lines then?

yes. Sorry I removed more than necessary. I have attached two versions of the smaller patch. 
https://issues.apache.org/jira/secure/attachment/12571663/branch-trunk-win.min.patch (8756 lines)
https://issues.apache.org/jira/secure/attachment/12571660/branch-trunk-win.min-notest.patch (5996 lines)

It should make it easier to get an idea the changes.


Thanks. This is better indeed. Shows significant test coverage.
Few general comments on the patch
# /hadoop-common-project/hadoop-common/src/main/native/native.sln and a few other new files do not have Apache license.
# Do you still need files CHANGES.branch-trunk-win.txt? It will be incorporated into CHANGES.txt?
# Do we still need cygwin after that patch? If not shouldn't all cygpath occurrences be removed?

[~shv] Thanks for review.
I think native.sln is added to list of files that should be ignored from Apache license text check. [~cnauroth] can .sln files support inclusion of Apache license?

bq. Do you still need files CHANGES.branch-trunk-win.txt? It will be incorporated into CHANGES.txt?
Yes. After the merge I will remove that file and merge it into CHANGES.txt as done for previous feature branch changes.

bq. Do we still need cygwin after that patch? If not shouldn't all cygpath occurrences be removed?
[~cnauroth] can you please answer this?


{quote}
Chris Nauroth can .sln files support inclusion of Apache license?
{quote}

Yes, we have the license header in winutils.sln, but we must have forgotten to add it to native.sln.  I'll prepare a patch to add it.

{quote}
Do we still need cygwin after that patch? If not shouldn't all cygpath occurrences be removed?
{quote}

We do not need cygwin.  I'll prepare a patch to remove the remaining occurrences of cygpath.


Makes sense guys, thanks.

Submitting latest merge patch to Jenkins precommit build.

Precommit build has timeout set to 180 minutes. Running tests for all the projects takes more than 180 minutes. Hence no results are posted from the Jenkins build.

Here are the results of the test completed so far - https://builds.apache.org/job/PreCommit-HADOOP-Build/2263/testReport/

I have asked [~gkesavan] to see if the timeout can be increased.


Suresh, I ve increased the jenkins build abort threshold and set it to 300 minutes.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12572045/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 36 new or modified test files.

  {color:red}-1 one of tests included doesn't have a timeout.{color}

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

        {color:red}-1 release audit{color}.  The applied patch generated 1 release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.streaming.TestStreamReduceNone
                  org.apache.hadoop.streaming.TestStreamXmlRecordReader
                  org.apache.hadoop.test.TestHFSTestCase
                  org.apache.hadoop.fs.http.server.TestHttpFSServer
                  org.apache.hadoop.fs.http.client.TestHttpFSFWithWebhdfsFileSystem
                  org.apache.hadoop.fs.http.client.TestHttpFSFileSystemLocalFileSystem
                  org.apache.hadoop.lib.service.hadoop.TestFileSystemAccessService
                  org.apache.hadoop.fs.http.client.TestHttpFSWithHttpFSFileSystem

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2266//testReport/
Release audit warnings: https://builds.apache.org/job/PreCommit-HADOOP-Build/2266//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2266//console

This message is automatically generated.

release audit is related to CHANGES.txt.orig file and is due to patch not cleanly applying. Some of the test failures are due to MiniDFSCluster related timeout. It would have been good to flag the tests that do not have timeout. I will dig into it.

Updated patch.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12572231/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 36 new or modified test files.

  {color:red}-1 one of tests included doesn't have a timeout.{color}

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.streaming.TestStreamReduceNone
                  org.apache.hadoop.streaming.TestStreamXmlRecordReader

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2269//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2269//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12572248/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 37 new or modified test files.

    {color:green}+1 tests included appear to have a timeout.{color}

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.util.TestWinUtils
                  org.apache.hadoop.mapreduce.v2.TestMRJobs
                  org.apache.hadoop.streaming.TestStreamReduceNone
                  org.apache.hadoop.streaming.TestStreamXmlRecordReader

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2271//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2271//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12572248/branch-trunk-win.patch
  against trunk revision .

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 37 new or modified test files.

    {color:green}+1 tests included appear to have a timeout.{color}

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 eclipse:eclipse{color}.  The patch built with eclipse:eclipse.

    {color:green}+1 findbugs{color}.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 core tests{color}.  The patch failed these unit tests in hadoop-assemblies hadoop-common-project/hadoop-common hadoop-dist hadoop-hdfs-project/hadoop-hdfs hadoop-hdfs-project/hadoop-hdfs-httpfs hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-app hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-common hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-shuffle hadoop-tools/hadoop-streaming hadoop-yarn-project/hadoop-yarn/hadoop-yarn-api hadoop-yarn-project/hadoop-yarn/hadoop-yarn-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-tests:

                  org.apache.hadoop.util.TestWinUtils
                  org.apache.hadoop.mapreduce.v2.TestMRJobs
                  org.apache.hadoop.streaming.TestStreamReduceNone
                  org.apache.hadoop.streaming.TestStreamXmlRecordReader

    {color:green}+1 contrib tests{color}.  The patch passed contrib unit tests.

Test results: https://builds.apache.org/job/PreCommit-HADOOP-Build/2272//testReport/
Console output: https://builds.apache.org/job/PreCommit-HADOOP-Build/2272//console

This message is automatically generated.

TestWinUtils and TestMRJobs failures are caused by HADOOP-9368. I'll reactivate it and add a patch.

Not sure about the other two. Will look tomorrow.

org.apache.hadoop.streaming.TestStreamReduceNone
org.apache.hadoop.streaming.TestStreamXmlRecordReader

These two failures look unrelated to the patch. They repro on current trunk.

bq. TestWinUtils and TestMRJobs failures are caused by HADOOP-9368. I'll reactivate it and add a patch
Lets create a separate Jira to address this. I am going to merge this patch to trunk shortly. 

TestStreamReduceNone and TestStreamXmlRecordReader are tracked by MAPREDUCE-5006


I committed the patch to trunk. Thanks to van Mitic, Chuan Liu, Ramya Sunil, Bikas Saha, Kanna Karanam, John Gordon, Brandon Li, Chris Nauroth, David Lao, Sumadhur Reddy Bolli, Arpit Agarwal, Ahmed El Baz, Mike Liddell, Jing Zhao, Thejas Nair, Steve Maine, Ganeshan Iyer, Raja Aluri, Giridharan Kesavan, Ramya Bharathi Nimmagadda, Daryn Sharp, Arun Murthy, Tsz-Wo Nicholas Sze, Suresh Srinivas and Sanjay Radia. Also thanks to others who provided comments on the jiras and participated in the discussions.

The changes from this jira and related jiras from HDFS and YARN has been in trunk for some time now. If there are no objections, I plan on merging these changes to branch-2 early next week.

I plan on merging changes from this jira and related jiras to branch-2 by the end of the day, per my previous comment.

+1 for merge to branch-2.  Thanks, Suresh!

Initial patch for merge to branch-2.

Updated merge patch to include fix for HADOOP-9372.

So far, I see the following problems in the branch-2 merge patch:

# hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWinUtils.java appears to be incorrect.  In particular, there are {{@Test}} annotations on private methods that aren't annotated in trunk.  This causes JUnit to fail while trying to run the private methods as tests.  Probably the easiest way to resolve this is to just copy the current trunk version.
# hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java does not include the patches required for the test to pass on Windows.  This included timeout tuning and special handling for differences in symlink behavior on Windows.  Once again, I believe the easiest solution is just to copy the trunk version.


Chris, 1 and part of 2 should be fixed by the updated patch posted earlier.

More Windows fixes are still to be merged in.

{quote}
Chris, 1 and part of 2 should be fixed by the updated patch posted earlier.
{quote}

Yes, you're right.  I had been running the older patch.  Thanks, Arpit!

List of failures with the patch:

# TestBinaryTokenFile
# TestDistributedShell
# TestEncryptedShuffle
# TestMRJobsWithHistoryService
# TestNoDefaultsJobConf
# TestResources
# TestSymLink
# TestWebHdfsTimeouts
# TestYarnVersionInfo

Some of these are likely to be timeouts since I am running an underpowered VM. Chris just mentioned he can only reproduce two of these.

Yes, there were only 2 failures for me.

TestEncryptedShuffle appears to be flaky, approximately 1 failure in every 5 test runs for me.  This can occur on current branch-2, so it's unrelated to the merge patch.

TestMRJobsWithHistoryService has a timeout value that is too low for a slower dev environment, like a VM.  The current timeout is 30s.  I typically see it complete in just under 30s, and sometimes it creeps over that and times out.  I think we need to increase the timeout to accommodate slow VMs.  Again, this is unrelated to the merge patch, because I can repro on branch-2 without it.


Thanks for the verification Chris!

Thanks guys for running the tests. I plan to merge this change with + hadoop-9372. The other related jiras I will merge one at a time. [~vinodkv], [~arpitagarwal] and [~cnauroth], let me know of you guys are okay. 

Sounds good to me.

Thanks Suresh.

Sure, I'm holding off commits on YARN/MR. The test-failures can be fixed post merge.

I meant timeout issues with the tests, and randomly failing tests like TestEncryptedShuffle.

I think the merge patch is still missing MAPREDUCE-4987, which fixed handling of symlinks in the distributed cache on Windows.  HADOOP-9372 includes some of the timeout tuning, but it doesn't include the logic changes.

For example, here are links to some trunk code for ContainerLaunch and TestMRJobs.  I don't see this code in the merge patch.

https://github.com/apache/hadoop-common/blob/trunk/hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/containermanager/launcher/ContainerLaunch.java#L610

https://github.com/apache/hadoop-common/blob/trunk/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-jobclient/src/test/java/org/apache/hadoop/mapreduce/v2/TestMRJobs.java#L482


Arpit just let me know that the goal here is to merge the HADOOP-8562 changes, and since MAPREDUCE-4987 was not part of HADOOP-8562 (it was committed later), it is not included in the merge patch.  Remaining patches like this will get merged later.

Considering that, I am +1 for this merge patch.  Thanks, everyone.

Reopening the issue for merging.

I merge this patch into branch-2. Thank you every one for testing. Can you folks run another quick test to verify things are merged correctly?

The merge is looking good. Just two failures on Mac.

# TestRBWBlockInvalidation (timeout)
# TestBookKeeperHACheckpoints (JVM OOM)

Integrated in Hadoop-trunk-Commit #3790 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3790/])
    Update hadoop-common CHANGES.txt after merging HADOOP-8562 (Revision 1486288)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486288
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt


Integrated in Hadoop-Yarn-trunk #220 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/220/])
    Update hadoop-common CHANGES.txt after merging HADOOP-8562 (Revision 1486288)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486288
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt


Integrated in Hadoop-Hdfs-trunk #1410 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1410/])
    Update hadoop-common CHANGES.txt after merging HADOOP-8562 (Revision 1486288)

     Result = FAILURE
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486288
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt


Integrated in Hadoop-Mapreduce-trunk #1436 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1436/])
    Update hadoop-common CHANGES.txt after merging HADOOP-8562 (Revision 1486288)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486288
Files : 
* /hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt


Integrated in Hadoop-trunk-Commit #3791 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3791/])
    HADOOP-8562. Fix CHANGES.txt to move 8562 and related tasks to 2.0.5 section (Revision 1486334)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486334
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt


Integrated in Hadoop-trunk-Commit #3792 (See [https://builds.apache.org/job/Hadoop-trunk-Commit/3792/])
    HADOOP-8562. Moved related jiras to 2.0.5 section in CHANGES.txt (Revision 1486336)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486336
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt


Integrated in Hadoop-Yarn-trunk #221 (See [https://builds.apache.org/job/Hadoop-Yarn-trunk/221/])
    HADOOP-8562. Moved related jiras to 2.0.5 section in CHANGES.txt (Revision 1486336)
HADOOP-8562. Fix CHANGES.txt to move 8562 and related tasks to 2.0.5 section (Revision 1486334)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486336
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt

suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486334
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt


Integrated in Hadoop-Hdfs-trunk #1411 (See [https://builds.apache.org/job/Hadoop-Hdfs-trunk/1411/])
    HADOOP-8562. Moved related jiras to 2.0.5 section in CHANGES.txt (Revision 1486336)
HADOOP-8562. Fix CHANGES.txt to move 8562 and related tasks to 2.0.5 section (Revision 1486334)

     Result = FAILURE
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486336
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt

suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486334
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt


Integrated in Hadoop-Mapreduce-trunk #1437 (See [https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1437/])
    HADOOP-8562. Moved related jiras to 2.0.5 section in CHANGES.txt (Revision 1486336)
HADOOP-8562. Fix CHANGES.txt to move 8562 and related tasks to 2.0.5 section (Revision 1486334)

     Result = SUCCESS
suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486336
Files : 
* /hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt
* /hadoop/common/trunk/hadoop-yarn-project/CHANGES.txt

suresh : http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&view=rev&rev=1486334
Files : 
* /hadoop/common/trunk/hadoop-mapreduce-project/CHANGES.txt


