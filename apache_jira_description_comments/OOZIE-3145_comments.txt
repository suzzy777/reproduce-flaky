Not only TestDistcpMain produces garbage, I run the tests from core and from sharelib and they produced a lot of garbage. See the attached [^Oozie_test_garbage.png]. 

In most of the cases the files are created by the tested methods, not by the test case itself. I also found an open issue related the creation place of the files: [OOZIE-3025].

I think that we should change the place where the files are created in the [OOZIE-3025] issue, and then to make a general cleanup (for the other cases as well, not only for TestDistcpMain).

What do you think [~asasvari] ?  

[~kmarton] thanks for pointing this out and linking with related JIRA.  It should be possible to configure where these config and log files are generated though, but it needs some investigation. 

You are right, we can either change the summary and description of this ticket (if it is not too much effort to resolve activemq and sharelib related things at once) or file separate JIRAs.

These files are generated by the LauncherAM and the \*Main classes. They assume that they are running in a Yarn container so they just write to ./ as it will be cleaned up by Yarn. I think the easiest way to solve this is to clean up the log4j-\*.properties, \*.log and propagetion-conf.xml files int the XTestCase's tearDown() method.
Also, where it's possible use a temporaryFolder rule to target distCP and other action's output to somewhere else so the dist2.txt-like files are not there.


I'd like to rename this jira to something like ">git status< should be clean after >mvn test< was called".
Also, I'd file a follow-up jira that adds a check to our pre-commit check that ensures that mvn test won't create junk again.

PreCommit-OOZIE-Build started



Testing JIRA OOZIE-3145

Cleaning local git workspace

----------------------------

{color:green}+1 PATCH_APPLIES{color}
{color:green}+1 CLEAN{color}
{color:green}+1 RAW_PATCH_ANALYSIS{color}
.    {color:green}+1{color} the patch does not introduce any @author tags
.    {color:green}+1{color} the patch does not introduce any tabs
.    {color:green}+1{color} the patch does not introduce any trailing spaces
.    {color:green}+1{color} the patch does not introduce any line longer than 132
.    {color:green}+1{color} the patch adds/modifies 10 testcase(s)
{color:green}+1 RAT{color}
.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings
{color:green}+1 JAVADOC{color}
.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings
{color:green}+1 COMPILE{color}
.    {color:green}+1{color} HEAD compiles
.    {color:green}+1{color} patch compiles
.    {color:green}+1{color} the patch does not seem to introduce new javac warnings
{color:green}+1{color} There are no new bugs found in total.
. {color:green}+1{color} There are no new bugs found in [core].
. {color:green}+1{color} There are no new bugs found in [tools].
. {color:green}+1{color} There are no new bugs found in [sharelib/hive2].
. {color:green}+1{color} There are no new bugs found in [sharelib/distcp].
. {color:green}+1{color} There are no new bugs found in [sharelib/hcatalog].
. {color:green}+1{color} There are no new bugs found in [sharelib/streaming].
. {color:green}+1{color} There are no new bugs found in [sharelib/sqoop].
. {color:green}+1{color} There are no new bugs found in [sharelib/oozie].
. {color:green}+1{color} There are no new bugs found in [sharelib/pig].
. {color:green}+1{color} There are no new bugs found in [sharelib/hive].
. {color:green}+1{color} There are no new bugs found in [sharelib/spark].
. {color:green}+1{color} There are no new bugs found in [client].
. {color:green}+1{color} There are no new bugs found in [examples].
. {color:green}+1{color} There are no new bugs found in [docs].
. {color:green}+1{color} There are no new bugs found in [server].
{color:green}+1 BACKWARDS_COMPATIBILITY{color}
.    {color:green}+1{color} the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations
.    {color:green}+1{color} the patch does not modify JPA files
{color:green}+1 TESTS{color}
.    Tests run: 2087
.    {color:orange}Tests failed at first run:{color}
TestJavaActionExecutor#testCredentialsSkip
TestCoordActionsKillXCommand#testActionKillCommandDate
TestHiveActionExecutor#testHiveAction
.    For the complete list of flaky tests, see TEST-SUMMARY-FULL files.
{color:green}+1 DISTRO{color}
.    {color:green}+1{color} distro tarball builds with the patch 

----------------------------
{color:green}*+1 Overall result, good!, no -1s*{color}


The full output of the test-patch run is available at

. https://builds.apache.org/job/PreCommit-OOZIE-Build/337/



+1

Â 

committed to master!

Â 

Closing issue; Oozie 5.0.0 is released.

