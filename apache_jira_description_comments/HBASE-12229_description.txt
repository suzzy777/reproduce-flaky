I tracked down occasional flakiness in TestRestoreSnapshotFromClient to a potential NPE in SnapshotTestingUtils#waitForTableToBeOnline. In short, some tests in TestRestoreSnapshot... create a table and then invoke SnapshotTestingUtils#waitForTableToBeOnline, but this method assumes that regions have been assigned by the time it's invoked (which is not always the case).