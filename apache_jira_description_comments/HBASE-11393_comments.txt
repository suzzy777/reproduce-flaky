For backward compatibility, should we add a new interface something like 
{code}
void addPeer(String peerId, ReplicationPeerConfig peerConfig, TableCfsProto.TableCfs tableCFs)
      throws ReplicationException;
{code}

Or we just modify the original interface?



It seems there is no use for this information? 
I do NOT see any usages of {{ReplicationPeers.getTableCFs}} in project?

[~chenheng]
See ReplicationAdmin.java line 370/421.
But these usage are just in HBase. No compatibility problem.




Got it! Thanks [~liushaohui]

I keep the Deprecated method, so the ugly string parse code still exists...

After the Deprecated method removed, we can delete them... 

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769492/HBASE-11393.patch
  against master branch at commit 2288742c10e04d46212dbf70b931e460214992bf.
  ATTACHMENT ID: 12769492

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1747 checkstyle errors (more than the master's current 1732 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +  public static TableCFsProto.TableCFs convert(Map<TableName, ? extends Collection<String>> tableCfs) {
+        return TableCFsProto.TableCFs.parseFrom(ZKUtil.getData(this.zookeeper, getTableCFsNode(id)));

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.TestInterfaceAudienceAnnotations

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16278//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16278//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16278//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16278//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769517/HBASE-11393_v1.patch
  against master branch at commit 2288742c10e04d46212dbf70b931e460214992bf.
  ATTACHMENT ID: 12769517

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1733 checkstyle errors (more than the master's current 1732 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.TestReplicationWALEntryFilters

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16280//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16280//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16280//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16280//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769529/HBASE-11393_v2.patch
  against master branch at commit 2288742c10e04d46212dbf70b931e460214992bf.
  ATTACHMENT ID: 12769529

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 checkstyle{color}.  The applied patch does not increase the total number of checkstyle errors

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelReplicationWithExpAsString
                  org.apache.hadoop.hbase.util.TestRegionMover
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdmin
                  org.apache.hadoop.hbase.regionserver.TestRegionReplicaFailover
                  org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsReplication

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16281//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16281//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16281//artifact/patchprocess/checkstyle-aggregate.html

  Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16281//console

This message is automatically generated.

[~chenheng], thanks for the patch. Will this solve HBASE-11386 ?

{quote}
 Will this solve HBASE-11386 ?
{quote}
Oh...  it can't solve it yet,  i will do it ASAP...

Fix bug which cause testcase failed.  
One stupid bug wasted my whole night....  :(

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769938/HBASE-11393_v3.patch
  against master branch at commit 683f84e6a217dfd872e5f1be82c7aa4cdf232ec1.
  ATTACHMENT ID: 12769938

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 checkstyle{color}.  The applied patch does not increase the total number of checkstyle errors

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.client.TestBlockEvictionFromClient
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdmin

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16333//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16333//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16333//artifact/patchprocess/checkstyle-aggregate.html

  Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16333//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769972/HBASE-11393_v4.patch
  against master branch at commit 6cc6d833f2cde47123876e5ca107b522004055ac.
  ATTACHMENT ID: 12769972

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1731 checkstyle errors (more than the master's current 1730 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.TestReplicationWALEntryFilters

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16336//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16336//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16336//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16336//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12769979/HBASE-11393_v5.patch
  against master branch at commit 6cc6d833f2cde47123876e5ca107b522004055ac.
  ATTACHMENT ID: 12769979

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 4 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1735 checkstyle errors (more than the master's current 1730 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.regionserver.TestReplicationSourceManager
                  org.apache.hadoop.hbase.replication.TestReplicationStateZKImpl
                  org.apache.hadoop.hbase.replication.TestPerTableCFReplication
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdmin
                  org.apache.hadoop.hbase.replication.TestReplicationTrackerZKImpl
                  org.apache.hadoop.hbase.replication.regionserver.TestRegionReplicaReplicationEndpointNoMaster

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16337//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16337//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16337//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16337//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770065/HBASE-11393_v5.patch
  against master branch at commit 6dbb5a8052c5cbff9dfb9ebac68d3200d3543955.
  ATTACHMENT ID: 12770065

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 11 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1727 checkstyle errors (more than the master's current 1724 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.TestPerTableCFReplication
                  org.apache.hadoop.hbase.client.TestMobRestoreSnapshotFromClient
                  org.apache.hadoop.hbase.replication.TestReplicationKillMasterRSCompressed
                  org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClientWithRegionReplicas
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdminWithClusters
                  org.apache.hadoop.hbase.client.TestCheckAndMutate
                  org.apache.hadoop.hbase.client.TestCloneSnapshotFromClient
                  org.apache.hadoop.hbase.wal.TestDefaultWALProvider
                  org.apache.hadoop.hbase.client.TestPutWithDelete
                  org.apache.hadoop.hbase.replication.TestMasterReplication
                  org.apache.hadoop.hbase.client.TestReplicaWithCluster
                  org.apache.hadoop.hbase.client.TestShortCircuitConnection
                  org.apache.hadoop.hbase.client.TestMultipleTimestamps
                  org.apache.hadoop.hbase.replication.TestMultiSlaveReplication
                  org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClient
                  org.apache.hadoop.hbase.client.TestFromClientSideNoCodec
                  org.apache.hadoop.hbase.client.TestClientPushback
                  org.apache.hadoop.hbase.wal.TestSecureWAL
                  org.apache.hadoop.hbase.client.TestFromClientSide3
                  org.apache.hadoop.hbase.client.TestTableSnapshotScanner
                  org.apache.hadoop.hbase.client.TestUpdateConfiguration
                  org.apache.hadoop.hbase.client.TestTimestampsFilter
                  org.apache.hadoop.hbase.client.TestScannerTimeout
                  org.apache.hadoop.hbase.TestMetaTableLocator
                  org.apache.hadoop.hbase.client.TestSnapshotFromClientWithRegionReplicas
                  org.apache.hadoop.hbase.wal.TestBoundedRegionGroupingStrategy
                  org.apache.hadoop.hbase.client.TestMetaWithReplicas
                  org.apache.hadoop.hbase.wal.TestWALFiltering
                  org.apache.hadoop.hbase.replication.TestReplicationSyncUpTool
                  org.apache.hadoop.hbase.replication.TestReplicationWithTags
                  org.apache.hadoop.hbase.TestZooKeeper
                  org.apache.hadoop.hbase.client.TestHCM
                  org.apache.hadoop.hbase.replication.TestReplicationChangingPeerRegionservers
                  org.apache.hadoop.hbase.wal.TestDefaultWALProviderWithHLogKey
                  org.apache.hadoop.hbase.regionserver.TestPerColumnFamilyFlush
                  org.apache.hadoop.hbase.client.TestMultiParallel
                  org.apache.hadoop.hbase.regionserver.TestRegionReplicaFailover
                  org.apache.hadoop.hbase.wal.TestWALFactory
                  org.apache.hadoop.hbase.replication.TestReplicationDisableInactivePeer
                  org.apache.hadoop.hbase.client.TestSizeFailures
                  org.apache.hadoop.hbase.TestIOFencing
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdmin

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16346//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16346//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16346//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16346//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770094/HBASE-11393_v5.patch
  against master branch at commit 7368344585ff8414a3f396398c1937602d47d129.
  ATTACHMENT ID: 12770094

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 11 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1727 checkstyle errors (more than the master's current 1724 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.TestReplicationWithTags
                  org.apache.hadoop.hbase.replication.TestReplicationChangingPeerRegionservers
                  org.apache.hadoop.hbase.replication.multiwal.TestReplicationKillMasterRSCompressedWithMultipleWAL
                  org.apache.hadoop.hbase.replication.TestReplicationKillMasterRSCompressed
                  org.apache.hadoop.hbase.replication.multiwal.TestReplicationEndpointWithMultipleWAL
                  org.apache.hadoop.hbase.replication.TestReplicationSmallTests
                  org.apache.hadoop.hbase.replication.TestReplicationSyncUpTool
                  org.apache.hadoop.hbase.replication.TestPerTableCFReplication
                  org.apache.hadoop.hbase.client.TestBlockEvictionFromClient
                  org.apache.hadoop.hbase.client.replication.TestReplicationAdmin
                  org.apache.hadoop.hbase.regionserver.TestWALLockup
                  org.apache.hadoop.hbase.replication.TestReplicationKillSlaveRS
                  org.apache.hadoop.hbase.replication.multiwal.TestReplicationSyncUpToolWithMultipleWAL

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16350//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16350//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16350//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16350//console

This message is automatically generated.

Failed tests look related. 

Can we change the TableCF to be something like: 

{code}
+message TableCF {
+  optional TableName table_name = 1;
+  repeated bytes family = 2;
+}
{code}
This is more in-line with the rest of the protos. 

Did you handle the case where there is existing replication peers? We should allow (and maybe auto-convert) existing replication peers with the old format.
Historically, we have written PB structures to disk using a magic prefix to differentiate between old-writable formats and new PB format. Maybe we can do a similar thing here as well. 


Thanks [~enis].  
Currently there are still some problems in my patch.   After passing QA, i will do as your suggestions.  :)

Update patch as [~enis] suggestions.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770273/HBASE-11393_v6.patch
  against master branch at commit 870c74e270dc456f6328cf11ec5a3678e1db73e3.
  ATTACHMENT ID: 12770273

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 15 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1731 checkstyle errors (more than the master's current 1726 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16360//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16360//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16360//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16360//console

This message is automatically generated.

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770297/HBASE-11393_v7.patch
  against master branch at commit 870c74e270dc456f6328cf11ec5a3678e1db73e3.
  ATTACHMENT ID: 12770297

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 15 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1731 checkstyle errors (more than the master's current 1726 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16361//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16361//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16361//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16361//console

This message is automatically generated.

Now, thinking more about it, I think we should do a couple of more changes to the client-visible API. First, the String based configuration for table cfs should completely be deprecated. Second, I think we should unify the ReplicationPeerConfiguration and table-cf configuration so that the table CF's to filter goes inside the ReplicationPeerConfiguration. Wdyt? 

These are the functions to be deprecated at least:  
{code}
getPeerTableCFs(String id)
appendPeerTableCFs(String id, String tableCfs)
removePeerTableCFs(String id, String tableCf)
{code}



Thanks [~enis]
{quote}
First, the String based configuration for table cfs should completely be deprecated. 
{quote}
I will do it.

{quote}
Second, I think we should unify the ReplicationPeerConfiguration and table-cf configuration so that the table CF's to filter goes inside the ReplicationPeerConfiguration.
{quote}

Sounds good.  But it has no relates with this issue.  Shall we open another one to do it?

Additional concerns:
Currently,  {{ReplicationPeersZKImpl}} and {{ReplicationPeerZKImpl}} has some overlaps.  
They all has method getTableCFs, {{ReplicationPeersZKImpl}} read directly relates ZNode,  but {{ReplicationPeerZKImpl}} read it from memory which updates by ZK notified.
Shall we unify them?






bq. Sounds good. But it has no relates with this issue. Shall we open another one to do it?
Sorry to drag other changes into that. But I think they are related since if we unify them at the ReplicationPeerConfiguration, we can also store the info under the same znode (rather than having the tableCFs znode and the peer znode). wdyt? 
bq. Shall we unify them?
Makes sense. 

{quote}
But I think they are related since if we unify them at the ReplicationPeerConfiguration, we can also store the info under the same znode (rather than having the tableCFs znode and the peer znode). wdyt?
{quote}
Sounds reasonable.  i will update patch to unify them.

{color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770505/HBASE-11393_v8.patch
  against master branch at commit 68717241040e6dad04958e49e5373887dd677dfd.
  ATTACHMENT ID: 12770505

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 15 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 checkstyle{color}.  The applied patch does not increase the total number of checkstyle errors

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16377//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16377//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16377//artifact/patchprocess/checkstyle-aggregate.html

  Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16377//console

This message is automatically generated.

unify ReplicationPeerConfig and TableCFs

{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12770586/HBASE-11393_v9.patch
  against master branch at commit ceddec9141b658c790d2fb995c970982ab082028.
  ATTACHMENT ID: 12770586

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 15 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1732 checkstyle errors (more than the master's current 1726 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +  public void addPeer(String id, ReplicationPeerConfig peerConfig, ZooKeeperProtos.TableCFs tableCFs)
+              new java.lang.String[] { "Clusterkey", "ReplicationEndpointImpl", "Data", "Configuration", "TableCFs", });

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16386//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16386//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16386//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16386//console

This message is automatically generated.

How about v9? [~enis]

[~chenheng], can you upload the patch on review board ?

Thanks [~ashish singhi] for your help to review. 
review board here.
https://reviews.apache.org/r/40443/

[~chenheng], thanks for the patch.
Did you test this with tableCfs having namespace also included in its table name ? I think that is not yet handled, but from high level code review it looks like you are almost their.
Can you update the usage in shell script so that user can know how they can pass namespace also along with table name.
Can you also add some test where we explicitly set tableCfs having namespace also included in its table name.

I see that you are adding tableCfs information also as data to peer id ZK node but earlier we had a dedicated ZK node {{zookeeper.znode.replication.peers.tableCFs}} for this. So will this be ok ?

Basically what I am looking at is, fixing HBASE-11386 bug, which is very much possible here.
I will review more in depth tomorrow and provide my comments.

{quote}
Did you test this with tableCfs having namespace also included in its table name ? 
Can you update the usage in shell script so that user can know how they can pass namespace also along with table name.
Can you also add some test where we explicitly set tableCfs having namespace also included in its table name.
{quote}
Oh, let me do it.

{quote}
I see that you are adding tableCfs information also as data to peer id ZK node but earlier we had a dedicated ZK node zookeeper.znode.replication.peers.tableCFs for this. So will this be ok ?
{quote}
Oh, this is [~enis] suggestion.  I think it is reasonable, we can unify them into one znode.  wdyt? :)


bq. Oh, this is Enis Soztutar suggestion. I think it is reasonable, we can unify them into one znode. wdyt?
I am also ok with it but I think TableCFsTracker was watching that node and any update to it was updated accordingly to the peer. Please ensure that we do not break that (I haven't still looked into patch code around that part still).

{quote}
Please ensure that we do not break that 
{quote}
yeah,  TableCFsTracker watch peer Node now in the patch.

Update a new patch. 
changes:
 *  Modify some code as [~enis] suggestions in review board.
 *  support namespace as [~ashishujjain] suggestions.

Review board update too.

btw.
There are some similar code in  ReplicationPeers,  i am not sure the context of these methods, could unify them? 
{code: title=ReplicationPeers.java}
   * Add a new remote slave cluster for replication.
   * @param peerId a short that identifies the cluster
   * @param peerConfig configuration for the replication slave cluster
   */
  void addPeer(String peerId, ReplicationPeerConfig peerConfig)
      throws ReplicationException;

  /**
   * Removes a remote slave cluster and stops the replication to it.
   * @param peerId a short that identifies the cluster
   */
  void removePeer(String peerId) throws ReplicationException;

  boolean peerAdded(String peerId) throws ReplicationException;

  @Deprecated
  void peerRemoved(String peerId);
{code}





{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12773221/HBASE-11393_v10.patch
  against master branch at commit c92737c0e912563aeba2112ab8df74af976e720a.
  ATTACHMENT ID: 12773221

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 16 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

                {color:red}-1 checkstyle{color}.  The applied patch generated 1731 checkstyle errors (more than the master's current 1727 errors).

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +    this.replicationPeers.setPeerTableCFsConfig(id, TableCFsHelper.parseTableCFsFromConfig(tableCFs));
+              new java.lang.String[] { "Clusterkey", "ReplicationEndpointImpl", "Data", "Configuration", "TableCFs", });

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.procedure2.store.wal.TestWALProcedureStore

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16589//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16589//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16589//artifact/patchprocess/checkstyle-aggregate.html

                Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16589//console

This message is automatically generated.

[~chenheng],
{code}
  /**
   *  Convert TableCFs Object to String.
   *  Output String Format: ns1.table1:cf1,cf2;ns2.table2:cfA,cfB;table3
   * */
{code}
The tableCfs string format which you have considered will go wrong when table name itself has a '.' in it.
I will resume my review once that is addressed.

Thanks.

Yeah, I have thought use ':' as TableName do.
But ':' has been used to split table and cf.  
For backward compatibility,  i have to choose another one.  
Which spitter do you think is best? [~ashish singhi]

bq. Which spitter do you think is best?
The string tableCfs related api was deprecated in 0.99 as part of HBASE-11367 hence we are good to remove it in 2.0.0. So for 2.0.0 we need not worry about this.

For other branches we can just assume that the table passed in tableCfs of string type belongs to default name space and set it in ZooKeeperProtos.TableCF. Please cross check the code once to see if that is how it works currently.
And in ruby script lets use non-deprecated method and update the usage to encourage users to use map of table name and CFs

[~enis], do you have any other better suggestions ?

 backward compatibility problem happens when user upgrade their cluster,  old format tableCFs is stored in zk,  we had to read and parse it correctly.

Yes, so in that case we can consider the table belongs to default namespace (I am assuming that this is how it works currently, correct me if I am wrong).
By remove the deprecated api from 2.0.0 I meant that the client after 2.0.0 still does not continue to provide tableCfs in String format.

{quote}
By remove the deprecated api from 2.0.0 I meant that the client after 2.0.0 still does not continue to provide tableCfs in String format.
{quote}
If we can, that is a good way.

For the client API, we can remove it in 2.0. However, we still have to figure out a way for keeping the data in zookeeper rolling upgradable. For branch-1, we can do something like this: 
 - Master startup checks all the peer tableCF data, and writes that data to ReplicationPeerConfiguration znode. This will auto-migrate existing data. 
 - The client API calls for changing peer tableCF data changes both the ReplicationPeerConfiguration and the deprecated tableCF znode in string format. 
 - New Regionservers  only read from ReplicationPeerConfiguration znode. 
 - Old regionservers during rolling upgrade can read from the old tableCF znode. In this case, if a table with namespace was added, the replication might not work. But once the upgrade is complete, replication will be fixed. 
 - In 2.0, we only read and write from the RPC znode. 

{quote}
The client API calls for changing peer tableCF data changes both the ReplicationPeerConfiguration and the deprecated tableCF znode in string format.

In this case, if a table with namespace was added, the replication might not work. But once the upgrade is complete, replication will be fixed.
{quote}
Why not forbidden user to update tableCF zNode directly during roll upgrading?  It will be more simple and clear. wdyt?

bq. Why not forbidden user to update tableCF zNode directly during roll upgrading? It will be more simple and clear. wdyt
There is no easy and reliable way to detect a rolling upgrade going on and whether it is finished, etc. Since adding tables with NS to tableCFs is already broken now, it should be fine that it is not fixed until you have this patch working in all your regionservers via rolling upgrade before you add such a table. 

update patch_v11.
main changes.
 * we upgrade tableCFs when hmaster start as @enis suggestion.
 * remove all deprecated api in ReplicationAdmin, modify relates testcase and ruby scripts (I will test ruby scripts when QA and review have no big problems).
 * little changes as [~ashishujjain] review board suggestions.

I update review board too. 
Thank guys for your nice review.


{color:red}-1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12773715/HBASE-11393_v11.patch
  against master branch at commit 97ffb193e09cc141396b11dcae6814faea0691b7.
  ATTACHMENT ID: 12773715

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 55 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 checkstyle{color}.  The applied patch does not increase the total number of checkstyle errors

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:red}-1 lineLengths{color}.  The patch introduces the following lines longer than 100:
    +              new java.lang.String[] { "Clusterkey", "ReplicationEndpointImpl", "Data", "Configuration", "TableCFs", });
+    hbase> set_peer_tableCFs '2',  {ns1.table1 => [], ns2.table2 => ['cf1', 'cf2'], ns3.table3 => ['cfA', 'cfB']}

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16631//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16631//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16631//artifact/patchprocess/checkstyle-aggregate.html

  Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16631//console

This message is automatically generated.

Thanks for the patch.
I have given some comments on source code on the RB.
Please mark either the comments are fixed or dropped so that it helps next time for the review.

[~ashish singhi] Thanks for your review.  I will fix what you mentioned in RB next version.
Let's see what [~enis] will say. 


update patch v12.
 * add testcase for TableCFsUpdater
 * some changes as [~ashish singhi] suggestions.
 * fix bugs in ruby script.

{color:green}+1 overall{color}.  Here are the results of testing the latest attachment 
  http://issues.apache.org/jira/secure/attachment/12774307/HBASE-11393_v12.patch
  against master branch at commit 90bdb0dc7412f3ae8fc1e14ce033bf115c6332f3.
  ATTACHMENT ID: 12774307

    {color:green}+1 @author{color}.  The patch does not contain any @author tags.

    {color:green}+1 tests included{color}.  The patch appears to include 59 new or modified tests.

    {color:green}+1 hadoop versions{color}. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)

    {color:green}+1 javac{color}.  The applied patch does not increase the total number of javac compiler warnings.

    {color:green}+1 protoc{color}.  The applied patch does not increase the total number of protoc compiler warnings.

    {color:green}+1 javadoc{color}.  The javadoc tool did not generate any warning messages.

    {color:green}+1 checkstyle{color}.  The applied patch does not increase the total number of checkstyle errors

    {color:green}+1 findbugs{color}.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.

    {color:green}+1 release audit{color}.  The applied patch does not increase the total number of release audit warnings.

    {color:green}+1 lineLengths{color}.  The patch does not introduce lines longer than 100

  {color:green}+1 site{color}.  The mvn post-site goal succeeds with this patch.

    {color:green}+1 core tests{color}.  The patch passed unit tests in .

Test results: https://builds.apache.org/job/PreCommit-HBASE-Build/16662//testReport/
Release Findbugs (version 2.0.3) 	warnings: https://builds.apache.org/job/PreCommit-HBASE-Build/16662//artifact/patchprocess/newFindbugsWarnings.html
Checkstyle Errors: https://builds.apache.org/job/PreCommit-HBASE-Build/16662//artifact/patchprocess/checkstyle-aggregate.html

  Console output: https://builds.apache.org/job/PreCommit-HBASE-Build/16662//console

This message is automatically generated.

Do we need to go on this issue?  [~enis]

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:red}-1{color} | {color:red} patch {color} | {color:red} 0m 5s {color} | {color:red} HBASE-11393 does not apply to master. Rebase required? Wrong Branch? See https://yetus.apache.org/documentation/0.2.0/precommit-patchnames for help. {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12774307/HBASE-11393_v12.patch |
| JIRA Issue | HBASE-11393 |
| Console output | https://builds.apache.org/job/PreCommit-HBASE-Build/1042/console |
| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |


This message was automatically generated.



bq. Do we need to go on this issue? Enis Soztutar
Yes. Thanks for the reminder. Let me do another pass today. 

Let me rebase the patch this week.   :)

rebase on master

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} rubocop {color} | {color:blue} 0m 0s {color} | {color:blue} rubocop was not available. {color} |
| {color:blue}0{color} | {color:blue} ruby-lint {color} | {color:blue} 0m 0s {color} | {color:blue} Ruby-lint was not available. {color} |
| {color:green}+1{color} | {color:green} hbaseanti {color} | {color:green} 0m 0s {color} | {color:green} Patch does not have any anti-patterns. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 16 new or modified test files. {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 53s {color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 4m 10s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 5m 27s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 2m 56s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 32m 50s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 1m 47s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 2m 1s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 10m 39s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 3m 45s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 36s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 11s {color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 49s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 5m 31s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 5m 31s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 5m 31s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 3m 14s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 3m 14s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 3m 14s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 31m 35s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 1m 47s {color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red} 0m 0s {color} | {color:red} The patch has 17 line(s) that end in whitespace. Use git apply --whitespace=fix. {color} |
| {color:green}+1{color} | {color:green} hadoopcheck {color} | {color:green} 28m 40s {color} | {color:green} Patch does not cause any errors with Hadoop 2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.1 2.6.2 2.6.3 2.7.1. {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 2m 45s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 12m 31s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 3m 50s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 53s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 30s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 28s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 26s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 17s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 113m 36s {color} | {color:green} hbase-server in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 132m 55s {color} | {color:red} hbase-server in the patch failed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 7m 17s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 7m 31s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 2m 25s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 433m 42s {color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| Timed out junit tests | org.apache.hadoop.hbase.coprocessor.TestRegionObserverInterface |
|   | org.apache.hadoop.hbase.TestClusterBootOrder |
|   | org.apache.hadoop.hbase.coprocessor.TestClassLoading |
|   | org.apache.hadoop.hbase.TestGlobalMemStoreSize |
|   | org.apache.hadoop.hbase.zookeeper.lock.TestZKInterProcessReadWriteLock |
|   | org.apache.hadoop.hbase.snapshot.TestFlushSnapshotFromClient |
|   | org.apache.hadoop.hbase.coprocessor.TestRegionObserverInterface |
|   | org.apache.hadoop.hbase.TestClusterBootOrder |
|   | org.apache.hadoop.hbase.coprocessor.TestClassLoading |
|   | org.apache.hadoop.hbase.TestGlobalMemStoreSize |
|   | org.apache.hadoop.hbase.zookeeper.lock.TestZKInterProcessReadWriteLock |
|   | org.apache.hadoop.hbase.snapshot.TestFlushSnapshotFromClient |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12794148/HBASE-11393_v14.patch |
| JIRA Issue | HBASE-11393 |
| Optional Tests |  asflicense  javac  javadoc  unit  findbugs  hadoopcheck  hbaseanti  checkstyle  compile  cc  hbaseprotoc  rubocop  ruby_lint  |
| uname | Linux asf900.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build@2/component/dev-support/hbase-personality.sh |
| git revision | master / 8c031e9 |
| Default Java | 1.7.0_79 |
| Multi-JDK versions |  /home/jenkins/tools/java/jdk1.8.0:1.8.0 /usr/local/jenkins/java/jdk1.7.0_79:1.7.0_79 |
| findbugs | v3.0.0 |
| whitespace | https://builds.apache.org/job/PreCommit-HBASE-Build/1067/artifact/patchprocess/whitespace-eol.txt |
| unit | https://builds.apache.org/job/PreCommit-HBASE-Build/1067/artifact/patchprocess/patch-unit-hbase-server.txt |
| unit test logs |  https://builds.apache.org/job/PreCommit-HBASE-Build/1067/artifact/patchprocess/patch-unit-hbase-server.txt https://builds.apache.org/job/PreCommit-HBASE-Build/1067/artifact/patchprocess/patch-unit-hbase-server.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HBASE-Build/1067/testReport/ |
| modules | C:  hbase-protocol   hbase-protocol   hbase-client   hbase-client   hbase-server   hbase-server   hbase-shell   hbase-shell  U: . |
| Console output | https://builds.apache.org/job/PreCommit-HBASE-Build/1067/console |
| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |


This message was automatically generated.



patch v15 address [~enis] comments on review board. 
Let's see what the QA talk about?

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} rubocop {color} | {color:blue} 0m 1s {color} | {color:blue} rubocop was not available. {color} |
| {color:blue}0{color} | {color:blue} ruby-lint {color} | {color:blue} 0m 1s {color} | {color:blue} Ruby-lint was not available. {color} |
| {color:green}+1{color} | {color:green} hbaseanti {color} | {color:green} 0m 0s {color} | {color:green} Patch does not have any anti-patterns. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 16 new or modified test files. {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 28s {color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 46s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 54s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 3m 18s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 35m 3s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 2m 13s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 2m 28s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 11m 10s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 3m 46s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 3m 6s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 12s {color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 4m 1s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 5m 12s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 5m 12s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 5m 12s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 3m 41s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 3m 41s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 3m 41s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 35m 21s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 1m 55s {color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red} 0m 0s {color} | {color:red} The patch has 11 line(s) that end in whitespace. Use git apply --whitespace=fix. {color} |
| {color:green}+1{color} | {color:green} hadoopcheck {color} | {color:green} 31m 0s {color} | {color:green} Patch does not cause any errors with Hadoop 2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.1 2.6.2 2.6.3 2.7.1. {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 2m 16s {color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 1m 33s {color} | {color:red} hbase-client generated 1 new + 0 unchanged - 0 fixed = 1 total (was 0) {color} |
| {color:red}-1{color} | {color:red} findbugs {color} | {color:red} 1m 34s {color} | {color:red} hbase-client generated 1 new + 0 unchanged - 0 fixed = 1 total (was 0) {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 3m 29s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 48s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 24s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 23s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 6s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 1m 5s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 18m 59s {color} | {color:red} hbase-server in the patch failed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 20m 12s {color} | {color:red} hbase-server in the patch failed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 56s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 7m 8s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 1m 18s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 233m 50s {color} | {color:black} {color} |
\\
\\
|| Reason || Tests ||
| FindBugs | module:hbase-client |
|  |  Invocation of toString on org.apache.hadoop.hbase.client.replication.ReplicationSerDeHelper.convert(Map) in org.apache.hadoop.hbase.replication.ReplicationPeersZKImpl.setPeerTableCFsConfig(String, Map)  At ReplicationPeersZKImpl.java:in org.apache.hadoop.hbase.replication.ReplicationPeersZKImpl.setPeerTableCFsConfig(String, Map)  At ReplicationPeersZKImpl.java:[line 223] |
| FindBugs | module:hbase-client |
|  |  Invocation of toString on org.apache.hadoop.hbase.client.replication.ReplicationSerDeHelper.convert(Map) in org.apache.hadoop.hbase.replication.ReplicationPeersZKImpl.setPeerTableCFsConfig(String, Map)  At ReplicationPeersZKImpl.java:in org.apache.hadoop.hbase.replication.ReplicationPeersZKImpl.setPeerTableCFsConfig(String, Map)  At ReplicationPeersZKImpl.java:[line 223] |
| Failed junit tests | hadoop.hbase.io.hfile.TestHFile |
|   | hadoop.hbase.io.hfile.TestHFile |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12795171/HBASE-11393_v15.patch |
| JIRA Issue | HBASE-11393 |
| Optional Tests |  asflicense  javac  javadoc  unit  findbugs  hadoopcheck  hbaseanti  checkstyle  compile  cc  hbaseprotoc  rubocop  ruby_lint  |
| uname | Linux pomona.apache.org 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/component/dev-support/hbase-personality.sh |
| git revision | master / db3ba65 |
| Default Java | 1.7.0_79 |
| Multi-JDK versions |  /home/jenkins/tools/java/jdk1.8.0:1.8.0 /usr/local/jenkins/java/jdk1.7.0_79:1.7.0_79 |
| findbugs | v3.0.0 |
| whitespace | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/whitespace-eol.txt |
| findbugs | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/new-findbugs-hbase-client.html |
| findbugs | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/new-findbugs-hbase-client.html |
| unit | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/patch-unit-hbase-server.txt |
| unit | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/patch-unit-hbase-server.txt |
| unit test logs |  https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/patch-unit-hbase-server.txt https://builds.apache.org/job/PreCommit-HBASE-Build/1164/artifact/patchprocess/patch-unit-hbase-server.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/testReport/ |
| modules | C:  hbase-protocol   hbase-protocol   hbase-client   hbase-client   hbase-server   hbase-server   hbase-shell   hbase-shell  U: . |
| Console output | https://builds.apache.org/job/PreCommit-HBASE-Build/1164/console |
| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |


This message was automatically generated.



Fix findbugs

| (x) *{color:red}-1 overall{color}* |
\\
\\
|| Vote || Subsystem || Runtime || Comment ||
| {color:blue}0{color} | {color:blue} rubocop {color} | {color:blue} 0m 0s {color} | {color:blue} rubocop was not available. {color} |
| {color:blue}0{color} | {color:blue} ruby-lint {color} | {color:blue} 0m 0s {color} | {color:blue} Ruby-lint was not available. {color} |
| {color:green}+1{color} | {color:green} hbaseanti {color} | {color:green} 0m 0s {color} | {color:green} Patch does not have any anti-patterns. {color} |
| {color:green}+1{color} | {color:green} @author {color} | {color:green} 0m 0s {color} | {color:green} The patch does not contain any @author tags. {color} |
| {color:green}+1{color} | {color:green} test4tests {color} | {color:green} 0m 0s {color} | {color:green} The patch appears to include 16 new or modified test files. {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 28s {color} | {color:blue} Maven dependency ordering for branch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 3s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 3m 55s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 2m 44s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 27m 54s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 1m 33s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 1m 48s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 8m 45s {color} | {color:green} master passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 49s {color} | {color:green} master passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 13s {color} | {color:green} master passed with JDK v1.7.0_79 {color} |
| {color:blue}0{color} | {color:blue} mvndep {color} | {color:blue} 0m 10s {color} | {color:blue} Maven dependency ordering for patch {color} |
| {color:green}+1{color} | {color:green} mvninstall {color} | {color:green} 3m 11s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 4m 0s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 4m 0s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 4m 0s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} compile {color} | {color:green} 2m 42s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} cc {color} | {color:green} 2m 42s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javac {color} | {color:green} 2m 42s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} checkstyle {color} | {color:green} 28m 29s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} mvneclipse {color} | {color:green} 1m 33s {color} | {color:green} the patch passed {color} |
| {color:red}-1{color} | {color:red} whitespace {color} | {color:red} 0m 0s {color} | {color:red} The patch has 11 line(s) that end in whitespace. Use git apply --whitespace=fix. {color} |
| {color:green}+1{color} | {color:green} hadoopcheck {color} | {color:green} 25m 13s {color} | {color:green} Patch does not cause any errors with Hadoop 2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.1 2.6.2 2.6.3 2.7.1. {color} |
| {color:green}+1{color} | {color:green} hbaseprotoc {color} | {color:green} 1m 53s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} findbugs {color} | {color:green} 10m 43s {color} | {color:green} the patch passed {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 54s {color} | {color:green} the patch passed with JDK v1.8.0 {color} |
| {color:green}+1{color} | {color:green} javadoc {color} | {color:green} 2m 13s {color} | {color:green} the patch passed with JDK v1.7.0_79 {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 19s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 20s {color} | {color:green} hbase-protocol in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 52s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 0m 54s {color} | {color:green} hbase-client in the patch passed. {color} |
| {color:red}-1{color} | {color:red} unit {color} | {color:red} 89m 58s {color} | {color:red} hbase-server in the patch failed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 88m 29s {color} | {color:green} hbase-server in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 29s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} unit {color} | {color:green} 6m 41s {color} | {color:green} hbase-shell in the patch passed. {color} |
| {color:green}+1{color} | {color:green} asflicense {color} | {color:green} 1m 32s {color} | {color:green} Patch does not generate ASF License warnings. {color} |
| {color:black}{color} | {color:black} {color} | {color:black} 336m 0s {color} | {color:black} {color} |
\\
\\
|| Subsystem || Report/Notes ||
| JIRA Patch URL | https://issues.apache.org/jira/secure/attachment/12795367/HBASE-11393_v16.patch |
| JIRA Issue | HBASE-11393 |
| Optional Tests |  asflicense  javac  javadoc  unit  findbugs  hadoopcheck  hbaseanti  checkstyle  compile  cc  hbaseprotoc  rubocop  ruby_lint  |
| uname | Linux asf907.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux |
| Build tool | maven |
| Personality | /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/component/dev-support/hbase-personality.sh |
| git revision | master / c96b642 |
| Default Java | 1.7.0_79 |
| Multi-JDK versions |  /home/jenkins/tools/java/jdk1.8.0:1.8.0 /usr/local/jenkins/java/jdk1.7.0_79:1.7.0_79 |
| findbugs | v3.0.0 |
| whitespace | https://builds.apache.org/job/PreCommit-HBASE-Build/1188/artifact/patchprocess/whitespace-eol.txt |
| unit | https://builds.apache.org/job/PreCommit-HBASE-Build/1188/artifact/patchprocess/patch-unit-hbase-server.txt |
|  Test Results | https://builds.apache.org/job/PreCommit-HBASE-Build/1188/testReport/ |
| modules | C:  hbase-protocol   hbase-protocol   hbase-client   hbase-client   hbase-server   hbase-server   hbase-shell   hbase-shell  U: . |
| Console output | https://builds.apache.org/job/PreCommit-HBASE-Build/1188/console |
| Powered by | Apache Yetus 0.2.0   http://yetus.apache.org |


This message was automatically generated.



Failing test : org.apache.hadoop.hbase.regionserver.TestRegionMergeTransactionOnCluster  has no relates with current patch.

If no other suggestions,  i will commit it later.

push to master.  Need backport it to branch-1,  [~enis] ?

I think we can leave this in master only unless we need it otherwise. 

FAILURE: Integrated in HBase-Trunk_matrix #812 (See [https://builds.apache.org/job/HBase-Trunk_matrix/812/])
HBASE-11393 Replication TableCfs should be a PB object rather than a (chenheng: rev 7f39baf0f4572ff209837d7de5d37554851ecbb7)
* hbase-shell/src/main/ruby/shell/commands/set_peer_tableCFs.rb
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSmallTests.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/master/TestTableCFsUpdater.java
* hbase-shell/src/main/ruby/hbase/replication_admin.rb
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationStateZKBase.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/client/replication/TestReplicationAdmin.java
* hbase-shell/src/main/ruby/shell/commands/add_peer.rb
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationBase.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/util/TestHBaseFsckOneRS.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationTrackerZKImpl.java
* hbase-server/src/main/java/org/apache/hadoop/hbase/replication/master/TableCFsUpdater.java
* hbase-shell/src/main/ruby/shell/commands/append_peer_tableCFs.rb
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSyncUpTool.java
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeerConfig.java
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeersZKImpl.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestReplicaWithCluster.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestMultiSlaveReplication.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestMasterReplication.java
* hbase-client/src/main/java/org/apache/hadoop/hbase/client/replication/ReplicationAdmin.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsReplication.java
* hbase-shell/src/main/ruby/shell/commands/remove_peer_tableCFs.rb
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeers.java
* hbase-protocol/src/main/java/org/apache/hadoop/hbase/protobuf/generated/ZooKeeperProtos.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelReplicationWithExpAsString.java
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeer.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestReplicationHFileCleaner.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationWithTags.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestPerTableCFReplication.java
* hbase-protocol/src/main/protobuf/ZooKeeper.proto
* hbase-client/src/main/java/org/apache/hadoop/hbase/client/replication/ReplicationSerDeHelper.java
* hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
* hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeerZKImpl.java
* hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationStateBasic.java


Thanks for this [~chenheng]; the tracker on the replication peer config is already proving useful. 

Has the decision been made to remove "add_peer peer_id, cluster_key" from the Ruby shell in addition to the equivalent methods on ReplicationAdmin, as this JIRA does? While the ReplicationAdmin methods are marked as Deprecated in 1.0, and thus seem fair game to remove in 2.0, the Ruby method that takes a string rather than a dictionary is still the "official" way to create a peer in the HBase shell in the HBase book on hbase.apache.org. If nothing else the doc should probably be updated. 

Its removal as part of this JIRA is also breaking TestReplicationShell (currently set as Ignore because it was apparently flaky in the past), but which I've been using locally to verify some shell changes I'm working on for HBASE-15507. I can fix the test, but want to confirm that it's the test that needs to change. 

bq. the Ruby method that takes a string rather than a dictionary is still the "official" way to create a peer in the HBase shell in the HBase book on hbase.apache.org. If nothing else the doc should probably be updated.
Makes sense to also deprecate / remove those ruby methods in favor of the new way. +1 for the documentation. 

FAILURE: Integrated in Jenkins build HBase-1.4 #476 (See [https://builds.apache.org/job/HBase-1.4/476/])
HBASE-16653 Backport HBASE-11393 to branches which support namespace (chenheng: rev 66941910bd07462fe496c5bbb591f4071f77b8fb)
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationTrackerZKImpl.java
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeerZKImpl.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestReplicaWithCluster.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSyncUpTool.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationWithTags.java
* (edit) hbase-shell/src/main/ruby/shell/commands/append_peer_tableCFs.rb
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeers.java
* (edit) hbase-shell/src/main/ruby/shell/commands/add_peer.rb
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/client/replication/TestReplicationAdmin.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationSmallTests.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestMultiSlaveReplication.java
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeersZKImpl.java
* (edit) hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java
* (add) hbase-server/src/main/java/org/apache/hadoop/hbase/replication/master/TableCFsUpdater.java
* (edit) hbase-shell/src/main/ruby/hbase/replication_admin.rb
* (edit) hbase-shell/src/main/ruby/shell/commands/remove_peer_tableCFs.rb
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationPeerConfig.java
* (add) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/master/TestTableCFsUpdater.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsReplication.java
* (edit) hbase-shell/src/main/ruby/shell/commands/list_peers.rb
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/client/replication/ReplicationAdmin.java
* (edit) hbase-protocol/src/main/protobuf/ZooKeeper.proto
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationBase.java
* (edit) hbase-protocol/src/main/java/org/apache/hadoop/hbase/protobuf/generated/ZooKeeperProtos.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestMasterReplication.java
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationStateZKBase.java
* (edit) hbase-shell/src/main/ruby/shell/commands/set_peer_tableCFs.rb
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestReplicationHFileCleaner.java
* (edit) hbase-shell/src/test/ruby/hbase/replication_admin_test.rb
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/util/TestHBaseFsck.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestPerTableCFReplication.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationStateBasic.java
* (edit) hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelReplicationWithExpAsString.java
* (edit) hbase-shell/src/test/java/org/apache/hadoop/hbase/client/TestReplicationShell.java
* (edit) hbase-client/src/main/java/org/apache/hadoop/hbase/replication/ReplicationSerDeHelper.java


