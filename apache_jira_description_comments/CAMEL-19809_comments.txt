Fixed by multiple separate PRs and core changes. 

