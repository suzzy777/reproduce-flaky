The KuduClient object is reference counted, and sometimes the last reference is held by an in-flight batch RPC. Thus, when the RPC finishes, the client shuts down, which tries to shut down its DnsResolver, which ends up waiting on a condition variable. This fires a ThreadRestrictions assertion failure. This causes flakiness in some tests (eg DeleteTableTest.TestDeleteTableWithConcurrentWrites)