Refactor LocalRegion and extract complex inner classes. Reduce warnings, improve readability and maintainability, and cleanup code in general.