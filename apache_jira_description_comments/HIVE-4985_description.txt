Preliminary for HIVE-4914.
The patch is going to be large already, so some refactoring and dead code removal that is non-controversial can be done in advance in a separate patch.