[~tdsilva] - any insights?

Are you calling DROP SCHEMA INITTEST more than once?

DROP SCHEMA is called once at the end of each test. However, before running each test a CREATE SCHEMA is also called.

Are you running the tests in parallel? Can you include the tests you are running? 

Hey [~tdsilva]

Thanks for looking. The tests are no run in parallel, they run after each other. I've spent the last few hours trying to see if I can simplify everything down and pack it into a tiny sample program to reproduce this, but I have not had any luck yet.

Still trying to find a reliable way to reproduce this. I saw this issue again a couple of times today in my local test environment as well as our CI environments. Just to add more information. dropping the schema is done using `DROP SCHEMA IF EXISTS ...`, so it should not return an error even if the schema does not exist.

Also, in the simplest case where it has been failing, is a set of tests testing the creation of the schema, creation of tables + indexes, dropping of tables + indexes and dropping of the schema. In this test, there was only 1 simple insertion.

Edit: Just had the test above fail 5 times sequentially in our CI environment due to this.

The root-queryserver.log does show most of the table + schema creation operations against the server, but not at a very granular level.

Is there any way to log all queries against the server?

I am currently planning to produce a dump of all the protobuf messages exchanged between the app and the query server. This should allow replaying the requests against the server to see what this is happening.

The code is already in place and I just need to trigger the error again.

I have reproduce the problem.

This is the error returned in my tests:

{code:java}
Could not drop schema (INITTEST): An error was encountered while processing your request: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: INITTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): INITTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: INITTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): INITTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> NamespaceNotFoundException: org.apache.hadoop.hbase.NamespaceNotFoundException: INITTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): INITTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> RemoteWithExtrasException: org.apache.hadoop.hbase.NamespaceNotFoundException: INITTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): INITTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
{code}

I have attached the following to the JIRA:
- HBase log - 
- PQS log
- Tephra log
- A zip of all protobuf requests and responses between the client and the server.

The protobufs have the following format:
- Year-Month-Day-Hour-Minute-Seconds-Milliseconds-{req or res}.log
- 1 message per file.


I was also able to get it to fail a second time, but on a totally different test:

{code:java}
2017/11/20 11:12:37 Could not drop schema: could not drop schema (CLIENTTEST): An error was encountered while processing your request: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: CLIENTTEST
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): CLIENTTEST
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
 -> PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: CLIENTTEST
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): CLIENTTEST
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
 -> NamespaceNotFoundException: org.apache.hadoop.hbase.NamespaceNotFoundException: CLIENTTEST
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): CLIENTTEST
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
 -> RemoteWithExtrasException: org.apache.hadoop.hbase.NamespaceNotFoundException: CLIENTTEST
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): CLIENTTEST
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
{code}

Same files as before, but there is a 2017-11-20-second-run suffix in the filename:
- HBase log
- PQS log
- Tephra log
- A zip of all protobuf requests and responses in the same format as the previous comment.

I hope this should be enough to find out causing the NamespaceNotFoundException when executing `DROP SCHEMA IF EXIST ...`.

Sorry for the delay, can you please provide the statements you execute in the test that fails?

Hey [~tdsilva]

Thanks for looking into this. Here are a few dumps of a few tests that fail due to the NamespaceNotFoundException. I have included other requests to PSQ (such as changing the connection parameters) in the event that they might be useful.

I have included the statements being executed for 3 of the failing tests below:

{code:java}
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" >
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948"
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" sql:"CREATE SCHEMA IF NOT EXISTS PHOENIXTEST" statement_id:337 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"SELECT 1" statement_id:338 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:339 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:342 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"CREATE TABLE aggregate(\nid VARCHAR(255) NOT NULL,\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT\nCONSTRAINT pk PRIMARY KEY (id, bounded_context, Aggregate, organization_id)\n)TRANSACTIONAL=TRUE" statement_id:343 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE TABLE event(\nid BIGINT NOT NULL PRIMARY KEY,\ncreated TIMESTAMP,\nbounded_context VARCHAR(255),\naggregate VARCHAR(255),\naggregate_id VARCHAR(255),\norganization_id VARCHAR(255),\nevent VARCHAR(255),\ndata VARBINARY,\nversion BIGINT,\nuser_id VARCHAR(255),\nip_address VARCHAR(45)\n) TRANSACTIONAL=TRUE, SALT_BUCKETS=20" statement_id:344 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE INDEX ievent ON Event(\naggregate_id,\nbounded_context,\naggregate,\norganization_id,\nversion\n)" statement_id:353 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE TABLE snapshot(\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\naggregate_id VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT,\ncreated TIMESTAMP,\ndata VARBINARY\nCONSTRAINT pk PRIMARY KEY (bounded_context, Aggregate, aggregate_id, organization_id)\n)" statement_id:369 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE TABLE subscription(\nid VARCHAR(255) NOT NULL PRIMARY KEY,\ntopic VARCHAR(255),\nlast_event BIGINT,\nlast_heartbeat TIMESTAMP\n)" statement_id:371 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE INDEX topic_subscription ON subscription (\ntopic\n) INCLUDE (\nlast_event\n)" statement_id:372 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"\nCREATE SEQUENCE event_id START WITH 1 INCREMENT BY 1 CACHE 0" statement_id:379 max_rows_total:-1 first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" sql:"UPSERT INTO schema_migration (version) VALUES (?)" max_rows_total:-1
statementHandle:<connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" id:380 signature:<sql:"UPSERT INTO schema_migration (version) VALUES (?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f" statement_id:380
connection_id:"7682303b-7e01-4a69-be4f-44825f28fa0f"
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" sql:"UPSERT INTO snapshot (bounded_context, aggregate, aggregate_id, organization_id, created, data, version)\n\t\t\t     VALUES(?, ?, ?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" id:381 signature:<sql:"UPSERT INTO snapshot (bounded_context, aggregate, aggregate_id, organization_id, created, data, version)\n\t\t\t     VALUES(?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?5" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?6" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?7" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"1" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276618000 > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:3 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" statement_id:381
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" sql:"SELECT bounded_context, aggregate, aggregate_id, organization_id, version, data, created\n\t\t\t
  FROM snapshot\n\t\t\t      WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" max_rows_total:-1
statementHandle:<connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" id:382 signature:<columns:<searchable:true display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:1 searchable:true display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:2 searchable:true display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:5 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > sql:"SELECT bounded_context, aggregate, aggregate_id, organization_id, version, data, created\n\t\t\t      FROM snapshot\n\t\t\t
      WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" statement_id:382
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" sql:"UPSERT INTO snapshot (bounded_context, aggregate, aggregate_id, organization_id, created, data, version)\n\t\t\t     VALUES(?, ?, ?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" id:383 signature:<sql:"UPSERT INTO snapshot (bounded_context, aggregate, aggregate_id, organization_id, created, data, version)\n\t\t\t     VALUES(?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?5" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?6" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?7" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"1" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276618000 > parameter_values:<type:BYTE_STRING bytes_value:"{\"test\": \"test\"}" > parameter_values:<type:LONG number_value:5 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" statement_id:383
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" sql:"SELECT bounded_context, aggregate, aggregate_id, organization_id, version, data, created\n\t\t\t
  FROM snapshot\n\t\t\t      WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" max_rows_total:-1
statementHandle:<connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" id:384 signature:<columns:<searchable:true display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:1 searchable:true display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:2 searchable:true display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:5 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > sql:"SELECT bounded_context, aggregate, aggregate_id, organization_id, version, data, created\n\t\t\t      FROM snapshot\n\t\t\t
      WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"2bfd7173-d22b-443f-9593-7c5617dd9b94" statement_id:384
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" sql:"SELECT COUNT(*) FROM PHOENIXTEST.snapshot WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" max_rows_total:-1
statementHandle:<connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" id:385 signature:<columns:<case_sensitive:true searchable:true signed:true display_size:40 label:"COUNT(1)" column_name:"COUNT(1)" table_name:"PHOENIXTEST.SNAPSHOT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT COUNT(*) FROM PHOENIXTEST.snapshot WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" statement_id:385
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"SELECT 1" statement_id:386 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:387 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:392 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"DROP TABLE IF EXISTS aggregate" statement_id:393 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP TABLE IF EXISTS event" statement_id:396 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP INDEX IF EXISTS ievent ON Event" statement_id:401 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP TABLE IF EXISTS snapshot" statement_id:402 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP TABLE IF EXISTS subscription" statement_id:405 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP INDEX IF EXISTS topic_subscription ON subscription" statement_id:409 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"\nDROP SEQUENCE IF EXISTS event_id" statement_id:410 max_rows_total:-1 first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" sql:"DELETE FROM schema_migration WHERE version=?" max_rows_total:-1
statementHandle:<connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" id:411 signature:<sql:"DELETE FROM schema_migration WHERE version=?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7" statement_id:411
connection_id:"0d08e373-3def-466a-aad7-46180fcbeca7"
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948"
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" sql:"DROP TABLE IF EXISTS PHOENIXTEST.schema_migration" statement_id:412 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948"
connection_id:"6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948" sql:"DROP SCHEMA IF EXISTS PHOENIXTEST" statement_id:414 max_rows_total:-1 first_frame_max_size:-1
--- FAIL: TestSnapshots (44.17s)
 phoenix_test.go:499: could not drop schema (PHOENIXTEST): An error was encountered while processing your request: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> NamespaceNotFoundException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> RemoteWithExtrasException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
{code}


{code:java}
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" >
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1"
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1" sql:"CREATE SCHEMA IF NOT EXISTS PHOENIXTEST" statement_id:188 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"SELECT 1" statement_id:189 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:190 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:192 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"CREATE TABLE aggregate(\nid VARCHAR(255) NOT NULL,\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT\nCONSTRAINT pk PRIMARY KEY (id, bounded_context, Aggregate, organization_id)\n)TRANSACTIONAL=TRUE" statement_id:193 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE TABLE event(\nid BIGINT NOT NULL PRIMARY KEY,\ncreated TIMESTAMP,\nbounded_context VARCHAR(255),\naggregate VARCHAR(255),\naggregate_id VARCHAR(255),\norganization_id VARCHAR(255),\nevent VARCHAR(255),\ndata VARBINARY,\nversion BIGINT,\nuser_id VARCHAR(255),\nip_address VARCHAR(45)\n) TRANSACTIONAL=TRUE, SALT_BUCKETS=20" statement_id:194 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE INDEX ievent ON Event(\naggregate_id,\nbounded_context,\naggregate,\norganization_id,\nversion\n)" statement_id:197 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE TABLE snapshot(\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\naggregate_id VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT,\ncreated TIMESTAMP,\ndata VARBINARY\nCONSTRAINT pk PRIMARY KEY (bounded_context, Aggregate, aggregate_id, organization_id)\n)" statement_id:198 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE TABLE subscription(\nid VARCHAR(255) NOT NULL PRIMARY KEY,\ntopic VARCHAR(255),\nlast_event BIGINT,\nlast_heartbeat TIMESTAMP\n)" statement_id:200 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE INDEX topic_subscription ON subscription (\ntopic\n) INCLUDE (\nlast_event\n)" statement_id:201 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"\nCREATE SEQUENCE event_id START WITH 1 INCREMENT BY 1 CACHE 0" statement_id:205 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" sql:"UPSERT INTO schema_migration (version) VALUES (?)" max_rows_total:-1
statementHandle:<connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" id:206 signature:<sql:"UPSERT INTO schema_migration (version) VALUES (?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17" statement_id:206
connection_id:"1fe78867-1e97-43a8-af70-088fd7915e17"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:207 signature:<columns:<searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.AGGREGATE" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:207
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:208 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276528684 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Created" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:1 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:208 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276528688 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Updated" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:2 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:209 signature:<sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?5" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:LONG number_value:2 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:209
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:208
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:210 signature:<columns:<searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.AGGREGATE" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:210
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:211 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276528772 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Updated" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:3 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:211 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276528778 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Updated" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:4 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:212 signature:<sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?5" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:LONG number_value:4 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:212
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:211
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT MAX(id) FROM event" statement_id:213 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ? AND version >= ?\n\t\t\t\t ORDER BY version ASC\n\t\t\t\t LIMIT ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:214 signature:<columns:<searchable:true signed:true display_size:40 label:"ID" column_name:"ID" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:1 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > columns:<ordinal:2 searchable:true nullable:1 display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true nullable:1 display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:5 searchable:true nullable:1 display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:255 label:"EVENT" column_name:"EVENT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:7 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:8 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:9 searchable:true nullable:1 display_size:255 label:"USER_ID" column_name:"USER_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:10 searchable:true nullable:1 display_size:45 label:"IP_ADDRESS" column_name:"IP_ADDRESS" precision:45 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ? AND version >= ?\n\t\t\t\t ORDER BY version ASC\n\t\t\t\t LIMIT ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?4" > parameters:<parameter_type:4 type_name:"INTEGER" class_name:"java.lang.Integer" name:"?5" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:LONG > parameter_values:<type:LONG number_value:3 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:214
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ? AND version >= ?\n\t\t\t\t ORDER BY version ASC" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:215 signature:<columns:<searchable:true signed:true display_size:40 label:"ID" column_name:"ID" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:1 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > columns:<ordinal:2 searchable:true nullable:1 display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true nullable:1 display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:5 searchable:true nullable:1 display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:255 label:"EVENT" column_name:"EVENT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:7 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:8 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:9 searchable:true nullable:1 display_size:255 label:"USER_ID" column_name:"USER_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:10 searchable:true nullable:1 display_size:45 label:"IP_ADDRESS" column_name:"IP_ADDRESS" precision:45 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE bounded_context = ? AND aggregate = ? AND aggregate_id = ? AND version >= ?\n\t\t\t\t ORDER BY version ASC" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate" > parameter_values:<type:STRING string_value:"123456" > parameter_values:<type:LONG > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:215
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id IN(?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:216 signature:<columns:<searchable:true signed:true display_size:40 label:"ID" column_name:"ID" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:1 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > columns:<ordinal:2 searchable:true nullable:1 display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true nullable:1 display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:5 searchable:true nullable:1 display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:255 label:"EVENT" column_name:"EVENT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:7 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:8 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:9 searchable:true nullable:1 display_size:255 label:"USER_ID" column_name:"USER_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:10 searchable:true nullable:1 display_size:45 label:"IP_ADDRESS" column_name:"IP_ADDRESS" precision:45 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id IN(?, ?)" parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?1" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?2" > cursor_factory:<style:LIST > > > parameter_values:<type:LONG number_value:1 > parameter_values:<type:LONG number_value:4 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:216
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:217 signature:<columns:<searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.AGGREGATE" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT version\n\t\t\t   FROM aggregate\n\t\t\t   WHERE bounded_context = ? AND aggregate = ? AND id = ? AND organization_id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate2" > parameter_values:<type:STRING string_value:"789" > parameter_values:<type:STRING string_value:"some-company" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:217
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:218 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276528997 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate2" > parameter_values:<type:STRING string_value:"789" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Updated" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:1 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:218 signature:<sql:"UPSERT INTO event (id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address)\n\t\t\t    \t VALUES(NEXT VALUE FOR event_id, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)" parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?5" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?6" > parameters:<parameter_type:4294967293 type_name:"VARBINARY" class_name:"[B" name:"?7" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?8" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?9" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?10" > cursor_factory:<style:LIST > > > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276529001 > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate2" > parameter_values:<type:STRING string_value:"789" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:STRING string_value:"Updated" > parameter_values:<type:BYTE_STRING bytes_value:"{}" > parameter_values:<type:LONG number_value:2 > parameter_values:<type:STRING string_value:"system" > parameter_values:<type:STRING string_value:"127.0.0.1" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:219 signature:<sql:"UPSERT INTO aggregate (id, bounded_context, aggregate, organization_id, version)\n\t\t\t  VALUES(?, ?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?3" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?4" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?5" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"789" > parameter_values:<type:STRING string_value:"testservice" > parameter_values:<type:STRING string_value:"testaggregate2" > parameter_values:<type:STRING string_value:"some-company" > parameter_values:<type:LONG number_value:2 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:219
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:218
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT topic FROM subscription WHERE id = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:220 signature:<columns:<searchable:true nullable:1 display_size:255 label:"TOPIC" column_name:"TOPIC" precision:255 table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT topic FROM subscription WHERE id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"test-subscription" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:220
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO subscription (id, topic, last_event, last_heartbeat) VALUES(?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:221 signature:<sql:"UPSERT INTO subscription (id, topic, last_event, last_heartbeat) VALUES(?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?3" > parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"test-subscription" > parameter_values:<type:STRING string_value:"events-a7143403-6dfc-4013-be9d-a223bfc7d348" > parameter_values:<type:LONG > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276529100 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:221
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT last_event FROM subscription WHERE topic = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:222 signature:<columns:<searchable:true nullable:1 signed:true display_size:40 label:"LAST_EVENT" column_name:"LAST_EVENT" table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT last_event FROM subscription WHERE topic = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"events-a7143403-6dfc-4013-be9d-a223bfc7d348" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:222
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id > ?\n\t\t\t\t ORDER BY id ASC\n\t\t\t\t LIMIT ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:223 signature:<columns:<searchable:true signed:true display_size:40 label:"ID" column_name:"ID" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:1 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > columns:<ordinal:2 searchable:true nullable:1 display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true nullable:1 display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:5 searchable:true nullable:1 display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:255 label:"EVENT" column_name:"EVENT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:7 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:8 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:9 searchable:true nullable:1 display_size:255 label:"USER_ID" column_name:"USER_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:10 searchable:true nullable:1 display_size:45 label:"IP_ADDRESS" column_name:"IP_ADDRESS" precision:45 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id > ?\n\t\t\t\t ORDER BY id ASC\n\t\t\t\t LIMIT ?" parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?1" > parameters:<parameter_type:4 type_name:"INTEGER" class_name:"java.lang.Integer" name:"?2" > cursor_factory:<style:LIST > > > parameter_values:<type:LONG > parameter_values:<type:LONG number_value:4 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:223
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id FROM subscription WHERE topic = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:224 signature:<columns:<searchable:true display_size:255 label:"ID" column_name:"ID" precision:255 table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id FROM subscription WHERE topic = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"events-a7143403-6dfc-4013-be9d-a223bfc7d348" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:224
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"UPSERT INTO subscription (id, last_event) VALUES(?, ?)" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:225 signature:<sql:"UPSERT INTO subscription (id, last_event) VALUES(?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?2" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"test-subscription" > parameter_values:<type:LONG number_value:4 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:225
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT last_event FROM subscription WHERE topic = ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:226 signature:<columns:<searchable:true nullable:1 signed:true display_size:40 label:"LAST_EVENT" column_name:"LAST_EVENT" table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > sql:"SELECT last_event FROM subscription WHERE topic = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"events-a7143403-6dfc-4013-be9d-a223bfc7d348" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:226
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id > ?\n\t\t\t\t ORDER BY id ASC\n\t\t\t\t LIMIT ?" max_rows_total:-1
statementHandle:<connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" id:227 signature:<columns:<searchable:true signed:true display_size:40 label:"ID" column_name:"ID" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:1 searchable:true nullable:1 display_size:40 label:"CREATED" column_name:"CREATED" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.sql.Timestamp" type:<id:93 name:"TIMESTAMP" rep:PRIMITIVE_LONG > > columns:<ordinal:2 searchable:true nullable:1 display_size:255 label:"BOUNDED_CONTEXT" column_name:"BOUNDED_CONTEXT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:3 searchable:true nullable:1 display_size:255 label:"AGGREGATE" column_name:"AGGREGATE" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:4 searchable:true nullable:1 display_size:255 label:"AGGREGATE_ID" column_name:"AGGREGATE_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:5 searchable:true nullable:1 display_size:255 label:"ORGANIZATION_ID" column_name:"ORGANIZATION_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:6 searchable:true nullable:1 display_size:255 label:"EVENT" column_name:"EVENT" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:7 searchable:true nullable:1 display_size:40 label:"DATA" column_name:"DATA" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"[B" type:<id:4294967293 name:"VARBINARY" rep:BYTE_STRING > > columns:<ordinal:8 searchable:true nullable:1 signed:true display_size:40 label:"VERSION" column_name:"VERSION" table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.Long" type:<id:4294967291 name:"BIGINT" rep:PRIMITIVE_LONG > > columns:<ordinal:9 searchable:true nullable:1 display_size:255 label:"USER_ID" column_name:"USER_ID" precision:255 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > columns:<ordinal:10 searchable:true nullable:1 display_size:45 label:"IP_ADDRESS" column_name:"IP_ADDRESS" precision:45 table_name:"PHOENIXTEST.EVENT" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id, created, bounded_context, aggregate, aggregate_id, organization_id, event, data, version, user_id, ip_address\n\t\t\t\t FROM event\n\t\t\t\t WHERE id > ?\n\t\t\t\t ORDER BY id ASC\n\t\t\t\t LIMIT ?" parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?1" > parameters:<parameter_type:4 type_name:"INTEGER" class_name:"java.lang.Integer" name:"?2" > cursor_factory:<style:LIST > > > parameter_values:<type:LONG number_value:4 > parameter_values:<type:LONG number_value:4 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" statement_id:227
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d"
connection_id:"1cb48dc4-3e82-45e1-a898-0bde67f5370d" sql:"SELECT MAX(id) FROM event" statement_id:228 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"SELECT 1" statement_id:229 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:230 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:234 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"DROP TABLE IF EXISTS aggregate" statement_id:235 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP TABLE IF EXISTS event" statement_id:246 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP INDEX IF EXISTS ievent ON Event" statement_id:259 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP TABLE IF EXISTS snapshot" statement_id:260 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP TABLE IF EXISTS subscription" statement_id:265 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP INDEX IF EXISTS topic_subscription ON subscription" statement_id:269 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"\nDROP SEQUENCE IF EXISTS event_id" statement_id:270 max_rows_total:-1 first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" sql:"DELETE FROM schema_migration WHERE version=?" max_rows_total:-1
statementHandle:<connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" id:271 signature:<sql:"DELETE FROM schema_migration WHERE version=?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d" statement_id:271
connection_id:"6e6769c8-2de6-47ec-85a5-a79d7df99c1d"
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1"
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1" sql:"DROP TABLE IF EXISTS PHOENIXTEST.schema_migration" statement_id:272 max_rows_total:-1 first_frame_max_size:-1
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1"
connection_id:"2db3d239-6f84-4dfd-9926-1f1fd487b5f1" sql:"DROP SCHEMA IF EXISTS PHOENIXTEST" statement_id:274 max_rows_total:-1 first_frame_max_size:-1
--- FAIL: TestEvents (44.82s)
        phoenix_test.go:219: could not drop schema (PHOENIXTEST): An error was encountered while processing your request: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> NamespaceNotFoundException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> RemoteWithExtrasException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
{code}


{code:java}
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" >
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7"
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7" sql:"CREATE SCHEMA IF NOT EXISTS PHOENIXTEST" statement_id:101 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"SELECT 1" statement_id:102 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:103 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:108 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"CREATE TABLE aggregate(\nid VARCHAR(255) NOT NULL,\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT\nCONSTRAINT pk PRIMARY KEY (id, bounded_context, Aggregate, organization_id)\n)TRANSACTIONAL=TRUE" statement_id:109 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE TABLE event(\nid BIGINT NOT NULL PRIMARY KEY,\ncreated TIMESTAMP,\nbounded_context VARCHAR(255),\naggregate VARCHAR(255),\naggregate_id VARCHAR(255),\norganization_id VARCHAR(255),\nevent VARCHAR(255),\ndata VARBINARY,\nversion BIGINT,\nuser_id VARCHAR(255),\nip_address VARCHAR(45)\n) TRANSACTIONAL=TRUE, SALT_BUCKETS=20" statement_id:110 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE INDEX ievent ON Event(\naggregate_id,\nbounded_context,\naggregate,\norganization_id,\nversion\n)" statement_id:122 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE TABLE snapshot(\nbounded_context VARCHAR(255) NOT NULL,\naggregate VARCHAR(255) NOT NULL,\naggregate_id VARCHAR(255) NOT NULL,\norganization_id VARCHAR(255) NOT NULL,\nversion BIGINT,\ncreated TIMESTAMP,\ndata VARBINARY\nCONSTRAINT pk PRIMARY KEY (bounded_context, Aggregate, aggregate_id, organization_id)\n)" statement_id:123 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE TABLE subscription(\nid VARCHAR(255) NOT NULL PRIMARY KEY,\ntopic VARCHAR(255),\nlast_event BIGINT,\nlast_heartbeat TIMESTAMP\n)" statement_id:146 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE INDEX topic_subscription ON subscription (\ntopic\n) INCLUDE (\nlast_event\n)" statement_id:147 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"\nCREATE SEQUENCE event_id START WITH 1 INCREMENT BY 1 CACHE 0" statement_id:152 max_rows_total:-1 first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" sql:"UPSERT INTO schema_migration (version) VALUES (?)" max_rows_total:-1
statementHandle:<connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" id:153 signature:<sql:"UPSERT INTO schema_migration (version) VALUES (?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c" statement_id:153
connection_id:"1a014afa-57e9-49cb-aac1-0d310aab731c"
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"SELECT topic FROM subscription WHERE id = ?" max_rows_total:-1
statementHandle:<connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" id:154 signature:<columns:<searchable:true nullable:1 display_size:255 label:"TOPIC" column_name:"TOPIC" precision:255 table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT topic FROM subscription WHERE id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testsubscription" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" statement_id:154
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"UPSERT INTO subscription (id, topic, last_event, last_heartbeat) VALUES(?, ?, ?, ?)" max_rows_total:-1
statementHandle:<connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" id:155 signature:<sql:"UPSERT INTO subscription (id, topic, last_event, last_heartbeat) VALUES(?, ?, ?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?2" > parameters:<parameter_type:4294967291 type_name:"BIGINT" class_name:"java.lang.Long" name:"?3" > parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?4" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testsubscription" > parameter_values:<type:STRING string_value:"events-2b903cb3-6c30-4509-9968-76e28c197ef6" > parameter_values:<type:LONG > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276484372 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" statement_id:155
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027"
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"SELECT id FROM subscription WHERE id = ?" max_rows_total:-1
statementHandle:<connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" id:156 signature:<columns:<searchable:true display_size:255 label:"ID" column_name:"ID" precision:255 table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id FROM subscription WHERE id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testsubscription" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" statement_id:156
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"UPSERT INTO subscription (id, last_heartbeat) VALUES(?, ?)" max_rows_total:-1
statementHandle:<connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" id:157 signature:<sql:"UPSERT INTO subscription (id, last_heartbeat) VALUES(?, ?)" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > parameters:<parameter_type:93 type_name:"TIMESTAMP" class_name:"java.sql.Timestamp" name:"?2" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"testsubscription" > parameter_values:<type:JAVA_SQL_TIMESTAMP number_value:1512276484000 > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" statement_id:157
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027"
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027"
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"SELECT id, topic, last_heartbeat FROM subscription" statement_id:158 max_rows_total:-1 first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<has_auto_commit:true transaction_isolation:4 >
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" sql:"SELECT id FROM subscription WHERE id = ?" max_rows_total:-1
statementHandle:<connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" id:159 signature:<columns:<searchable:true display_size:255 label:"ID" column_name:"ID" precision:255 table_name:"PHOENIXTEST.SUBSCRIPTION" read_only:true column_class_name:"java.lang.String" type:<id:12 name:"VARCHAR" rep:STRING > > sql:"SELECT id FROM subscription WHERE id = ?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"non-existent-subscription" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" statement_id:159
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027"
connection_id:"a87ad011-627c-4757-a860-92e9d0f32027" conn_props:<auto_commit:true has_auto_commit:true transaction_isolation:4 >
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" info:<key:"AutoCommit" value:"true" > info:<key:"Consistency" value:"8" > info:<key:"schema" value:"PHOENIXTEST" >
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"SELECT 1" statement_id:160 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true" statement_id:161 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"SELECT version FROM schema_migration ORDER BY version DESC" statement_id:165 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"DROP TABLE IF EXISTS aggregate" statement_id:166 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP TABLE IF EXISTS event" statement_id:168 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP INDEX IF EXISTS ievent ON Event" statement_id:174 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP TABLE IF EXISTS snapshot" statement_id:175 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP TABLE IF EXISTS subscription" statement_id:177 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP INDEX IF EXISTS topic_subscription ON subscription" statement_id:181 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"\nDROP SEQUENCE IF EXISTS event_id" statement_id:182 max_rows_total:-1 first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" sql:"DELETE FROM schema_migration WHERE version=?" max_rows_total:-1
statementHandle:<connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" id:183 signature:<sql:"DELETE FROM schema_migration WHERE version=?" parameters:<parameter_type:12 type_name:"VARCHAR" class_name:"java.lang.String" name:"?1" > cursor_factory:<style:LIST > > > parameter_values:<type:STRING string_value:"1_init" > deprecated_first_frame_max_size:9223372036854775807 has_parameter_values:true first_frame_max_size:-1
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32" statement_id:183
connection_id:"648f2008-af6c-4d57-803e-7b9df51efb32"
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7"
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7" sql:"DROP TABLE IF EXISTS PHOENIXTEST.schema_migration" statement_id:184 max_rows_total:-1 first_frame_max_size:-1
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7"
connection_id:"c1d407dc-0f9d-494e-9abf-39f1064488b7" sql:"DROP SCHEMA IF EXISTS PHOENIXTEST" statement_id:187 max_rows_total:-1 first_frame_max_size:-1
--- FAIL: TestHeartbeats (45.24s)
        phoenix_test.go:147: could not drop schema (PHOENIXTEST): An error was encountered while processing your request: RuntimeException: org.apache.phoenix.exception.PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> PhoenixIOException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> NamespaceNotFoundException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
                 -> RemoteWithExtrasException: org.apache.hadoop.hbase.NamespaceNotFoundException: PHOENIXTEST
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
                        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
                        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
                        at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
                        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:106)
                        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:95)
                        at org.apache.hadoop.hbase.util.ForeignExceptionUtil.toIOException(ForeignExceptionUtil.java:45)
                        at org.apache.hadoop.hbase.procedure2.RemoteProcedureException.fromProto(RemoteProcedureException.java:114)
                        at org.apache.hadoop.hbase.master.procedure.ProcedureSyncWait.waitForProcedureToComplete(ProcedureSyncWait.java:85)
                        at org.apache.hadoop.hbase.master.HMaster$15.run(HMaster.java:2717)
                        at org.apache.hadoop.hbase.master.procedure.MasterProcedureUtil.submitProcedure(MasterProcedureUtil.java:133)
                        at org.apache.hadoop.hbase.master.HMaster.deleteNamespace(HMaster.java:2705)
                        at org.apache.hadoop.hbase.master.MasterRpcServices.deleteNamespace(MasterRpcServices.java:496)
                        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:58601)
                        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2339)
                        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:123)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:188)
                        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:168)
                Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hbase.NamespaceNotFoundException): PHOENIXTEST
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.prepareDelete(DeleteNamespaceProcedure.java:243)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:83)
                        at org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure.executeFromState(DeleteNamespaceProcedure.java:49)
                        at org.apache.hadoop.hbase.procedure2.StateMachineProcedure.execute(StateMachineProcedure.java:139)
                        at org.apache.hadoop.hbase.procedure2.Procedure.doExecute(Procedure.java:499)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execProcedure(ProcedureExecutor.java:1148)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:943)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.execLoop(ProcedureExecutor.java:896)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.access$400(ProcedureExecutor.java:78)
                        at org.apache.hadoop.hbase.procedure2.ProcedureExecutor$2.run(ProcedureExecutor.java:498)
{code}

I hope this will provide more insight into the root cause behind this problem.


[~francischuang]

Sorry for the delay in responding. I looked through the code and we call deleteNamespace only from ConnectionQueryServicesImpl.dropSchema() , so if your tests are not run in parallel I am not sure how this issue is happening.

[~tdsilva] Thank you for looking into this. Even if the tests are running in parallel and `DROP SCHEMA IF EXISTS someschema` was executed, should an exception still be thrown even if the schema does not exist?

[~francischuang]
Its possible since we don't atomically check and drop the schema and delete the HBase namespace. There is a log line at the DEBUG level  that is logged just before we delete the namespace. Can you enable debug logging and see if this line is logged?

{{logger.debug("Found quorum: " + quorum + ":" + znode);}}

I have added the following to my `/opt/hbase/conf/log4j.properties`, -but I am not seeing any debug statements-:
{code}
psql.root.logger=DEBUG

log4j.threshold=DEBUG

log4j.threshold=DEBUG

log4j.logger.org.apache.phoenix.queryserver=DEBUG

log4j.logger.org.apache.phoenix.queryserver.server=DEBUG

log4j.logger.org.apache.phoenix=DEBUG

log4j.logger.org.eclipse.jetty.io.AbstractEndPoint=DEBUG
{code}

The phoenix jars are copied into `/opt/hbase/lib`. See the docker image here: https://github.com/Boostport/hbase-phoenix-all-in-one

I am not seeing any `Found quorum` in the logs. I have attached a complete copy of the logs with the debug logs as 2017-12-29.m9edd51.log



For some reason, the log you attached does not include any debug logging for ConnectionQueryServiceImpl. It does include HBase server side debug logs. 
HBase also logs a line when a namespace is deleted (in DeleteNamespaceProcedure) at the TRACE level. Can you please change the level to TRACE and attach the logs?

{code}
 if (isTraceEnabled()) {
      LOG.trace(this + " execute state=" + state);
    }
{code}

I inserted the following into /opt/hbase/conf/log4j.properties:

{code}
psql.root.logger=TRACE

log4j.threshold=TRACE

log4j.threshold=TRACE

log4j.logger.org.apache.phoenix.queryserver=TRACE

log4j.logger.org.apache.phoenix.queryserver.server=TRACE

log4j.logger.org.apache.phoenix=TRACE

log4j.logger.org.eclipse.jetty.io.AbstractEndPoint=TRACE
{code}

I then triggered the exception (after a few tries) and can confirm that I am seeing TRACE statements in the log.

The log is attached to this JIRA as 2018-01-03.m9edd51.log

I do not see any trace messages containing "execute state" though.

Can you confirm if the config added to log4j.properties is correct?

You might need to set the level to  TRACE for the DeleteNamespaceProcedure class. 
Also, you said that the tests pass with HBase 1.2 and Phoenix 4.11, could you test with HBase 1.2 and Phoenix 4.13 to confirm that this is a Phoenix issue?

I am not very familiar with Java and log4j. Is the full config key `log4j.logger.org.apache.hadoop.hbase.master.procedure.DeleteNamespaceProcedure=trace`?

Yes thats correct.

Thanks for confirming, Thomas.

I have built an HBase 1.2 image with Phoenix 4.13.1 as well. I have tried running 4.13 with HBase 1.2 as well as 4.13 with HBase 1.3 against my test suite for the last 2 hours, but haven't been able to trigger the exception for some reason. I will post an update with the log when this happens.

[~tdsilva] I was able to reproduce the problem on HBase 1.3 and Phoenix 4.13.1. Logs are uploaded as 2018-01-05-hbase1.3.m9edd51.log

I will see if I can produce the problem with HBase 1.2.

Looking through the logs it looks like delete namespace clienttest is being called only once:

{code}
120826:2018-01-05 11:25:19,108 TRACE [ProcedureExecutor-1] procedure.DeleteNamespaceProcedure: DeleteNamespaceProcedure (Namespace=CLIENTTEST) id=178 owner=root state=RUNNABLE:DELETE_NAMESPACE_PREPARE execute state=DELETE_NAMESPACE_PREPARE
120839:2018-01-05 11:25:19,218 TRACE [ProcedureExecutor-1] procedure.DeleteNamespaceProcedure: DeleteNamespaceProcedure (Namespace=CLIENTTEST) id=178 owner=root state=FINISHED:DELETE_NAMESPACE_PREPARE rollback state=DELETE_NAMESPACE_PREPARE
120840:2018-01-05 11:25:19,319 INFO  [ProcedureExecutor-1] procedure2.ProcedureExecutor: Rolledback procedure DeleteNamespaceProcedure (Namespace=CLIENTTEST) id=178 owner=root state=ROLLEDBACK exec-time=212msec exception=org.apache.hadoop.hbase.NamespaceNotFoundException: CL
{code}

HMaster logs also show that all the tables are being deleted before the namespace delete is called
{code}
120064:2018-01-05 11:24:57,166 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:AGGREGATE
120474:2018-01-05 11:25:00,633 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:EVENT
120669:2018-01-05 11:25:04,073 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:IEVENT
120711:2018-01-05 11:25:07,526 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:SNAPSHOT
120760:2018-01-05 11:25:10,895 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:SUBSCRIPTION
120779:2018-01-05 11:25:14,321 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:TOPIC_SUBSCRIPTION
120819:2018-01-05 11:25:17,777 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST:SCHEMA_MIGRATION
120825:2018-01-05 11:25:19,006 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=39389] master.HMaster: Client=root//172.18.0.4 delete CLIENTTEST
{code}

I wonder if this is an HBase issue, were you able to repro the failure in HBase 1.2 ?

Thanks for investigating!

I just ran the test quite multiple times against Phoenix 4.13 with HBase 1.2 and am not able to reproduce the problem.

Can you share the ddl/dml of the failing test? I will try to repro the failure. 

Here are the statements from the simplest test that fails. In this test, we run a database migration to set up the appropriate schema and tables. Once this is done, we drop the tables and the schema.

{code}
-- Using connection 6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948
CREATE SCHEMA IF NOT EXISTS PHOENIXTEST

-- Using connection 7682303b-7e01-4a69-be4f-44825f28fa0f
SELECT 1
CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true
SELECT version FROM schema_migration ORDER BY version DESC
CREATE TABLE aggregate(id VARCHAR(255) NOT NULL,bounded_context VARCHAR(255) NOT NULL,aggregate VARCHAR(255) NOT NULL,organization_id VARCHAR(255) NOT NULL,version BIGINTCONSTRAINT pk PRIMARY KEY (id, bounded_context, Aggregate, organization_id))TRANSACTIONAL=TRUE
CREATE TABLE event(id BIGINT NOT NULL PRIMARY KEY,created TIMESTAMP,bounded_context VARCHAR(255),aggregate VARCHAR(255),aggregate_id VARCHAR(255),organization_id VARCHAR(255),event VARCHAR(255),data VARBINARY,version BIGINT,user_id VARCHAR(255),ip_address VARCHAR(45)) TRANSACTIONAL=TRUE, SALT_BUCKETS=20
CREATE INDEX ievent ON Event(aggregate_id,bounded_context,aggregate,organization_id,version)
CREATE TABLE snapshot(bounded_context VARCHAR(255) NOT NULL,aggregate VARCHAR(255) NOT NULL,aggregate_id VARCHAR(255) NOT NULL,organization_id VARCHAR(255) NOT NULL,version BIGINT,created TIMESTAMP,data VARBINARYCONSTRAINT pk PRIMARY KEY (bounded_context, Aggregate, aggregate_id, organization_id))
CREATE TABLE subscription(id VARCHAR(255) NOT NULL PRIMARY KEY,topic VARCHAR(255),last_event BIGINT,last_heartbeat TIMESTAMP)
CREATE INDEX topic_subscription ON subscription (topic) INCLUDE (last_event)
CREATE SEQUENCE event_id START WITH 1 INCREMENT BY 1 CACHE 0
UPSERT INTO schema_migration (version) VALUES (?)

-- Using connection 0d08e373-3def-466a-aad7-46180fcbeca7
SELECT 1
CREATE TABLE IF NOT EXISTS schema_migration (version varchar not null primary key) TRANSACTIONAL=true
SELECT version FROM schema_migration ORDER BY version DESC
DROP TABLE IF EXISTS aggregate
DROP TABLE IF EXISTS event
DROP INDEX IF EXISTS ievent ON Event
DROP TABLE IF EXISTS snapshot
DROP TABLE IF EXISTS subscription
DROP INDEX IF EXISTS topic_subscription ON subscription
DROP SEQUENCE IF EXISTS event_id
DELETE FROM schema_migration WHERE version=?

-- Using connection 6b4e63f4-f4f6-472e-a1e6-d9c8c80e5948
DROP TABLE IF EXISTS PHOENIXTEST.schema_migration
DROP SCHEMA IF EXISTS PHOENIXTEST
{code}

I also noticed that this problem tends to surface when there is high load on the machine.

