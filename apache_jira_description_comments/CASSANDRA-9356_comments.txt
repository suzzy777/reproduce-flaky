I meant to include that various sub-tests of the parent SSTableRewriterTest time out - it is not only the offlineAbort test. testSmallFiles, testAllKeysReadable, basicTest2 - I've seen them all.

Attached 2.1 HEAD system.log.gz from timed out SSTableRewriterTest:testNumberOfFilesAndSizes - this was on my 16G/SSD linux laptop, looping over SSTableRewriterTest - only took 3 loops to hit a timeout.

{noformat}
"main" prio=10 tid=0x00007f7c2c00d800 nid=0x1310 waiting on condition [0x00007f7c343b7000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  <0x00000000f195ebf8> (a java.util.concurrent.FutureTask$Sync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:994)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1303)
	at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:248)
	at java.util.concurrent.FutureTask.get(FutureTask.java:111)
	at org.apache.cassandra.utils.FBUtilities.waitOnFuture(FBUtilities.java:391)
	at org.apache.cassandra.io.sstable.SSTableDeletingTask.waitForDeletions(SSTableDeletingTask.java:131)
	at org.apache.cassandra.io.sstable.SSTableRewriterTest.testFileRemoval(SSTableRewriterTest.java:238)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:44)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:180)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:41)
	at org.junit.runners.ParentRunner$1.evaluate(ParentRunner.java:173)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:220)
	at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:518)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1052)
	at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:906)

"COMMIT-LOG-WRITER" prio=10 tid=0x00007f7c2c9f1000 nid=0x1328 runnable [0x00007f7c20053000]
   java.lang.Thread.State: RUNNABLE
	at java.nio.MappedByteBuffer.force0(Native Method)
	at java.nio.MappedByteBuffer.force(MappedByteBuffer.java:203)
	at org.apache.cassandra.db.commitlog.MemoryMappedSegment.write(MemoryMappedSegment.java:94)
	at org.apache.cassandra.db.commitlog.CommitLogSegment.sync(CommitLogSegment.java:278)
	- locked <0x00000000c0222d88> (a org.apache.cassandra.db.commitlog.MemoryMappedSegment)
	at org.apache.cassandra.db.commitlog.CommitLog.sync(CommitLog.java:229)
	at org.apache.cassandra.db.commitlog.AbstractCommitLogService$1.run(AbstractCommitLogService.java:93)
	at java.lang.Thread.run(Thread.java:724)

"NonPeriodicTasks:1" daemon prio=10 tid=0x00007f7c2ce27800 nid=0x1338 waiting on condition [0x00007f7c1a830000]
   java.lang.Thread.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:315)
	at org.apache.cassandra.utils.concurrent.WaitQueue$AbstractSignal.awaitUninterruptibly(WaitQueue.java:279)
	at org.apache.cassandra.db.commitlog.CommitLogSegment.waitForSync(CommitLogSegment.java:361)
	at org.apache.cassandra.db.commitlog.CommitLogSegment$Allocation.awaitDiskSync(CommitLogSegment.java:583)
	at org.apache.cassandra.db.commitlog.BatchCommitLogService.maybeWaitForSync(BatchCommitLogService.java:33)
	at org.apache.cassandra.db.commitlog.AbstractCommitLogService.finishWriteFor(AbstractCommitLogService.java:163)
	at org.apache.cassandra.db.commitlog.CommitLog.add(CommitLog.java:286)
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:371)
	at org.apache.cassandra.db.Keyspace.apply(Keyspace.java:348)
	at org.apache.cassandra.db.Mutation.apply(Mutation.java:214)
	at org.apache.cassandra.cql3.statements.ModificationStatement.executeInternal(ModificationStatement.java:619)
	at org.apache.cassandra.cql3.QueryProcessor.executeInternal(QueryProcessor.java:300)
	at org.apache.cassandra.db.SystemKeyspace.clearSSTableReadMeter(SystemKeyspace.java:981)
	at org.apache.cassandra.io.sstable.format.SSTableReader$GlobalTidy.tidy(SSTableReader.java:2096)
	at org.apache.cassandra.utils.concurrent.Ref$GlobalState.release(Ref.java:275)
	at org.apache.cassandra.utils.concurrent.Ref$State.release(Ref.java:177)
	at org.apache.cassandra.utils.concurrent.Ref.release(Ref.java:77)
	at org.apache.cassandra.io.sstable.format.SSTableReader$DescriptorTypeTidy.tidy(SSTableReader.java:1992)
	at org.apache.cassandra.utils.concurrent.Ref$GlobalState.release(Ref.java:275)
	at org.apache.cassandra.utils.concurrent.Ref$State.release(Ref.java:177)
	at org.apache.cassandra.utils.concurrent.Ref.release(Ref.java:77)
	at org.apache.cassandra.io.sstable.format.SSTableReader$InstanceTidier$1.run(SSTableReader.java:1944)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:724)
{noformat}
Still digging. Need to add logging to find out why it is hanging up here.

Looks like this test is no longer flaky on either 2.2 or 3.0. If it comes up in the future, feel free to re-open this.

